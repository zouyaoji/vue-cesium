/**
 * Cesium - https://github.com/AnalyticalGraphicsInc/cesium
 *
 * Copyright 2011-2017 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 *
 * Portions licensed separately.
 * See https://github.com/AnalyticalGraphicsInc/cesium/blob/master/LICENSE.md for full licensing details.
 */
/**
  @license
  when.js - https://github.com/cujojs/when

  MIT License (c) copyright B Cavalier & J Hann

 * A lightweight CommonJS Promises/A and when() implementation
 * when is part of the cujo.js family of libraries (http://cujojs.com/)
 *
 * Licensed under the MIT License at:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * @version 1.7.1
 */

/**
@license
mersenne-twister.js - https://gist.github.com/banksean/300494

   Copyright (C) 1997 - 2002, Makoto Matsumoto and Takuji Nishimura,
   All rights reserved.

   Redistribution and use in source and binary forms, with or without
   modification, are permitted provided that the following conditions
   are met:

     1. Redistributions of source code must retain the above copyright
        notice, this list of conditions and the following disclaimer.

     2. Redistributions in binary form must reproduce the above copyright
        notice, this list of conditions and the following disclaimer in the
        documentation and/or other materials provided with the distribution.

     3. The names of its contributors may not be used to endorse or promote
        products derived from this software without specific prior written
        permission.

   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
   "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
   A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
   CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
   EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
   PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
   PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
   LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
   NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
   SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

!function(){!function(t){"use strict";t("ThirdParty/when",[],function(){function t(t,r,n,i){return e(t).then(r,n,i)}function e(t){var e,r;return t instanceof n?e=t:a(t)?(r=s(),t.then(function(t){r.resolve(t)},function(t){r.reject(t)},function(t){r.progress(t)}),e=r.promise):e=i(t),e}function r(e){return t(e,o)}function n(t){this.then=t}function i(t){return new n(function(r){try{return e(r?r(t):t)}catch(t){return o(t)}})}function o(t){return new n(function(r,n){try{return n?e(n(t)):o(t)}catch(t){return o(t)}})}function s(){function t(t,e,r){return f(t,e,r)}function r(t){return p(t)}function i(t){return p(o(t))}function a(t){return d(t)}var l,h,u,c,f,d,p;return h=new n(t),l={then:t,resolve:r,reject:i,progress:a,promise:h,resolver:{resolve:r,reject:i,progress:a}},u=[],c=[],f=function(t,e,r){var n,i;return n=s(),i="function"==typeof r?function(t){try{n.progress(r(t))}catch(t){n.progress(t)}}:function(t){n.progress(t)},u.push(function(r){r.then(t,e).then(n.resolve,n.reject,i)}),c.push(i),n.promise},d=function(t){return g(c,t),t},p=function(t){return t=e(t),f=t.then,p=e,d=m,g(u,t),c=u=C,t},l}function a(t){return t&&"function"==typeof t.then}function l(e,r,n,i,o){return y(2,arguments),t(e,function(e){function a(t){g(t)}function l(t){p(t)}var h,u,c,f,d,p,g,y,v,_;if(v=e.length>>>0,h=Math.max(0,Math.min(r,v)),c=[],u=v-h+1,f=[],d=s(),h)for(y=d.progress,g=function(t){f.push(t),--u||(p=g=m,d.reject(f))},p=function(t){c.push(t),--h||(p=g=m,d.resolve(c))},_=0;_<v;++_)_ in e&&t(e[_],l,a,y);else d.resolve(c);return d.then(n,i,o)})}function h(t,e,r,n){function i(t){return e?e(t[0]):t[0]}return l(t,1,i,r,n)}function u(t,e,r,n){return y(1,arguments),f(t,v).then(e,r,n)}function c(){return f(arguments,v)}function f(e,r){return t(e,function(e){var n,i,o,a,l,h;if(o=i=e.length>>>0,n=[],h=s(),o)for(a=function(e,i){t(e,r).then(function(t){n[i]=t,--o||h.resolve(n)},h.reject)},l=0;l<i;l++)l in e?a(e[l],l):--o;else h.resolve(n);return h.promise})}function d(e,r){var n=S.call(arguments,1);return t(e,function(e){var i;return i=e.length,n[0]=function(e,n,o){return t(e,function(e){return t(n,function(t){return r(e,t,o,i)})})},_.apply(e,n)})}function p(e,r,n){var i=arguments.length>2;return t(e,function(t){return t=i?n:t,r.resolve(t),t},function(t){return r.reject(t),o(t)},r.progress)}function g(t,e){for(var r,n=0;r=t[n++];)r(e)}function y(t,e){for(var r,n=e.length;n>t;)if(null!=(r=e[--n])&&"function"!=typeof r)throw new Error("arg "+n+" must be a function")}function m(){}function v(t){return t}var _,S,C;return t.defer=s,t.resolve=e,t.reject=r,t.join=c,t.all=u,t.map=f,t.reduce=d,t.any=h,t.some=l,t.chain=p,t.isPromise=a,n.prototype={always:function(t,e){return this.then(t,t,e)},otherwise:function(t){return this.then(C,t)},yield:function(t){return this.then(function(){return t})},spread:function(t){return this.then(function(e){return u(e,function(e){return t.apply(C,e)})})}},S=[].slice,_=[].reduce||function(t){var e,r,n,i,o;if(o=0,e=Object(this),i=e.length>>>0,r=arguments,r.length<=1)for(;;){if(o in e){n=e[o++];break}if(++o>=i)throw new TypeError}else n=r[1];for(;o<i;++o)o in e&&(n=t(n,e[o],o,e));return n},t})}("function"==typeof define&&define.amd?define:function(t){"object"==typeof exports?module.exports=t():this.when=t()}),define("Core/defined",[],function(){"use strict";function t(t){return void 0!==t&&null!==t}return t}),define("Core/freezeObject",["./defined"],function(t){"use strict";var e=Object.freeze;return t(e)||(e=function(t){return t}),e}),define("Core/defaultValue",["./freezeObject"],function(t){"use strict";function e(t,e){return void 0!==t&&null!==t?t:e}return e.EMPTY_OBJECT=t({}),e}),define("Core/formatError",["./defined"],function(t){"use strict";function e(e){var r,n=e.name,i=e.message;r=t(n)&&t(i)?n+": "+i:e.toString();var o=e.stack;return t(o)&&(r+="\n"+o),r}return e}),define("Workers/createTaskProcessorWorker",["../ThirdParty/when","../Core/defaultValue","../Core/defined","../Core/formatError"],function(t,e,r,n){"use strict";function i(e,r,n){try{return e(r,n)}catch(e){return t.reject(e)}}function o(o){var s;return function(a){var l=a.data,h=[],u={id:l.id,result:void 0,error:void 0};return t(i(o,l.parameters,h)).then(function(t){u.result=t}).otherwise(function(t){t instanceof Error?u.error={name:t.name,message:t.message,stack:t.stack}:u.error=t}).always(function(){r(s)||(s=e(self.webkitPostMessage,self.postMessage)),l.canTransferArrayBuffer||(h.length=0);try{s(u,h)}catch(t){u.result=void 0,u.error="postMessage failed with error: "+n(t)+"\n  with responseMessage: "+JSON.stringify(u),s(u)}})}}return o}),define("Core/DeveloperError",["./defined"],function(t){"use strict";function e(t){this.name="DeveloperError",this.message=t;var e;try{throw new Error}catch(t){e=t.stack}this.stack=e}return t(Object.create)&&(e.prototype=Object.create(Error.prototype),e.prototype.constructor=e),e.prototype.toString=function(){var e=this.name+": "+this.message;return t(this.stack)&&(e+="\n"+this.stack.toString()),e},e.throwInstantiationError=function(){throw new e("This function defines an interface and should not be called directly.")},e}),define("Core/Check",["./defined","./DeveloperError"],function(t,e){"use strict";function r(t){return t+" is required, actual value was undefined"}function n(t,e,r){return"Expected "+r+" to be typeof "+e+", actual typeof was "+t}var i={};return i.typeOf={},i.defined=function(n,i){if(!t(i))throw new e(r(n))},i.typeOf.func=function(t,r){if("function"!=typeof r)throw new e(n(typeof r,"function",t))},i.typeOf.string=function(t,r){if("string"!=typeof r)throw new e(n(typeof r,"string",t))},i.typeOf.number=function(t,r){if("number"!=typeof r)throw new e(n(typeof r,"number",t))},i.typeOf.number.lessThan=function(t,r,n){if(i.typeOf.number(t,r),r>=n)throw new e("Expected "+t+" to be less than "+n+", actual value was "+r)},i.typeOf.number.lessThanOrEquals=function(t,r,n){if(i.typeOf.number(t,r),r>n)throw new e("Expected "+t+" to be less than or equal to "+n+", actual value was "+r)},i.typeOf.number.greaterThan=function(t,r,n){if(i.typeOf.number(t,r),r<=n)throw new e("Expected "+t+" to be greater than "+n+", actual value was "+r)},i.typeOf.number.greaterThanOrEquals=function(t,r,n){if(i.typeOf.number(t,r),r<n)throw new e("Expected "+t+" to be greater than or equal to"+n+", actual value was "+r)},i.typeOf.object=function(t,r){if("object"!=typeof r)throw new e(n(typeof r,"object",t))},i.typeOf.bool=function(t,r){if("boolean"!=typeof r)throw new e(n(typeof r,"boolean",t))},i.typeOf.number.equals=function(t,r,n,o){if(i.typeOf.number(t,n),i.typeOf.number(r,o),n!==o)throw new e(t+" must be equal to "+r+", the actual values are "+n+" and "+o)},i}),define("Core/defineProperties",["./defined"],function(t){"use strict";var e=function(){try{return"x"in Object.defineProperty({},"x",{})}catch(t){return!1}}(),r=Object.defineProperties;return e&&t(r)||(r=function(t){return t}),r}),define("Core/Fullscreen",["./defined","./defineProperties"],function(t,e){"use strict";var r,n={requestFullscreen:void 0,exitFullscreen:void 0,fullscreenEnabled:void 0,fullscreenElement:void 0,fullscreenchange:void 0,fullscreenerror:void 0},i={};return e(i,{element:{get:function(){if(i.supportsFullscreen())return document[n.fullscreenElement]}},changeEventName:{get:function(){if(i.supportsFullscreen())return n.fullscreenchange}},errorEventName:{get:function(){if(i.supportsFullscreen())return n.fullscreenerror}},enabled:{get:function(){if(i.supportsFullscreen())return document[n.fullscreenEnabled]}},fullscreen:{get:function(){if(i.supportsFullscreen())return null!==i.element}}}),i.supportsFullscreen=function(){if(t(r))return r;r=!1;var e=document.body;if("function"==typeof e.requestFullscreen)return n.requestFullscreen="requestFullscreen",n.exitFullscreen="exitFullscreen",n.fullscreenEnabled="fullscreenEnabled",n.fullscreenElement="fullscreenElement",n.fullscreenchange="fullscreenchange",n.fullscreenerror="fullscreenerror",r=!0;for(var i,o=["webkit","moz","o","ms","khtml"],s=0,a=o.length;s<a;++s){var l=o[s];i=l+"RequestFullscreen","function"==typeof e[i]?(n.requestFullscreen=i,r=!0):(i=l+"RequestFullScreen","function"==typeof e[i]&&(n.requestFullscreen=i,r=!0)),i=l+"ExitFullscreen","function"==typeof document[i]?n.exitFullscreen=i:(i=l+"CancelFullScreen","function"==typeof document[i]&&(n.exitFullscreen=i)),i=l+"FullscreenEnabled",void 0!==document[i]?n.fullscreenEnabled=i:(i=l+"FullScreenEnabled",void 0!==document[i]&&(n.fullscreenEnabled=i)),i=l+"FullscreenElement",void 0!==document[i]?n.fullscreenElement=i:(i=l+"FullScreenElement",void 0!==document[i]&&(n.fullscreenElement=i)),i=l+"fullscreenchange",void 0!==document["on"+i]&&("ms"===l&&(i="MSFullscreenChange"),n.fullscreenchange=i),i=l+"fullscreenerror",void 0!==document["on"+i]&&("ms"===l&&(i="MSFullscreenError"),n.fullscreenerror=i)}return r},i.requestFullscreen=function(t,e){i.supportsFullscreen()&&t[n.requestFullscreen]({vrDisplay:e})},i.exitFullscreen=function(){i.supportsFullscreen()&&document[n.exitFullscreen]()},i}),define("Core/RuntimeError",["./defined"],function(t){"use strict";function e(t){this.name="RuntimeError",this.message=t;var e;try{throw new Error}catch(t){e=t.stack}this.stack=e}return t(Object.create)&&(e.prototype=Object.create(Error.prototype),e.prototype.constructor=e),e.prototype.toString=function(){var e=this.name+": "+this.message;return t(this.stack)&&(e+="\n"+this.stack.toString()),e},e}),define("Core/FeatureDetection",["./defaultValue","./defined","./Fullscreen","./RuntimeError","../ThirdParty/when"],function(t,e,r,n,i){"use strict";function o(t){for(var e=t.split("."),r=0,n=e.length;r<n;++r)e[r]=parseInt(e[r],10);return e}function s(){if(!e(O)&&(O=!1,!p())){var t=/ Chrome\/([\.0-9]+)/.exec(R.userAgent);null!==t&&(O=!0,L=o(t[1]))}return O}function a(){return s()&&L}function l(){if(!e(F)&&(F=!1,!s()&&!p()&&/ Safari\/[\.0-9]+/.test(R.userAgent))){var t=/ Version\/([\.0-9]+)/.exec(R.userAgent);null!==t&&(F=!0,w=o(t[1]))}return F}function h(){return l()&&w}function u(){if(!e(M)){M=!1;var t=/ AppleWebKit\/([\.0-9]+)(\+?)/.exec(R.userAgent);null!==t&&(M=!0,A=o(t[1]),A.isNightly=!!t[2])}return M}function c(){return u()&&A}function f(){if(!e(G)){G=!1;var t;"Microsoft Internet Explorer"===R.appName?null!==(t=/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(R.userAgent))&&(G=!0,b=o(t[1])):"Netscape"===R.appName&&null!==(t=/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(R.userAgent))&&(G=!0,b=o(t[1]))}return G}function d(){return f()&&b}function p(){if(!e(P)){P=!1;var t=/ Edge\/([\.0-9]+)/.exec(R.userAgent);null!==t&&(P=!0,D=o(t[1]))}return P}function g(){return p()&&D}function y(){if(!e(k)){k=!1;var t=/Firefox\/([\.0-9]+)/.exec(R.userAgent);null!==t&&(k=!0,N=o(t[1]))}return k}function m(){return e(B)||(B=/Windows/i.test(R.appVersion)),B}function v(){return y()&&N}function _(){return e(Y)||(Y="object"==typeof process&&"[object process]"===Object.prototype.toString.call(process)),Y}function S(){return e(U)||(U=!y()&&"undefined"!=typeof PointerEvent&&(!e(R.pointerEnabled)||R.pointerEnabled)),U}function C(){if(!e(W)){var t=document.createElement("canvas");t.setAttribute("style","image-rendering: -moz-crisp-edges;image-rendering: pixelated;");var r=t.style.imageRendering;W=e(r)&&""!==r,W&&(V=r)}return W}function x(){return C()?V:void 0}function I(){if(e(H))return H.promise;H=i.defer(),p()&&(X=!1,H.resolve(X));var t=new Image;return t.onload=function(){X=t.width>0&&t.height>0,H.resolve(X)},t.onerror=function(){X=!1,H.resolve(X)},t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",H.promise}function E(){return e(H)||I(),X}function T(){var t=window.navigator.userAgent.toLowerCase(),e="ipad"==t.match(/ipad/i),r="iphone os"==t.match(/iphone os/i),n="midp"==t.match(/midp/i),i="rv:1.2.3.4"==t.match(/rv:1.2.3.4/i),o="ucweb"==t.match(/ucweb/i),s="android"==t.match(/android/i),a="windows ce"==t.match(/windows ce/i),l="windows mobile"==t.match(/windows mobile/i);return!(e||r||n||i||o||s||a||l)}var R;R="undefined"!=typeof navigator?navigator:{};var O,L,F,w,M,A,G,b,P,D,k,N,B,Y,U,V,W,X,H,j=[];"undefined"!=typeof ArrayBuffer&&(j.push(Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array),"undefined"!=typeof Uint8ClampedArray&&j.push(Uint8ClampedArray),"undefined"!=typeof CanvasPixelArray&&j.push(CanvasPixelArray));var q={isChrome:s,chromeVersion:a,isSafari:l,safariVersion:h,isWebkit:u,webkitVersion:c,isInternetExplorer:f,internetExplorerVersion:d,isEdge:p,edgeVersion:g,isFirefox:y,firefoxVersion:v,isWindows:m,isNodeJs:_,hardwareConcurrency:t(R.hardwareConcurrency,3),supportsPointerEvents:S,supportsImageRenderingPixelated:C,supportsWebP:I,supportsWebPSync:E,imageRenderingValue:x,typedArrayTypes:j,isPCBroswer:T};return q.supportsFullscreen=function(){return r.supportsFullscreen()},q.supportsTypedArrays=function(){return"undefined"!=typeof ArrayBuffer},q.supportsWebWorkers=function(){return"undefined"!=typeof Worker},q.supportsWebAssembly=function(){return"undefined"!=typeof WebAssembly&&!q.isEdge()},q.supportsOffscreenCanvas=function(){return"undefined"!=typeof OffscreenCanvas&&!q.isEdge()},q}),define("ThirdParty/mersenne-twister",[],function(){var t=function(t){void 0==t&&(t=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,this.init_genrand(t)};return t.prototype.init_genrand=function(t){for(this.mt[0]=t>>>0,this.mti=1;this.mti<this.N;this.mti++){var t=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&t)>>>16)<<16)+1812433253*(65535&t)+this.mti,this.mt[this.mti]>>>=0}},t.prototype.genrand_int32=function(){var t,e=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var r;for(this.mti==this.N+1&&this.init_genrand(5489),r=0;r<this.N-this.M;r++)t=this.mt[r]&this.UPPER_MASK|this.mt[r+1]&this.LOWER_MASK,this.mt[r]=this.mt[r+this.M]^t>>>1^e[1&t];for(;r<this.N-1;r++)t=this.mt[r]&this.UPPER_MASK|this.mt[r+1]&this.LOWER_MASK,this.mt[r]=this.mt[r+(this.M-this.N)]^t>>>1^e[1&t];t=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^t>>>1^e[1&t],this.mti=0}return t=this.mt[this.mti++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,(t^=t>>>18)>>>0},t.prototype.random=function(){return this.genrand_int32()*(1/4294967296)},t}),define("Core/Math",["../ThirdParty/mersenne-twister","./Check","./defaultValue","./defined","./DeveloperError"],function(t,e,r,n,i){"use strict";var o={};o.Radius=6378137,o.EPSILON1=.1,o.EPSILON2=.01,o.EPSILON3=.001,o.EPSILON4=1e-4,o.EPSILON5=1e-5,o.EPSILON6=1e-6,o.EPSILON7=1e-7,o.EPSILON8=1e-8,o.EPSILON9=1e-9,o.EPSILON10=1e-10,o.EPSILON11=1e-11,o.EPSILON12=1e-12,o.EPSILON13=1e-13,o.EPSILON14=1e-14,o.EPSILON15=1e-15,o.EPSILON16=1e-16,o.EPSILON17=1e-17,o.EPSILON18=1e-18,o.EPSILON19=1e-19,o.EPSILON20=1e-20,o.EPSILON21=1e-21,o.GRAVITATIONALPARAMETER=3986004418e5,o.SOLAR_RADIUS=6955e5,o.LUNAR_RADIUS=1737400,o.SIXTY_FOUR_KILOBYTES=65536,o.sign=r(Math.sign,function(t){return t=+t,0===t||t!==t?t:t>0?1:-1}),o.signNotZero=function(t){return t<0?-1:1},o.toSNorm=function(t,e){return e=r(e,255),Math.round((.5*o.clamp(t,-1,1)+.5)*e)},o.fromSNorm=function(t,e){return e=r(e,255),o.clamp(t,0,e)/e*2-1},o.sinh=r(Math.sinh,function(t){return(Math.exp(t)-Math.exp(-t))/2}),o.cosh=r(Math.cosh,function(t){return(Math.exp(t)+Math.exp(-t))/2}),o.lerp=function(t,e,r){return(1-r)*t+r*e},o.PI=Math.PI,o.ONE_OVER_PI=1/Math.PI,o.PI_OVER_TWO=Math.PI/2,o.PI_OVER_THREE=Math.PI/3,o.PI_OVER_FOUR=Math.PI/4,o.PI_OVER_SIX=Math.PI/6,o.THREE_PI_OVER_TWO=3*Math.PI/2,o.TWO_PI=2*Math.PI,o.ONE_OVER_TWO_PI=1/(2*Math.PI),o.RADIANS_PER_DEGREE=Math.PI/180,o.DEGREES_PER_RADIAN=180/Math.PI,o.RADIANS_PER_ARCSECOND=o.RADIANS_PER_DEGREE/3600,o.toRadians=function(t){if(!n(t))throw new i("degrees is required.");return t*o.RADIANS_PER_DEGREE},o.toDegrees=function(t){if(!n(t))throw new i("radians is required.");return t*o.DEGREES_PER_RADIAN},o.convertLongitudeRange=function(t){if(!n(t))throw new i("angle is required.");var e=o.TWO_PI,r=t-Math.floor(t/e)*e;return r<-Math.PI?r+e:r>=Math.PI?r-e:r},o.clampToLatitudeRange=function(t){if(!n(t))throw new i("angle is required.");return o.clamp(t,-1*o.PI_OVER_TWO,o.PI_OVER_TWO)},o.negativePiToPi=function(t){if(!n(t))throw new i("angle is required.");return o.zeroToTwoPi(t+o.PI)-o.PI},o.zeroToTwoPi=function(t){if(!n(t))throw new i("angle is required.");var e=o.mod(t,o.TWO_PI);return Math.abs(e)<o.EPSILON14&&Math.abs(t)>o.EPSILON14?o.TWO_PI:e},o.mod=function(t,e){if(!n(t))throw new i("m is required.");if(!n(e))throw new i("n is required.");return(t%e+e)%e},o.equalsEpsilon=function(t,e,o,s){if(!n(t))throw new i("left is required.");if(!n(e))throw new i("right is required.");if(!n(o))throw new i("relativeEpsilon is required.");s=r(s,o);var a=Math.abs(t-e);return a<=s||a<=o*Math.max(Math.abs(t),Math.abs(e))},o.lessThan=function(t,e,r){if(!n(t))throw new i("first is required.");if(!n(e))throw new i("second is required.");if(!n(r))throw new i("relativeEpsilon is required.");return t-e<-r},o.lessThanOrEquals=function(t,e,r){if(!n(t))throw new i("first is required.");if(!n(e))throw new i("second is required.");if(!n(r))throw new i("relativeEpsilon is required.");return t-e<r},o.greaterThan=function(t,e,r){if(!n(t))throw new i("first is required.");if(!n(e))throw new i("second is required.");if(!n(r))throw new i("relativeEpsilon is required.");return t-e>r},o.greaterThanOrEquals=function(t,e,r){if(!n(t))throw new i("first is required.");if(!n(e))throw new i("second is required.");if(!n(r))throw new i("relativeEpsilon is required.");return t-e>-r};var s=[1];o.factorial=function(t){if("number"!=typeof t||t<0)throw new i("A number greater than or equal to 0 is required.");var e=s.length;if(t>=e)for(var r=s[e-1],n=e;n<=t;n++)s.push(r*n);return s[t]},o.incrementWrap=function(t,e,o){if(o=r(o,0),!n(t))throw new i("n is required.");if(e<=o)throw new i("maximumValue must be greater than minimumValue.");return++t,t>e&&(t=o),t},o.isPowerOfTwo=function(t){if("number"!=typeof t||t<0)throw new i("A number greater than or equal to 0 is required.");return 0!==t&&0==(t&t-1)},o.nextPowerOfTwo=function(t){if("number"!=typeof t||t<0)throw new i("A number greater than or equal to 0 is required.");return--t,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},o.clamp=function(t,e,r){if(!n(t))throw new i("value is required");if(!n(e))throw new i("min is required.");if(!n(r))throw new i("max is required.");return t<e?e:t>r?r:t};var a=new t;return o.setRandomNumberSeed=function(e){if(!n(e))throw new i("seed is required.");a=new t(e)},o.nextRandomNumber=function(){return a.random()},o.randomBetween=function(t,e){return o.nextRandomNumber()*(e-t)+t},o.acosClamped=function(t){if(!n(t))throw new i("value is required.");return Math.acos(o.clamp(t,-1,1))},o.asinClamped=function(t){if(!n(t))throw new i("value is required.");return Math.asin(o.clamp(t,-1,1))},o.chordLength=function(t,e){if(!n(t))throw new i("angle is required.");if(!n(e))throw new i("radius is required.");return 2*e*Math.sin(.5*t)},o.logBase=function(t,e){if(!n(t))throw new i("number is required.");if(!n(e))throw new i("base is required.");return Math.log(t)/Math.log(e)},o.cbrt=r(Math.cbrt,function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e}),o.log2=r(Math.log2,function(t){return Math.log(t)*Math.LOG2E}),o.fog=function(t,e){var r=t*e;return 1-Math.exp(-r*r)},o.fastApproximateAtan=function(t){return e.typeOf.number("x",t),t*(-.1784*Math.abs(t)-.0663*t*t+1.0301)},o.fastApproximateAtan2=function(t,r){e.typeOf.number("x",t),e.typeOf.number("y",r);var n,s,a=Math.abs(t);n=Math.abs(r),s=Math.max(a,n),n=Math.min(a,n);var l=n/s;if(isNaN(l))throw new i("either x or y must be nonzero");return a=o.fastApproximateAtan(l),a=Math.abs(r)>Math.abs(t)?o.PI_OVER_TWO-a:a,a=t<0?o.PI-a:a,a=r<0?-a:a},o}),define("Core/Color",["./Check","./defaultValue","./defined","./FeatureDetection","./freezeObject","./Math"],function(t,e,r,n,i,o){"use strict";function s(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),6*r<1?t+6*(e-t)*r:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}function a(t,r,n,i){this.red=e(t,1),this.green=e(r,1),this.blue=e(n,1),this.alpha=e(i,1)}a.fromCartesian4=function(e,n){return t.typeOf.object("cartesian",e),r(n)?(n.red=e.x,n.green=e.y,n.blue=e.z,n.alpha=e.w,n):new a(e.x,e.y,e.z,e.w)},a.fromBytes=function(t,n,i,o,s){return t=a.byteToFloat(e(t,255)),n=a.byteToFloat(e(n,255)),i=a.byteToFloat(e(i,255)),o=a.byteToFloat(e(o,255)),r(s)?(s.red=t,s.green=n,s.blue=i,s.alpha=o,s):new a(t,n,i,o)},a.fromAlpha=function(e,n,i){return t.typeOf.object("color",e),t.typeOf.number("alpha",n),r(i)?(i.red=e.red,i.green=e.green,i.blue=e.blue,i.alpha=n,i):new a(e.red,e.green,e.blue,n)};var l,h,u;n.supportsTypedArrays()&&(l=new ArrayBuffer(4),h=new Uint32Array(l),u=new Uint8Array(l)),a.fromRgba=function(t,e){return h[0]=t,a.fromBytes(u[0],u[1],u[2],u[3],e)},a.fromHsl=function(t,n,i,o,l){t=e(t,0)%1,n=e(n,0),i=e(i,0),o=e(o,1);var h=i,u=i,c=i;if(0!==n){var f;f=i<.5?i*(1+n):i+n-i*n;var d=2*i-f;h=s(d,f,t+1/3),u=s(d,f,t),c=s(d,f,t-1/3)}return r(l)?(l.red=h,l.green=u,l.blue=c,l.alpha=o,l):new a(h,u,c,o)},a.fromRandom=function(n,i){n=e(n,e.EMPTY_OBJECT);var s=n.red;if(!r(s)){var l=e(n.minimumRed,0),h=e(n.maximumRed,1);t.typeOf.number.lessThanOrEquals("minimumRed",l,h),s=l+o.nextRandomNumber()*(h-l)}var u=n.green;if(!r(u)){var c=e(n.minimumGreen,0),f=e(n.maximumGreen,1);t.typeOf.number.lessThanOrEquals("minimumGreen",c,f),u=c+o.nextRandomNumber()*(f-c)}var d=n.blue;if(!r(d)){var p=e(n.minimumBlue,0),g=e(n.maximumBlue,1);t.typeOf.number.lessThanOrEquals("minimumBlue",p,g),d=p+o.nextRandomNumber()*(g-p)}var y=n.alpha;if(!r(y)){var m=e(n.minimumAlpha,0),v=e(n.maximumAlpha,1);t.typeOf.number.lessThanOrEquals("minumumAlpha",m,v),y=m+o.nextRandomNumber()*(v-m)}return r(i)?(i.red=s,i.green=u,i.blue=d,i.alpha=y,i):new a(s,u,d,y)};var c=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,f=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i,d=/^rgba?\(\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)(?:\s*,\s*([0-9.]+))?\s*\)$/i,p=/^hsla?\(\s*([0-9.]+)\s*,\s*([0-9.]+%)\s*,\s*([0-9.]+%)(?:\s*,\s*([0-9.]+))?\s*\)$/i;return a.fromCssColorString=function(n,i){t.typeOf.string("color",n),r(i)||(i=new a);var o=a[n.toUpperCase()];if(r(o))return a.clone(o,i),i;var s=c.exec(n);return null!==s?(i.red=parseInt(s[1],16)/15,i.green=parseInt(s[2],16)/15,i.blue=parseInt(s[3],16)/15,i.alpha=1,i):null!==(s=f.exec(n))?(i.red=parseInt(s[1],16)/255,i.green=parseInt(s[2],16)/255,i.blue=parseInt(s[3],16)/255,i.alpha=1,i):null!==(s=d.exec(n))?(i.red=parseFloat(s[1])/("%"===s[1].substr(-1)?100:255),i.green=parseFloat(s[2])/("%"===s[2].substr(-1)?100:255),i.blue=parseFloat(s[3])/("%"===s[3].substr(-1)?100:255),i.alpha=parseFloat(e(s[4],"1.0")),i):null!==(s=p.exec(n))?a.fromHsl(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,parseFloat(e(s[4],"1.0")),i):i=void 0},a.packedLength=4,a.pack=function(r,n,i){return t.typeOf.object("value",r),t.defined("array",n),i=e(i,0),n[i++]=r.red,n[i++]=r.green,n[i++]=r.blue,n[i]=r.alpha,n},a.unpack=function(n,i,o){return t.defined("array",n),i=e(i,0),r(o)||(o=new a),o.red=n[i++],o.green=n[i++],o.blue=n[i++],o.alpha=n[i],o},a.byteToFloat=function(t){return t/255},a.floatToByte=function(t){return 1===t?255:256*t|0},a.clone=function(t,e){if(r(t))return r(e)?(e.red=t.red,e.green=t.green,e.blue=t.blue,e.alpha=t.alpha,e):new a(t.red,t.green,t.blue,t.alpha)},a.equals=function(t,e){return t===e||r(t)&&r(e)&&t.red===e.red&&t.green===e.green&&t.blue===e.blue&&t.alpha===e.alpha},a.equalsArray=function(t,e,r){return t.red===e[r]&&t.green===e[r+1]&&t.blue===e[r+2]&&t.alpha===e[r+3]},a.prototype.clone=function(t){return a.clone(this,t)},a.prototype.equals=function(t){return a.equals(this,t)},a.prototype.equalsEpsilon=function(t,e){return this===t||r(t)&&Math.abs(this.red-t.red)<=e&&Math.abs(this.green-t.green)<=e&&Math.abs(this.blue-t.blue)<=e&&Math.abs(this.alpha-t.alpha)<=e},a.prototype.toString=function(){return"("+this.red+", "+this.green+", "+this.blue+", "+this.alpha+")"},a.prototype.toCssColorString=function(){var t=a.floatToByte(this.red),e=a.floatToByte(this.green),r=a.floatToByte(this.blue);return 1===this.alpha?"rgb("+t+","+e+","+r+")":"rgba("+t+","+e+","+r+","+this.alpha+")"},a.prototype.toBytes=function(t){var e=a.floatToByte(this.red),n=a.floatToByte(this.green),i=a.floatToByte(this.blue),o=a.floatToByte(this.alpha);return r(t)?(t[0]=e,t[1]=n,t[2]=i,t[3]=o,t):[e,n,i,o]},a.prototype.toRgba=function(){return u[0]=a.floatToByte(this.red),u[1]=a.floatToByte(this.green),u[2]=a.floatToByte(this.blue),u[3]=a.floatToByte(this.alpha),h[0]},a.prototype.brighten=function(e,r){return t.typeOf.number("magnitude",e),t.typeOf.number.greaterThanOrEquals("magnitude",e,0),t.typeOf.object("result",r),e=1-e,r.red=1-(1-this.red)*e,r.green=1-(1-this.green)*e,r.blue=1-(1-this.blue)*e,r.alpha=this.alpha,r},a.prototype.darken=function(e,r){return t.typeOf.number("magnitude",e),t.typeOf.number.greaterThanOrEquals("magnitude",e,0),t.typeOf.object("result",r),e=1-e,r.red=this.red*e,r.green=this.green*e,r.blue=this.blue*e,r.alpha=this.alpha,r},a.prototype.withAlpha=function(t,e){return a.fromAlpha(this,t,e)},a.add=function(e,r,n){return t.typeOf.object("left",e),t.typeOf.object("right",r),t.typeOf.object("result",n),n.red=e.red+r.red,n.green=e.green+r.green,n.blue=e.blue+r.blue,n.alpha=e.alpha+r.alpha,n},a.subtract=function(e,r,n){return t.typeOf.object("left",e),t.typeOf.object("right",r),t.typeOf.object("result",n),n.red=e.red-r.red,n.green=e.green-r.green,n.blue=e.blue-r.blue,n.alpha=e.alpha-r.alpha,n},a.multiply=function(e,r,n){return t.typeOf.object("left",e),t.typeOf.object("right",r),t.typeOf.object("result",n),n.red=e.red*r.red,n.green=e.green*r.green,n.blue=e.blue*r.blue,n.alpha=e.alpha*r.alpha,n},a.divide=function(e,r,n){return t.typeOf.object("left",e),t.typeOf.object("right",r),t.typeOf.object("result",n),n.red=e.red/r.red,n.green=e.green/r.green,n.blue=e.blue/r.blue,n.alpha=e.alpha/r.alpha,n},a.mod=function(e,r,n){return t.typeOf.object("left",e),t.typeOf.object("right",r),t.typeOf.object("result",n),n.red=e.red%r.red,n.green=e.green%r.green,n.blue=e.blue%r.blue,n.alpha=e.alpha%r.alpha,n},a.multiplyByScalar=function(e,r,n){return t.typeOf.object("color",e),t.typeOf.number("scalar",r),t.typeOf.object("result",n),n.red=e.red*r,n.green=e.green*r,n.blue=e.blue*r,n.alpha=e.alpha*r,n},a.divideByScalar=function(e,r,n){return t.typeOf.object("color",e),t.typeOf.number("scalar",r),t.typeOf.object("result",n),n.red=e.red/r,n.green=e.green/r,n.blue=e.blue/r,n.alpha=e.alpha/r,n},a.ALICEBLUE=i(a.fromCssColorString("#F0F8FF")),a.ANTIQUEWHITE=i(a.fromCssColorString("#FAEBD7")),a.AQUA=i(a.fromCssColorString("#00FFFF")),a.AQUAMARINE=i(a.fromCssColorString("#7FFFD4")),a.AZURE=i(a.fromCssColorString("#F0FFFF")),a.BEIGE=i(a.fromCssColorString("#F5F5DC")),a.BISQUE=i(a.fromCssColorString("#FFE4C4")),a.BLACK=i(a.fromCssColorString("#000000")),a.BLANCHEDALMOND=i(a.fromCssColorString("#FFEBCD")),a.BLUE=i(a.fromCssColorString("#0000FF")),a.BLUEVIOLET=i(a.fromCssColorString("#8A2BE2")),a.BROWN=i(a.fromCssColorString("#A52A2A")),a.BURLYWOOD=i(a.fromCssColorString("#DEB887")),a.CADETBLUE=i(a.fromCssColorString("#5F9EA0")),a.CHARTREUSE=i(a.fromCssColorString("#7FFF00")),a.CHOCOLATE=i(a.fromCssColorString("#D2691E")),a.CORAL=i(a.fromCssColorString("#FF7F50")),a.CORNFLOWERBLUE=i(a.fromCssColorString("#6495ED")),a.CORNSILK=i(a.fromCssColorString("#FFF8DC")),a.CRIMSON=i(a.fromCssColorString("#DC143C")),a.CYAN=i(a.fromCssColorString("#00FFFF")),a.DARKBLUE=i(a.fromCssColorString("#00008B")),a.DARKCYAN=i(a.fromCssColorString("#008B8B")),a.DARKGOLDENROD=i(a.fromCssColorString("#B8860B")),a.DARKGRAY=i(a.fromCssColorString("#A9A9A9")),a.DARKGREEN=i(a.fromCssColorString("#006400")),a.DARKGREY=a.DARKGRAY,a.DARKKHAKI=i(a.fromCssColorString("#BDB76B")),a.DARKMAGENTA=i(a.fromCssColorString("#8B008B")),a.DARKOLIVEGREEN=i(a.fromCssColorString("#556B2F")),a.DARKORANGE=i(a.fromCssColorString("#FF8C00")),a.DARKORCHID=i(a.fromCssColorString("#9932CC")),a.DARKRED=i(a.fromCssColorString("#8B0000")),a.DARKSALMON=i(a.fromCssColorString("#E9967A")),a.DARKSEAGREEN=i(a.fromCssColorString("#8FBC8F")),a.DARKSLATEBLUE=i(a.fromCssColorString("#483D8B")),a.DARKSLATEGRAY=i(a.fromCssColorString("#2F4F4F")),a.DARKSLATEGREY=a.DARKSLATEGRAY,a.DARKTURQUOISE=i(a.fromCssColorString("#00CED1")),a.DARKVIOLET=i(a.fromCssColorString("#9400D3")),a.DEEPPINK=i(a.fromCssColorString("#FF1493")),a.DEEPSKYBLUE=i(a.fromCssColorString("#00BFFF")),a.DIMGRAY=i(a.fromCssColorString("#696969")),a.DIMGREY=a.DIMGRAY,a.DODGERBLUE=i(a.fromCssColorString("#1E90FF")),a.FIREBRICK=i(a.fromCssColorString("#B22222")),a.FLORALWHITE=i(a.fromCssColorString("#FFFAF0")),a.FORESTGREEN=i(a.fromCssColorString("#228B22")),a.FUCHSIA=i(a.fromCssColorString("#FF00FF")),a.GAINSBORO=i(a.fromCssColorString("#DCDCDC")),a.GHOSTWHITE=i(a.fromCssColorString("#F8F8FF")),a.GOLD=i(a.fromCssColorString("#FFD700")),a.GOLDENROD=i(a.fromCssColorString("#DAA520")),a.GRAY=i(a.fromCssColorString("#808080")),a.GREEN=i(a.fromCssColorString("#008000")),a.GREENYELLOW=i(a.fromCssColorString("#ADFF2F")),a.GREY=a.GRAY,a.HONEYDEW=i(a.fromCssColorString("#F0FFF0")),a.HOTPINK=i(a.fromCssColorString("#FF69B4")),a.INDIANRED=i(a.fromCssColorString("#CD5C5C")),a.INDIGO=i(a.fromCssColorString("#4B0082")),a.IVORY=i(a.fromCssColorString("#FFFFF0")),a.KHAKI=i(a.fromCssColorString("#F0E68C")),a.LAVENDER=i(a.fromCssColorString("#E6E6FA")),a.LAVENDAR_BLUSH=i(a.fromCssColorString("#FFF0F5")),a.LAWNGREEN=i(a.fromCssColorString("#7CFC00")),a.LEMONCHIFFON=i(a.fromCssColorString("#FFFACD")),a.LIGHTBLUE=i(a.fromCssColorString("#ADD8E6")),a.LIGHTCORAL=i(a.fromCssColorString("#F08080")),a.LIGHTCYAN=i(a.fromCssColorString("#E0FFFF")),a.LIGHTGOLDENRODYELLOW=i(a.fromCssColorString("#FAFAD2")),a.LIGHTGRAY=i(a.fromCssColorString("#D3D3D3")),a.LIGHTGREEN=i(a.fromCssColorString("#90EE90")),a.LIGHTGREY=a.LIGHTGRAY,a.LIGHTPINK=i(a.fromCssColorString("#FFB6C1")),a.LIGHTSEAGREEN=i(a.fromCssColorString("#20B2AA")),a.LIGHTSKYBLUE=i(a.fromCssColorString("#87CEFA")),a.LIGHTSLATEGRAY=i(a.fromCssColorString("#778899")),a.LIGHTSLATEGREY=a.LIGHTSLATEGRAY,a.LIGHTSTEELBLUE=i(a.fromCssColorString("#B0C4DE")),a.LIGHTYELLOW=i(a.fromCssColorString("#FFFFE0")),a.LIME=i(a.fromCssColorString("#00FF00")),a.LIMEGREEN=i(a.fromCssColorString("#32CD32")),a.LINEN=i(a.fromCssColorString("#FAF0E6")),a.MAGENTA=i(a.fromCssColorString("#FF00FF")),a.MAROON=i(a.fromCssColorString("#800000")),a.MEDIUMAQUAMARINE=i(a.fromCssColorString("#66CDAA")),a.MEDIUMBLUE=i(a.fromCssColorString("#0000CD")),a.MEDIUMORCHID=i(a.fromCssColorString("#BA55D3")),a.MEDIUMPURPLE=i(a.fromCssColorString("#9370DB")),a.MEDIUMSEAGREEN=i(a.fromCssColorString("#3CB371")),a.MEDIUMSLATEBLUE=i(a.fromCssColorString("#7B68EE")),a.MEDIUMSPRINGGREEN=i(a.fromCssColorString("#00FA9A")),a.MEDIUMTURQUOISE=i(a.fromCssColorString("#48D1CC")),a.MEDIUMVIOLETRED=i(a.fromCssColorString("#C71585")),a.MIDNIGHTBLUE=i(a.fromCssColorString("#191970")),a.MINTCREAM=i(a.fromCssColorString("#F5FFFA")),a.MISTYROSE=i(a.fromCssColorString("#FFE4E1")),a.MOCCASIN=i(a.fromCssColorString("#FFE4B5")),a.NAVAJOWHITE=i(a.fromCssColorString("#FFDEAD")),a.NAVY=i(a.fromCssColorString("#000080")),a.OLDLACE=i(a.fromCssColorString("#FDF5E6")),a.OLIVE=i(a.fromCssColorString("#808000")),a.OLIVEDRAB=i(a.fromCssColorString("#6B8E23")),a.ORANGE=i(a.fromCssColorString("#FFA500")),a.ORANGERED=i(a.fromCssColorString("#FF4500")),a.ORCHID=i(a.fromCssColorString("#DA70D6")),a.PALEGOLDENROD=i(a.fromCssColorString("#EEE8AA")),a.PALEGREEN=i(a.fromCssColorString("#98FB98")),a.PALETURQUOISE=i(a.fromCssColorString("#AFEEEE")),a.PALEVIOLETRED=i(a.fromCssColorString("#DB7093")),a.PAPAYAWHIP=i(a.fromCssColorString("#FFEFD5")),a.PEACHPUFF=i(a.fromCssColorString("#FFDAB9")),a.PERU=i(a.fromCssColorString("#CD853F")),a.PINK=i(a.fromCssColorString("#FFC0CB")),a.PLUM=i(a.fromCssColorString("#DDA0DD")),a.POWDERBLUE=i(a.fromCssColorString("#B0E0E6")),
a.PURPLE=i(a.fromCssColorString("#800080")),a.RED=i(a.fromCssColorString("#FF0000")),a.ROSYBROWN=i(a.fromCssColorString("#BC8F8F")),a.ROYALBLUE=i(a.fromCssColorString("#4169E1")),a.SADDLEBROWN=i(a.fromCssColorString("#8B4513")),a.SALMON=i(a.fromCssColorString("#FA8072")),a.SANDYBROWN=i(a.fromCssColorString("#F4A460")),a.SEAGREEN=i(a.fromCssColorString("#2E8B57")),a.SEASHELL=i(a.fromCssColorString("#FFF5EE")),a.SIENNA=i(a.fromCssColorString("#A0522D")),a.SILVER=i(a.fromCssColorString("#C0C0C0")),a.SKYBLUE=i(a.fromCssColorString("#87CEEB")),a.SLATEBLUE=i(a.fromCssColorString("#6A5ACD")),a.SLATEGRAY=i(a.fromCssColorString("#708090")),a.SLATEGREY=a.SLATEGRAY,a.SNOW=i(a.fromCssColorString("#FFFAFA")),a.SPRINGGREEN=i(a.fromCssColorString("#00FF7F")),a.STEELBLUE=i(a.fromCssColorString("#4682B4")),a.TAN=i(a.fromCssColorString("#D2B48C")),a.TEAL=i(a.fromCssColorString("#008080")),a.THISTLE=i(a.fromCssColorString("#D8BFD8")),a.TOMATO=i(a.fromCssColorString("#FF6347")),a.TURQUOISE=i(a.fromCssColorString("#40E0D0")),a.VIOLET=i(a.fromCssColorString("#EE82EE")),a.WHEAT=i(a.fromCssColorString("#F5DEB3")),a.WHITE=i(a.fromCssColorString("#FFFFFF")),a.WHITESMOKE=i(a.fromCssColorString("#F5F5F5")),a.YELLOW=i(a.fromCssColorString("#FFFF00")),a.YELLOWGREEN=i(a.fromCssColorString("#9ACD32")),a.TRANSPARENT=i(new a(0,0,0,0)),a}),define("Scene/MvtFilter",["../Core/defaultValue","../Core/defined"],function(t,e){"use strict";function r(){}function n(t){var e=null,r=null,n=null;return i(t[0])?(n=t[0],t.length>1&&(r=t[1],"$"===r[0])?null:(t.length>2&&(e=t[2]),{filterOperator:n,filterFieldName:r,filterCompareValue:e})):null}function i(t){return-1!==["==","===",">=","<=",">","<","!=","has"].indexOf(t)}function o(t,e,r){return t[e]==r}function s(t,e,r){return t[e]>r}function a(t,e,r){return t[e]<r}function l(t,e,r){return t[e]>=r}function h(t,e,r){return t[e]<=r}function u(t,e,r){return t[e]!=r}function c(t,r){return e(t[r])}r.parseLayerFilter=function(t){if(!(e(t)&&t instanceof Array))return null;var r,o=[];if(i(t[0]))r=n(t),e(r)&&o.push(r);else for(var s=0;s<t.length;s++)if(t[s]instanceof Array)if(3!==t[s].length)for(var a=0;a<t[s].length;a++)t[s][a]instanceof Array&&3===t[s][a].length&&(r=n(t[s][a]),e(r)&&o.push(r));else r=n(t[s]),e(r)&&o.push(r);return o},r.filterTest=function(t,e){for(var r=0,n=e.length;r<n;r++){var i=e[r];if(!f[i.filterOperator](t,i.filterFieldName,i.filterCompareValue))return!1}return!0};var f={"==":o,"===":o,">":s,"<":a,">=":l,"<=":h,"!=":u,has:c};return r}),define("Scene/MvtStyle",["../Core/Color","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError"],function(t,e,r,n,i){"use strict";function o(t,e){if(!t)throw new i("need include ol-debug.js");this._useOffscreen=e,this._openlayer=t}function s(t){var e=t.substring(t.indexOf("(")+1,t.indexOf(")"));e=e.split(",");var r=[];return r.push(parseFloat(e[0])),r.push(parseFloat(e[1])),r.push(parseFloat(e[2])),r.push(parseFloat(e[3])),r}function a(t,e){if(t&&void 0!==e){var r={color:[255*t[0]/t[3],255*t[1]/t[3],255*t[2]/t[3],t[3]],opacity:t[3]};t=r.color,t[3]=r.opacity*e,0===t[3]&&(t=void 0)}return t}function l(t,e){var r=Math.floor(t/65536),n=t-65536*r,i=Math.floor(n/256),o=n-256*i;return c.red=o/256,c.green=i/256,c.blue=r/256,c.alpha=1,c}function h(t,e){var r;do{if(r=t.match(f)){const n=e[r[2]]||"";t=r[1]+n+r[3]}}while(r);return t}function u(t){var e=[.5,.5];return["top-left","top-right","bottom-left","bottom-right"].includes(t)&&(e=[0,0]),"left"===t&&(t="top-left",e=[0,.5]),"right"===t&&(t="top-left",e=[1,.5]),"bottom"===t&&(t="top-left",e=[.5,1]),"top"===t&&(t="top-left",e=[.5,0]),{anchorOffset:e,iconAnchor:t}}n(o.prototype,{proxy:{get:function(){}}}),o.prototype.getStyle=function(){var t=this._openlayer,e=new t.style.Fill({color:""});e.setColor("#ffffff");var r=new t.style.Stroke({color:"",width:1});return r.setWidth(1),r.setColor("#000000"),new t.style.Style({fill:e,stroke:r})},o.prototype.getStyleByMapboxStyle=function(t){var e=this._openlayer,n=t.type,i=t.paint,o=t.layout;if(!r(n)||!r(i))return this.getStyle();if("fill"==n){var l=new e.style.Style({}),h=new e.style.Fill({color:"[255,255,255,1]"});l.setFill(h);var u=i["fill-opacity"];if(r(i["fill-color"])){var c=s(i["fill-color"]);r(u)&&(c[3]*=u),h.setColor(c)}if(r(i["fill-outline-color"])){var f=new e.style.Stroke({color:"",width:1});f.setColor(i["fill-outline-color"]),l.setStroke(f)}return r(i["fill-pattern"])&&(l.fillPatternName=i["fill-pattern"]),l}if("line"==n){var d=new e.style.Style({}),p=new e.style.Stroke({color:"#000000",width:1});d.setStroke(p);var g=i["line-opacity"];if(r(i["line-color"])){var y=s(i["line-color"]);r(g)&&(y[3]*=g)}if(r(i["line-width"])){var m=i["line-width"];p.setWidth(m)}if(r(i["line-dasharray"])){var v=i["line-dasharray"];p.setLineDash(v)}if(r(o)){if(r(o["line-cap"])){var _=o["line-cap"];p.setLineCap(_)}if(r(o["line-join"])){var S=o["line-join"];p.setLineJoin(S)}if(r(o["line-miter-limit"])){var C=o["line-miter-limit"];p.setMiterLimit(C)}}return p.setColor(y),d}if("symbol"==n){var x=new e.style.Style({});return r(o)&&r(o["icon-image"])&&(x.hasIconImage=!0),r(o)&&r(o["text-field"])&&(x.hasTextStyle=!0),x}if("circle"==n){var I=i["circle-radius"],E=i["circle-color"],T=i["circle-stroke-color"],R=i["circle-opacity"],O=i["circle-stroke-opacity"],L=i["circle-stroke-width"],F=new e.style.Circle({radius:I,stroke:0===L?void 0:new e.style.Stroke({width:L,color:a(T,O)}),fill:new e.style.Fill({color:a(E,R)})}),w=new e.style.Style({});return w.setImage(F),w}return this.getStyle()};var c=new t;o.prototype.getIDColorStyle=function(t,e,n,i,o,s){var a=this._openlayer,h=l(e,n),u=h.toCssColorString();if("LineString"==t||"LinearRing"==t||"MultiLineString"==t){var c=4;r(i)&&(c=2*i+s);var f=new a.style.Stroke({color:"",width:c});return f.setColor(u),new a.style.Style({stroke:f})}if("Point"==t||"MultiPoint"==t){var d=new a.style.Circle({radius:o-.5,fill:new a.style.Fill({color:u})}),p=new a.style.Style({});return p.setImage(d),p}var g=new a.style.Fill({color:""});g.setColor(u);var y=new a.style.Style({fill:g});if(r(i)){var f=new a.style.Stroke({color:"",width:r(i)?2*i:4});f.setColor(u),y.setStroke(f)}return y};var f=/^([^]*)\{(.*)\}([^]*)$/;o.prototype.getTextStyle=function(t,n,i){var o=this._openlayer,a=i.paint,l=i.layout,u=l["text-field"],c=h(u,n.getProperties());if(r(c)){var f=new o.style.Style,d=new o.style.Text;f.setText(d);var p=l["text-size"],g=e(l["text-font"],["Open Sans Regular","Arial Unicode MS Regular"]),y=l["text-transform"];"uppercase"==y?c=c.toUpperCase():"lowercase"==y&&(c=c.toLowerCase());var m=(e(l["text-max-width"],10),c);d.setText(m),d.setFont(g),d.setRotation(0);var v=e(l["text-anchor"],"center"),_=e(l["symbol-placement"],"point");if(d.setPlacement(_),"point"==_){var S="center";-1!==v.indexOf("left")?S="left":-1!==v.indexOf("right")&&(S="right"),d.setTextAlign(S)}else d.setTextAlign();var C="middle";0==v.indexOf("bottom")?C="bottom":0==v.indexOf("top")&&(C="top"),d.setTextBaseline(C);var x=e(l["text-offset"],[0,0]),I=e(l["text-translate"],[0,0]);d.setOffsetX(x[0]*p+I[0]),d.setOffsetY(x[1]*p+I[1]);var E=(a["text-opacity"],new o.style.Fill),T=a["text-color"];r(T)&&(T=s(T),E.setColor(T)),d.setFill(E);var R=a["text-halo-color"];if(r(R)){var O=new o.style.Stroke;R=s(R),O.setColor(R),O.setWidth(a["text-halo-width"]),d.setStroke(O)}else d.setStroke(void 0);return f.setZIndex(t.getZIndex()),f.hasIconImage=t.hasIconImage,f.textSize=p,f}};var d={};return o.prototype.setIconImageForStyle=function(t,n,i){var o=this._openlayer,s=i.paint,a=i.layout,l=e(a["icon-size"],1),h=s["icon-color"],c=e(s["icon-translate"],[0,0]),f=e(s["icon-translate-anchor"],"map"),p=e(a["icon-anchor"],"center"),g=u(p),y=g.anchorOffset,m=e(a.iconoffset,[0,0]),v=e(a["icon-opacity"],1),_=a["icon-image"];if(!r(t[_]))return void console.log("miss icon-image "+_);var S=_+"."+l+"."+c+"."+f+"."+p+"."+m;r(h)&&(S+="."+h);var C=d[S];if(!r(C)){var x,I=t[_];this._useOffscreen?x=new OffscreenCanvas(I.width,I.height):(x=document.createElement("canvas"),x.width=I.width,x.height=I.height);x.getContext("2d").putImageData(I,0,0);var E=[c[0]/I.width,c[1]/I.height];C=new o.style.Icon({img:x,anchorOrigin:g.iconAnchor,anchor:[m[0]+y[0]+E[0],m[1]+y[1]-E[1]],imgSize:[x.width,x.height],scale:l}),C.setOpacity(v),d[S]=C}n.setImage(C)},o}),define("Scene/MvtRenderer2D",["../Core/defaultValue","../Core/defined","../Core/defineProperties","./MvtFilter"],function(t,e,r,n){"use strict";function i(t){this._mvtStyleClass=t.mvtStyle,this._openlayer=t.openlayer}function o(t){var e=t.getId();return e-=16777216*Math.floor(e/16777216)}var s=["Default","Polygon","LineString","Image","Symbol","Text"];return r(i.prototype,{}),i.prototype.renderFeatures=function(t){for(var r=t.colorCanvas,i=t.idCanvas,o=t.transform,a=t.layers,l=t.features,h=t.tileLevel,u=t.spriteImageCanvas,c=t.spriteImageDatas,f=t.squaredTolerance,d=t.showBillboard,p=t.renderID,g=t.renderColor,y=t.lineWidthExpand,m=this._openlayer,v=r.getContext("2d"),_=[],S=[],C=[],x=null,I=m.ext.rbush(9),E=new m.render.canvas.ReplayGroup(0,[0,0,4096,4096],8,2,!0,I),T=l.length,R=0;R<T;R++){var O=l[R],L=O.getProperties().layer;O.index=L+O.getId();var F=!1,w=a[L],M=0;for(var A in w){var G=w[A],b=G.mapboxStyleLayer.maxzoom;if(!(h<G.mapboxStyleLayer.minzoom||h>b)){var P=G.filterArray;if(e(P)){var D=O.getProperties();if(!n.filterTest(D,P))continue;x=this._mvtStyleClass.getStyleByMapboxStyle(G.mapboxStyleLayer)}else x=this._mvtStyleClass.getStyleByMapboxStyle(G.mapboxStyleLayer);if(e(x)){if(this.createFillPatternForStyle(x,u,c,v),e(x.hasTextStyle)){var k=this._mvtStyleClass.getTextStyle(x,O,G.mapboxStyleLayer);k.setZIndex(M),d?C.push({feature:O,style:k}):g&&m.renderer.vector.renderFeature_(E,O,k,-1)}if(e(x.hasIconImage)&&!e(x.getImage())){if(d){S.push({feature:O,style:G.mapboxStyleLayer});continue}this._mvtStyleClass.setIconImageForStyle(c,x,G.mapboxStyleLayer)}x.setZIndex(M),this.setPickStyleInFeature(O,x),M++,g&&m.renderer.vector.renderFeature_(E,O,x,-1),F=!0}}}F&&_.push(O)}if(g){E.finish();var N={};E.replay(v,o,0,{},s,N),N&&m.render.canvas.ReplayGroup.replayDeclutter(N,v,0)}return E=null,p&&this.renderIDtoTexture(o,i,_,0,f,y),{idFeatures:_,iconImageObjects:S,textObjects:C}},i.prototype.renderIDtoTexture=function(t,e,r,n,i,a){for(var l=this._openlayer,h=e.getContext("2d"),u=l.ext.rbush(9),c=new l.render.canvas.ReplayGroup(0,[0,0,4096,4096],8,2,!0,u),f=r.length,d=0;d<f;d++){var p=r[d],g=o(p),y=this._mvtStyleClass.getIDColorStyle(p.getGeometry().getType(),g,n,p.lineWidth,p.radius,a);y.setZIndex(p.zIndex),l.renderer.vector.renderFeature_(c,p,y,-1)}c.finish();var m={};c.replay(h,t,0,{},s,m),m&&l.render.canvas.ReplayGroup.replayDeclutter(m,h,0),c=null},i.prototype.createFillPatternForStyle=function(t,r,n,i){if(e(t.fillPatternName)){var o=t.fillPatternName,s=null;if(e(r[o]))s=r[o];else{var a=n[o];if(!e(a))return void console.log("miss sprite "+o);s=document.createElement("canvas"),s.width=a.width,s.height=a.height;s.getContext("2d").putImageData(a,0,0),r[o]=s}t.fill_.color_=i.createPattern(s,"repeat")}},i.prototype.setPickStyleInFeature=function(t,r){var n=this._openlayer;if(t.zIndex=r.getZIndex(),e(r.getStroke())){var i=r.getStroke().getWidth();e(t.lineWidth)?t.lineWidth=Math.max(t.lineWidth,i):t.lineWidth=i}if(e(r.getImage())){var o=r.getImage(),s=1;if(o instanceof n.style.Icon){var a=o.getImageSize();s=Math.max(a[0],a[1])/2,s-=1}else o instanceof n.style.Circle&&(s=o.getRadius());e(t.radius)?t.radius=Math.max(t.radius,s):t.radius=s}},i}),define("ThirdParty/pbf",[],function(){function t(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}function e(t,e,r){var i,o,s=r.buf;if(o=s[r.pos++],i=(112&o)>>4,o<128)return n(t,i,e);if(o=s[r.pos++],i|=(127&o)<<3,o<128)return n(t,i,e);if(o=s[r.pos++],i|=(127&o)<<10,o<128)return n(t,i,e);if(o=s[r.pos++],i|=(127&o)<<17,o<128)return n(t,i,e);if(o=s[r.pos++],i|=(127&o)<<24,o<128)return n(t,i,e);if(o=s[r.pos++],i|=(1&o)<<31,o<128)return n(t,i,e);throw new Error("Expected varint not more than 10 bytes")}function r(e){return e.type===t.Bytes?e.readVarint()+e.pos:e.pos+1}function n(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function i(t,e){var r,n;if(t>=0?(r=t%4294967296|0,n=t/4294967296|0):(r=~(-t%4294967296),n=~(-t/4294967296),4294967295^r?r=r+1|0:(r=0,n=n+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),o(r,n,e),s(n,e)}function o(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos]=127&t}function s(t,e){var r=(7&t)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}function a(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;i>=t;i--)r.buf[i+n]=r.buf[i]}function l(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function h(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function u(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function c(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function f(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function d(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function p(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function g(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function y(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function m(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function v(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function _(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function S(t,e,r){for(var n="",i=e;i<r;){var o=t[i],s=null,a=o>239?4:o>223?3:o>191?2:1;if(i+a>r)break;var l,h,u;1===a?o<128&&(s=o):2===a?128==(192&(l=t[i+1]))&&(s=(31&o)<<6|63&l)<=127&&(s=null):3===a?(l=t[i+1],h=t[i+2],128==(192&l)&&128==(192&h)&&((s=(15&o)<<12|(63&l)<<6|63&h)<=2047||s>=55296&&s<=57343)&&(s=null)):4===a&&(l=t[i+1],h=t[i+2],u=t[i+3],128==(192&l)&&128==(192&h)&&128==(192&u)&&((s=(15&o)<<18|(63&l)<<12|(63&h)<<6|63&u)<=65535||s>=1114112)&&(s=null)),null===s?(s=65533,a=1):s>65535&&(s-=65536,n+=String.fromCharCode(s>>>10&1023|55296),s=56320|1023&s),n+=String.fromCharCode(s),i+=a}return n}function C(t,e,r){for(var n,i,o=0;o<e.length;o++){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){n>56319||o+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):i=n;continue}if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(t[r++]=239,t[r++]=191,t[r++]=189,i=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=63&n|128)}return r}var x=function(t,e,r,n,i){var o,s,a=8*i-n-1,l=(1<<a)-1,h=l>>1,u=-7,c=r?i-1:0,f=r?-1:1,d=t[e+c];for(c+=f,o=d&(1<<-u)-1,d>>=-u,u+=a;u>0;o=256*o+t[e+c],c+=f,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=n;u>0;s=256*s+t[e+c],c+=f,u-=8);if(0===o)o=1-h;else{if(o===l)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,n),o-=h}return(d?-1:1)*s*Math.pow(2,o-n)},I=function(t,e,r,n,i,o){var s,a,l,h=8*o-i-1,u=(1<<h)-1,c=u>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,p=n?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),e+=s+c>=1?f/l:f*Math.pow(2,1-c),e*l>=2&&(s++,l/=2),s+c>=u?(a=0,s=u):s+c>=1?(a=(e*l-1)*Math.pow(2,i),s+=c):(a=e*Math.pow(2,c-1)*Math.pow(2,i),s=0));i>=8;t[r+d]=255&a,d+=p,a/=256,i-=8);for(s=s<<i|a,h+=i;h>0;t[r+d]=255&s,d+=p,s/=256,h-=8);t[r+d-p]|=128*g},E={read:x,write:I};t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;return t.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,o=this.pos;this.type=7&n,t(i,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=m(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=_(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=m(this.buf,this.pos)+4294967296*m(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=m(this.buf,this.pos)+4294967296*_(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=E.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=E.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var r,n,i=this.buf;return n=i[this.pos++],r=127&n,n<128?r:(n=i[this.pos++],r|=(127&n)<<7,n<128?r:(n=i[this.pos++],r|=(127&n)<<14,n<128?r:(n=i[this.pos++],r|=(127&n)<<21,n<128?r:(n=i[this.pos],r|=(15&n)<<28,e(r,t,this)))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=S(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var n=r(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=r(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(e){var r=7&e;if(r===t.Varint)for(;this.buf[this.pos++]>127;);else if(r===t.Bytes)this.pos=this.readVarint()+this.pos;else if(r===t.Fixed32)this.pos+=4;else{if(r!==t.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),v(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),v(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),v(this.buf,-1&t,this.pos),v(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),v(this.buf,-1&t,this.pos),v(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){if((t=+t||0)>268435455||t<0)return void i(t,this);this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=C(this.buf,t,this.pos);var r=this.pos-e;r>=128&&a(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),E.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),E.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var n=this.pos-r;n>=128&&a(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,r,n){this.writeTag(e,t.Bytes),this.writeRawMessage(r,n)},writePackedVarint:function(t,e){this.writeMessage(t,l,e)},writePackedSVarint:function(t,e){this.writeMessage(t,h,e)},writePackedBoolean:function(t,e){this.writeMessage(t,f,e)},writePackedFloat:function(t,e){this.writeMessage(t,u,e)},writePackedDouble:function(t,e){this.writeMessage(t,c,e)},writePackedFixed32:function(t,e){this.writeMessage(t,d,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,p,e)},writePackedFixed64:function(t,e){this.writeMessage(t,g,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,y,e)},writeBytesField:function(e,r){this.writeTag(e,t.Bytes),this.writeBytes(r)},writeFixed32Field:function(e,r){this.writeTag(e,t.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(e,r){this.writeTag(e,t.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(e,r){this.writeTag(e,t.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(e,r){this.writeTag(e,t.Fixed64),this.writeSFixed64(r)},writeVarintField:function(e,r){this.writeTag(e,t.Varint),this.writeVarint(r)},writeSVarintField:function(e,r){this.writeTag(e,t.Varint),this.writeSVarint(r)},writeStringField:function(e,r){this.writeTag(e,t.Bytes),this.writeString(r)},writeFloatField:function(e,r){this.writeTag(e,t.Fixed32),this.writeFloat(r)},writeDoubleField:function(e,r){this.writeTag(e,t.Fixed64),this.writeDouble(r)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}},t}),define("ThirdParty/supermap3D-openlayer-4.6.5",["./pbf"],function(t){"use strict";function e(){}e.array={},e.array.binarySearch=function(t,r,n){for(var i,o,s=n||e.array.numberSafeCompareFunction,a=0,l=t.length,h=!1;a<l;)i=a+(l-a>>1),o=+s(t[i],r),o<0?a=i+1:(l=i,h=!o);return h?a:~a},e.array.numberSafeCompareFunction=function(t,e){return t>e?1:t<e?-1:0},e.array.includes=function(t,e){return t.indexOf(e)>=0},e.array.linearFindNearest=function(t,e,r){var n=t.length;if(t[0]<=e)return 0;if(e<=t[n-1])return n-1;var i;if(r>0){for(i=1;i<n;++i)if(t[i]<e)return i-1}else if(r<0){for(i=1;i<n;++i)if(t[i]<=e)return i}else for(i=1;i<n;++i){if(t[i]==e)return i;if(t[i]<e)return t[i-1]-e<e-t[i]?i-1:i}return n-1},e.array.reverseSubArray=function(t,e,r){for(;e<r;){var n=t[e];t[e]=t[r],t[r]=n,++e,--r}},e.array.extend=function(t,e){var r,n=Array.isArray(e)?e:[e],i=n.length;for(r=0;r<i;r++)t[t.length]=n[r]},e.array.remove=function(t,e){var r=t.indexOf(e),n=r>-1;return n&&t.splice(r,1),n},e.array.find=function(t,e){for(var r,n=t.length>>>0,i=0;i<n;i++)if(r=t[i],e(r,i,t))return r;return null},e.array.equals=function(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0},e.array.stableSort=function(t,e){var r,n=t.length,i=Array(t.length);for(r=0;r<n;r++)i[r]={index:r,value:t[r]};for(i.sort(function(t,r){return e(t.value,r.value)||t.index-r.index}),r=0;r<t.length;r++)t[r]=i[r].value},e.array.findIndex=function(t,e){var r;return t.every(function(n,i){return r=i,!e(n,i,t)})?-1:r},e.array.isSorted=function(t,r,n){var i=r||e.array.numberSafeCompareFunction;return t.every(function(e,r){if(0===r)return!0;var o=i(t[r-1],e);return!(o>0||n&&0===o)})},e.ASSUME_TOUCH=!1,e.DEFAULT_MAX_ZOOM=42,e.DEFAULT_MIN_ZOOM=0,e.DEFAULT_RASTER_REPROJECTION_ERROR_THRESHOLD=.5,e.DEFAULT_TILE_SIZE=256,e.DEFAULT_WMS_VERSION="1.3.0",e.ENABLE_CANVAS=!0,e.ENABLE_PROJ4JS=!0,e.ENABLE_RASTER_REPROJECTION=!0,e.ENABLE_WEBGL=!0,e.DEBUG_WEBGL=!0,e.INITIAL_ATLAS_SIZE=256,e.MAX_ATLAS_SIZE=-1,e.MOUSEWHEELZOOM_MAXDELTA=1,e.OVERVIEWMAP_MAX_RATIO=.75,e.OVERVIEWMAP_MIN_RATIO=.1,e.RASTER_REPROJECTION_MAX_SOURCE_TILES=100,e.RASTER_REPROJECTION_MAX_SUBDIVISION=10,e.RASTER_REPROJECTION_MAX_TRIANGLE_WIDTH=.25,e.SIMPLIFY_TOLERANCE=.5,e.WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK=1024,e.VERSION="",e.inherits=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},e.nullFunction=function(){},e.getUid=function(t){return t.ol_uid||(t.ol_uid=++e.uidCounter_)},e.asserts={},e.asserts.assert=function(t,e){},e.has={};var r="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"";return e.has.FIREFOX=-1!==r.indexOf("firefox"),e.has.SAFARI=-1!==r.indexOf("safari")&&-1==r.indexOf("chrom"),e.has.WEBKIT=-1!==r.indexOf("webkit")&&-1==r.indexOf("edge"),e.has.MAC=-1!==r.indexOf("macintosh"),e.has.DEVICE_PIXEL_RATIO=1,e.has.CANVAS_LINE_DASH=!0,e.structs={},e.CollectionEventType={ADD:"add",REMOVE:"remove"},e.ObjectEventType={PROPERTYCHANGE:"propertychange"},e.events={},e.events.bindListener_=function(t){var r=function(r){var n=t.listener,i=t.bindTo||t.target;return t.callOnce&&e.events.unlistenByKey(t),n.call(i,r)};return t.boundListener=r,r},e.events.findListener_=function(t,e,r,n){for(var i,o=0,s=t.length;o<s;++o)if(i=t[o],i.listener===e&&i.bindTo===r)return n&&(i.deleteIndex=o),i},e.events.getListeners=function(t,e){var r=t.ol_lm;return r?r[e]:void 0},e.events.getListenerMap_=function(t){var e=t.ol_lm;return e||(e=t.ol_lm={}),e},e.events.removeListeners_=function(t,r){var n=e.events.getListeners(t,r);if(n){for(var i=0,o=n.length;i<o;++i)t.removeEventListener(r,n[i].boundListener),e.obj.clear(n[i]);n.length=0;var s=t.ol_lm;s&&(delete s[r],0===Object.keys(s).length&&delete t.ol_lm)}},e.events.listen=function(t,r,n,i,o){var s=e.events.getListenerMap_(t),a=s[r];a||(a=s[r]=[]);var l=e.events.findListener_(a,n,i,!1);return l?o||(l.callOnce=!1):(l={bindTo:i,callOnce:!!o,listener:n,target:t,type:r},t.addEventListener(r,e.events.bindListener_(l)),a.push(l)),l},e.events.listenOnce=function(t,r,n,i){return e.events.listen(t,r,n,i,!0)},e.events.unlisten=function(t,r,n,i){var o=e.events.getListeners(t,r);if(o){var s=e.events.findListener_(o,n,i,!0);s&&e.events.unlistenByKey(s)}},e.events.unlistenByKey=function(t){if(t&&t.target){t.target.removeEventListener(t.type,t.boundListener);var r=e.events.getListeners(t.target,t.type);if(r){var n="deleteIndex"in t?t.deleteIndex:r.indexOf(t);-1!==n&&r.splice(n,1),0===r.length&&e.events.removeListeners_(t.target,t.type)}e.obj.clear(t)}},e.events.unlistenAll=function(t){var r=e.events.getListenerMap_(t);for(var n in r)e.events.removeListeners_(t,n)},e.Disposable=function(){},e.Disposable.prototype.disposed_=!1,e.Disposable.prototype.dispose=function(){this.disposed_||(this.disposed_=!0,this.disposeInternal())},e.Disposable.prototype.disposeInternal=e.nullFunction,e.events.Event={},e.events.Event=function(t){this.propagationStopped,this.type=t,this.target=null},e.events.Event.prototype.preventDefault=e.events.Event.prototype.stopPropagation=function(){this.propagationStopped=!0},e.events.Event.stopPropagation=function(t){t.stopPropagation()},e.events.Event.preventDefault=function(t){t.preventDefault()},e.events.EventTarget={},e.events.EventTarget=function(){e.Disposable.call(this),this.pendingRemovals_={},this.dispatching_={},this.listeners_={}},e.inherits(e.events.EventTarget,e.Disposable),e.events.EventTarget.prototype.addEventListener=function(t,e){var r=this.listeners_[t];r||(r=this.listeners_[t]=[]),-1===r.indexOf(e)&&r.push(e)},e.events.EventTarget.prototype.dispatchEvent=function(t){var r="string"==typeof t?new e.events.Event(t):t,n=r.type;r.target=this;var i,o=this.listeners_[n];if(o){n in this.dispatching_||(this.dispatching_[n]=0,this.pendingRemovals_[n]=0),++this.dispatching_[n];for(var s=0,a=o.length;s<a;++s)if(!1===o[s].call(this,r)||r.propagationStopped){i=!1;break}if(0===--this.dispatching_[n]){var l=this.pendingRemovals_[n];for(delete this.pendingRemovals_[n];l--;)this.removeEventListener(n,e.nullFunction);delete this.dispatching_[n]}return i}},e.events.EventTarget.prototype.disposeInternal=function(){e.events.unlistenAll(this)},e.events.EventTarget.prototype.getListeners=function(t){return this.listeners_[t]},e.events.EventTarget.prototype.hasListener=function(t){return t?t in this.listeners_:Object.keys(this.listeners_).length>0},e.events.EventTarget.prototype.removeEventListener=function(t,r){var n=this.listeners_[t];if(n){var i=n.indexOf(r);t in this.pendingRemovals_?(n[i]=e.nullFunction,++this.pendingRemovals_[t]):(n.splice(i,1),0===n.length&&delete this.listeners_[t])}},e.events.EventType={CHANGE:"change",CLEAR:"clear",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",ERROR:"error",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",MOUSEDOWN:"mousedown",MOUSEMOVE:"mousemove",MOUSEOUT:"mouseout",MOUSEUP:"mouseup",MOUSEWHEEL:"mousewheel",MSPOINTERDOWN:"MSPointerDown",RESIZE:"resize",TOUCHSTART:"touchstart",TOUCHMOVE:"touchmove",TOUCHEND:"touchend",WHEEL:"wheel"},e.Observable=function(){this.revision_=0},e.inherits(e.Observable,e.events.EventTarget),e.Observable.unByKey=function(t){if(Array.isArray(t))for(var r=0,n=t.length;r<n;++r)e.events.unlistenByKey(t[r]);else e.events.unlistenByKey(t)},e.Observable.prototype.changed=function(){++this.revision_},e.Observable.prototype.dispatchEvent,e.Observable.prototype.getRevision=function(){return this.revision_},e.Observable.prototype.on=function(t,r,n){if(Array.isArray(t)){for(var i=t.length,o=new Array(i),s=0;s<i;++s)o[s]=e.events.listen(this,t[s],r,n);return o}return e.events.listen(this,t,r,n)},e.Observable.prototype.once=function(t,r,n){if(Array.isArray(t)){for(var i=t.length,o=new Array(i),s=0;s<i;++s)o[s]=e.events.listenOnce(this,t[s],r,n);return o}return e.events.listenOnce(this,t,r,n)},e.Observable.prototype.un=function(t,r,n){if(Array.isArray(t))for(var i=0,o=t.length;i<o;++i)e.events.unlisten(this,t[i],r,n);else e.events.unlisten(this,t,r,n)},e.uidCounter_=0,e.Object=function(t){e.Observable.call(this),e.getUid(this),this.values_={},void 0!==t&&this.setProperties(t)},e.inherits(e.Object,e.Observable),e.Object.changeEventTypeCache_={},e.Object.getChangeEventType=function(t){return e.Object.changeEventTypeCache_.hasOwnProperty(t)?e.Object.changeEventTypeCache_[t]:e.Object.changeEventTypeCache_[t]="change:"+t},e.Object.prototype.get=function(t){var e;return this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e},e.Object.prototype.getKeys=function(){return Object.keys(this.values_)},e.Object.prototype.getProperties=function(){return e.obj.assign({},this.values_)},e.Object.prototype.notify=function(t,e){return},e.Object.prototype.set=function(t,e,r){if(r)this.values_[t]=e;else{var n=this.values_[t];this.values_[t]=e,n!==e&&this.notify(t,n)}},e.Object.prototype.setProperties=function(t,e){var r;for(r in t)this.set(r,t[r],e)},e.Object.prototype.unset=function(t,e){if(t in this.values_){var r=this.values_[t];delete this.values_[t],e||this.notify(t,r)}},e.Object.Event=function(t,r,n){e.events.Event.call(this,t),this.key=r,this.oldValue=n},e.inherits(e.Object.Event,e.events.Event),e.functions={},e.functions.TRUE=function(){return!0},e.functions.FALSE=function(){return!1},e.math={},e.math.clamp=function(t,e,r){return Math.min(Math.max(t,e),r)},e.math.cosh=function(){return"cosh"in Math?Math.cosh:function(t){var e=Math.exp(t);return(e+1/e)/2}}(),e.math.roundUpToPowerOfTwo=function(t){return e.asserts.assert(0<t,29),Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},e.math.squaredSegmentDistance=function(t,r,n,i,o,s){var a=o-n,l=s-i;if(0!==a||0!==l){var h=((t-n)*a+(r-i)*l)/(a*a+l*l);h>1?(n=o,i=s):h>0&&(n+=a*h,i+=l*h)}return e.math.squaredDistance(t,r,n,i)},e.math.squaredDistance=function(t,e,r,n){var i=r-t,o=n-e;return i*i+o*o},e.math.solveLinearSystem=function(t){for(var e=t.length,r=0;r<e;r++){for(var n=r,i=Math.abs(t[r][r]),o=r+1;o<e;o++){var s=Math.abs(t[o][r]);s>i&&(i=s,n=o)}if(0===i)return null;var a=t[n];t[n]=t[r],t[r]=a;for(var l=r+1;l<e;l++)for(var h=-t[l][r]/t[r][r],u=r;u<e+1;u++)r==u?t[l][u]=0:t[l][u]+=h*t[r][u]}for(var c=new Array(e),f=e-1;f>=0;f--){c[f]=t[f][e]/t[f][f];for(var d=f-1;d>=0;d--)t[d][e]-=t[d][f]*c[f]}return c},e.math.toDegrees=function(t){return 180*t/Math.PI},
e.math.toRadians=function(t){return t*Math.PI/180},e.math.modulo=function(t,e){var r=t%e;return r*e<0?r+e:r},e.math.lerp=function(t,e,r){return t+r*(e-t)},e.ImageState={IDLE:0,LOADING:1,LOADED:2,ERROR:3},e.color={},e.color.HEX_COLOR_RE_=/^#(?:[0-9a-f]{3,4}){1,2}$/i,e.color.NAMED_COLOR_RE_=/^([a-z]*)$/i,e.color.asArray=function(t){return Array.isArray(t)?t:e.color.fromString(t)},e.color.asString=function(t){return"string"==typeof t?t:e.color.toString(t)},e.color.fromNamed=function(t){var e=document.createElement("div");e.style.color=t,document.body.appendChild(e);var r=getComputedStyle(e).color;return document.body.removeChild(e),r},e.color.fromString=function(){var t={},r=0;return function(n){var i;if(t.hasOwnProperty(n))i=t[n];else{if(r>=1024){var o,s=0;for(o in t)0==(3&s++)&&(delete t[o],--r)}i=e.color.fromStringInternal_(n),t[n]=i,++r}return i}}(),e.color.fromStringInternal_=function(t){var r,n,i,o,s,a;if(e.color.NAMED_COLOR_RE_.exec(t)&&(t=e.color.fromNamed(t)),e.color.HEX_COLOR_RE_.exec(t)){var l,h=t.length-1;l=h<=4?1:2;var u=4===h||8===h;r=parseInt(t.substr(1+0*l,l),16),n=parseInt(t.substr(1+1*l,l),16),i=parseInt(t.substr(1+2*l,l),16),o=u?parseInt(t.substr(1+3*l,l),16):255,1==l&&(r=(r<<4)+r,n=(n<<4)+n,i=(i<<4)+i,u&&(o=(o<<4)+o)),s=[r,n,i,o/255]}else 0==t.indexOf("rgba(")?(a=t.slice(5,-1).split(",").map(Number),s=e.color.normalize(a)):0==t.indexOf("rgb(")?(a=t.slice(4,-1).split(",").map(Number),a.push(1),s=e.color.normalize(a)):e.asserts.assert(!1,14);return s},e.color.normalize=function(t,r){var n=r||[];return n[0]=e.math.clamp(t[0]+.5|0,0,255),n[1]=e.math.clamp(t[1]+.5|0,0,255),n[2]=e.math.clamp(t[2]+.5|0,0,255),n[3]=e.math.clamp(t[3],0,1),n},e.color.toString=function(t){var e=t[0];e!=(0|e)&&(e=e+.5|0);var r=t[1];r!=(0|r)&&(r=r+.5|0);var n=t[2];return n!=(0|n)&&(n=n+.5|0),"rgba("+e+","+r+","+n+","+(void 0===t[3]?1:t[3])+")"},e.colorlike={},e.colorlike.asColorLike=function(t){return e.colorlike.isColorLike(t)?t:e.color.asString(t)},e.colorlike.isColorLike=function(t){return"string"==typeof t||t instanceof CanvasPattern||t instanceof CanvasGradient},e.css={},e.css.CLASS_HIDDEN="ol-hidden",e.css.CLASS_SELECTABLE="ol-selectable",e.css.CLASS_UNSELECTABLE="ol-unselectable",e.css.CLASS_UNSUPPORTED="ol-unsupported",e.css.CLASS_CONTROL="ol-control",e.css.getFontFamilies=function(){var t,e={};return function(r){if(t||(t=document.createElement("div").style),!(r in e)){t.font=r;var n=t.fontFamily;if(t.font="",!n)return null;e[r]=n.split(/,\s?/)}return e[r]}}(),e.dom={},e.dom.createCanvasContext2D=function(t,e){var r;return r=t&&e?new OffscreenCanvas(t,e):new OffscreenCanvas(1,1),r.getContext("2d")},e.dom.outerWidth=function(t){var e=t.offsetWidth,r=getComputedStyle(t);return e+=parseInt(r.marginLeft,10)+parseInt(r.marginRight,10)},e.dom.outerHeight=function(t){var e=t.offsetHeight,r=getComputedStyle(t);return e+=parseInt(r.marginTop,10)+parseInt(r.marginBottom,10)},e.dom.replaceNode=function(t,e){var r=e.parentNode;r&&r.replaceChild(t,e)},e.dom.removeNode=function(t){return t&&t.parentNode?t.parentNode.removeChild(t):null},e.dom.removeChildren=function(t){for(;t.lastChild;)t.removeChild(t.lastChild)},e.extent={},e.extent.Corner={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},e.extent.Relationship={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16},e.extent.boundingExtent=function(t){for(var r=e.extent.createEmpty(),n=0,i=t.length;n<i;++n)e.extent.extendCoordinate(r,t[n]);return r},e.extent.boundingExtentXYs_=function(t,r,n){var i=Math.min.apply(null,t),o=Math.min.apply(null,r),s=Math.max.apply(null,t),a=Math.max.apply(null,r);return e.extent.createOrUpdate(i,o,s,a,n)},e.extent.buffer=function(t,e,r){return r?(r[0]=t[0]-e,r[1]=t[1]-e,r[2]=t[2]+e,r[3]=t[3]+e,r):[t[0]-e,t[1]-e,t[2]+e,t[3]+e]},e.extent.clone=function(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t.slice()},e.extent.closestSquaredDistanceXY=function(t,e,r){var n,i;return n=e<t[0]?t[0]-e:t[2]<e?e-t[2]:0,i=r<t[1]?t[1]-r:t[3]<r?r-t[3]:0,n*n+i*i},e.extent.containsCoordinate=function(t,r){return e.extent.containsXY(t,r[0],r[1])},e.extent.containsExtent=function(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]},e.extent.containsXY=function(t,e,r){return t[0]<=e&&e<=t[2]&&t[1]<=r&&r<=t[3]},e.extent.coordinateRelationship=function(t,r){var n=t[0],i=t[1],o=t[2],s=t[3],a=r[0],l=r[1],h=e.extent.Relationship.UNKNOWN;return a<n?h|=e.extent.Relationship.LEFT:a>o&&(h|=e.extent.Relationship.RIGHT),l<i?h|=e.extent.Relationship.BELOW:l>s&&(h|=e.extent.Relationship.ABOVE),h===e.extent.Relationship.UNKNOWN&&(h=e.extent.Relationship.INTERSECTING),h},e.extent.createEmpty=function(){return[1/0,1/0,-1/0,-1/0]},e.extent.createOrUpdate=function(t,e,r,n,i){return i?(i[0]=t,i[1]=e,i[2]=r,i[3]=n,i):[t,e,r,n]},e.extent.createOrUpdateEmpty=function(t){return e.extent.createOrUpdate(1/0,1/0,-1/0,-1/0,t)},e.extent.createOrUpdateFromCoordinate=function(t,r){var n=t[0],i=t[1];return e.extent.createOrUpdate(n,i,n,i,r)},e.extent.createOrUpdateFromCoordinates=function(t,r){var n=e.extent.createOrUpdateEmpty(r);return e.extent.extendCoordinates(n,t)},e.extent.createOrUpdateFromFlatCoordinates=function(t,r,n,i,o){var s=e.extent.createOrUpdateEmpty(o);return e.extent.extendFlatCoordinates(s,t,r,n,i)},e.extent.createOrUpdateFromRings=function(t,r){var n=e.extent.createOrUpdateEmpty(r);return e.extent.extendRings(n,t)},e.extent.equals=function(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]},e.extent.extend=function(t,e){return e[0]<t[0]&&(t[0]=e[0]),e[2]>t[2]&&(t[2]=e[2]),e[1]<t[1]&&(t[1]=e[1]),e[3]>t[3]&&(t[3]=e[3]),t},e.extent.extendCoordinate=function(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])},e.extent.extendCoordinates=function(t,r){var n,i;for(n=0,i=r.length;n<i;++n)e.extent.extendCoordinate(t,r[n]);return t},e.extent.extendFlatCoordinates=function(t,r,n,i,o){for(;n<i;n+=o)e.extent.extendXY(t,r[n],r[n+1]);return t},e.extent.extendRings=function(t,r){var n,i;for(n=0,i=r.length;n<i;++n)e.extent.extendCoordinates(t,r[n]);return t},e.extent.extendXY=function(t,e,r){t[0]=Math.min(t[0],e),t[1]=Math.min(t[1],r),t[2]=Math.max(t[2],e),t[3]=Math.max(t[3],r)},e.extent.forEachCorner=function(t,r,n){var i;return(i=r.call(n,e.extent.getBottomLeft(t)))?i:(i=r.call(n,e.extent.getBottomRight(t)))?i:(i=r.call(n,e.extent.getTopRight(t)))?i:(i=r.call(n,e.extent.getTopLeft(t)))||!1},e.extent.getArea=function(t){var r=0;return e.extent.isEmpty(t)||(r=e.extent.getWidth(t)*e.extent.getHeight(t)),r},e.extent.getBottomLeft=function(t){return[t[0],t[1]]},e.extent.getBottomRight=function(t){return[t[2],t[1]]},e.extent.getCenter=function(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]},e.extent.getCorner=function(t,r){var n;return r===e.extent.Corner.BOTTOM_LEFT?n=e.extent.getBottomLeft(t):r===e.extent.Corner.BOTTOM_RIGHT?n=e.extent.getBottomRight(t):r===e.extent.Corner.TOP_LEFT?n=e.extent.getTopLeft(t):r===e.extent.Corner.TOP_RIGHT?n=e.extent.getTopRight(t):e.asserts.assert(!1,13),n},e.extent.getEnlargedArea=function(t,e){var r=Math.min(t[0],e[0]),n=Math.min(t[1],e[1]);return(Math.max(t[2],e[2])-r)*(Math.max(t[3],e[3])-n)},e.extent.getForViewAndSize=function(t,r,n,i,o){var s=r*i[0]/2,a=r*i[1]/2,l=Math.cos(n),h=Math.sin(n),u=s*l,c=s*h,f=a*l,d=a*h,p=t[0],g=t[1],y=p-u+d,m=p-u-d,v=p+u-d,_=p+u+d,S=g-c-f,C=g-c+f,x=g+c+f,I=g+c-f;return e.extent.createOrUpdate(Math.min(y,m,v,_),Math.min(S,C,x,I),Math.max(y,m,v,_),Math.max(S,C,x,I),o)},e.extent.getHeight=function(t){return t[3]-t[1]},e.extent.getIntersectionArea=function(t,r){var n=e.extent.getIntersection(t,r);return e.extent.getArea(n)},e.extent.getIntersection=function(t,r,n){var i=n||e.extent.createEmpty();return e.extent.intersects(t,r)&&(t[0]>r[0]?i[0]=t[0]:i[0]=r[0],t[1]>r[1]?i[1]=t[1]:i[1]=r[1],t[2]<r[2]?i[2]=t[2]:i[2]=r[2],t[3]<r[3]?i[3]=t[3]:i[3]=r[3]),i},e.extent.getMargin=function(t){return e.extent.getWidth(t)+e.extent.getHeight(t)},e.extent.getSize=function(t){return[t[2]-t[0],t[3]-t[1]]},e.extent.getTopLeft=function(t){return[t[0],t[3]]},e.extent.getTopRight=function(t){return[t[2],t[3]]},e.extent.getWidth=function(t){return t[2]-t[0]},e.extent.intersects=function(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]},e.extent.isEmpty=function(t){return t[2]<t[0]||t[3]<t[1]},e.extent.returnOrUpdate=function(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t},e.extent.scaleFromCenter=function(t,e){var r=(t[2]-t[0])/2*(e-1),n=(t[3]-t[1])/2*(e-1);t[0]-=r,t[2]+=r,t[1]-=n,t[3]+=n},e.extent.intersectsSegment=function(t,r,n){var i=!1,o=e.extent.coordinateRelationship(t,r),s=e.extent.coordinateRelationship(t,n);if(o===e.extent.Relationship.INTERSECTING||s===e.extent.Relationship.INTERSECTING)i=!0;else{var a,l,h=t[0],u=t[1],c=t[2],f=t[3],d=r[0],p=r[1],g=n[0],y=n[1],m=(y-p)/(g-d);s&e.extent.Relationship.ABOVE&&!(o&e.extent.Relationship.ABOVE)&&(a=g-(y-f)/m,i=a>=h&&a<=c),i||!(s&e.extent.Relationship.RIGHT)||o&e.extent.Relationship.RIGHT||(l=y-(g-c)*m,i=l>=u&&l<=f),i||!(s&e.extent.Relationship.BELOW)||o&e.extent.Relationship.BELOW||(a=g-(y-u)/m,i=a>=h&&a<=c),i||!(s&e.extent.Relationship.LEFT)||o&e.extent.Relationship.LEFT||(l=y-(g-h)*m,i=l>=u&&l<=f)}return i},e.extent.applyTransform=function(t,r,n){var i=[t[0],t[1],t[0],t[3],t[2],t[1],t[2],t[3]];r(i,i,2);var o=[i[0],i[2],i[4],i[6]],s=[i[1],i[3],i[5],i[7]];return e.extent.boundingExtentXYs_(o,s,n)},e.obj={},e.obj.assign="function"==typeof Object.assign?Object.assign:function(t,e){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(t),n=1,i=arguments.length;n<i;++n){var o=arguments[n];if(void 0!==o&&null!==o)for(var s in o)o.hasOwnProperty(s)&&(r[s]=o[s])}return r},e.obj.clear=function(t){for(var e in t)delete t[e]},e.obj.getValues=function(t){var e=[];for(var r in t)e.push(t[r]);return e},e.obj.isEmpty=function(t){var e;for(e in t)return!1;return!e},e.transform={},e.transform.tmp_=new Array(6),e.transform.create=function(){return[1,0,0,1,0,0]},e.transform.reset=function(t){return e.transform.set(t,1,0,0,1,0,0)},e.transform.multiply=function(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=e[0],h=e[1],u=e[2],c=e[3],f=e[4],d=e[5];return t[0]=r*l+i*h,t[1]=n*l+o*h,t[2]=r*u+i*c,t[3]=n*u+o*c,t[4]=r*f+i*d+s,t[5]=n*f+o*d+a,t},e.transform.set=function(t,e,r,n,i,o,s){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=s,t},e.transform.setFromArray=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},e.transform.apply=function(t,e){var r=e[0],n=e[1];return e[0]=t[0]*r+t[2]*n+t[4],e[1]=t[1]*r+t[3]*n+t[5],e},e.transform.rotate=function(t,r){var n=Math.cos(r),i=Math.sin(r);return e.transform.multiply(t,e.transform.set(e.transform.tmp_,n,i,-i,n,0,0))},e.transform.scale=function(t,r,n){return e.transform.multiply(t,e.transform.set(e.transform.tmp_,r,0,0,n,0,0))},e.transform.translate=function(t,r,n){return e.transform.multiply(t,e.transform.set(e.transform.tmp_,1,0,0,1,r,n))},e.transform.compose=function(t,e,r,n,i,o,s,a){var l=Math.sin(o),h=Math.cos(o);return t[0]=n*h,t[1]=i*l,t[2]=-n*l,t[3]=i*h,t[4]=s*n*h-a*n*l+e,t[5]=s*i*l+a*i*h+r,t},e.transform.invert=function(t){var r=e.transform.determinant(t),n=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5];return t[0]=s/r,t[1]=-i/r,t[2]=-o/r,t[3]=n/r,t[4]=(o*l-s*a)/r,t[5]=-(n*l-i*a)/r,t},e.transform.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},e.geom={},e.geom.flat={},e.geom.flat.center={},e.geom.flat.reverse={},e.geom.flat.orient={},e.geom.flat.transform={},e.geom.flat.transform.transform2D=function(t,e,r,n,i,o){var s,a=o||[],l=0;for(s=e;s<r;s+=n){var h=t[s],u=t[s+1];a[l++]=i[0]*h+i[2]*u+i[4],a[l++]=i[1]*h+i[3]*u+i[5]}return o&&a.length!=l&&(a.length=l),a},e.geom.flat.transform.rotate=function(t,e,r,n,i,o,s){for(var a=s||[],l=Math.cos(i),h=Math.sin(i),u=o[0],c=o[1],f=0,d=e;d<r;d+=n){var p=t[d]-u,g=t[d+1]-c;a[f++]=u+p*l-g*h,a[f++]=c+p*h+g*l;for(var y=d+2;y<d+n;++y)a[f++]=t[y]}return s&&a.length!=f&&(a.length=f),a},e.geom.flat.transform.scale=function(t,e,r,n,i,o,s,a){for(var l=a||[],h=s[0],u=s[1],c=0,f=e;f<r;f+=n){var d=t[f]-h,p=t[f+1]-u;l[c++]=h+i*d,l[c++]=u+o*p;for(var g=f+2;g<f+n;++g)l[c++]=t[g]}return a&&l.length!=c&&(l.length=c),l},e.geom.GeometryLayout={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"},e.geom.flat.reverse.coordinates=function(t,e,r,n){for(;e<r-n;){var i;for(i=0;i<n;++i){var o=t[e+i];t[e+i]=t[r-n+i],t[r-n+i]=o}e+=n,r-=n}},e.geom.flat.orient.linearRingIsClockwise=function(t,e,r,n){for(var i=0,o=t[r-n],s=t[r-n+1];e<r;e+=n){var a=t[e],l=t[e+1];i+=(a-o)*(l+s),o=a,s=l}return i>0},e.geom.flat.orient.linearRingsAreOriented=function(t,r,n,i,o){var s,a,l=void 0!==o&&o;for(s=0,a=n.length;s<a;++s){var h=n[s],u=e.geom.flat.orient.linearRingIsClockwise(t,r,h,i);if(0===s){if(l&&u||!l&&!u)return!1}else if(l&&!u||!l&&u)return!1;r=h}return!0},e.geom.flat.orient.linearRingssAreOriented=function(t,r,n,i,o){var s,a;for(s=0,a=n.length;s<a;++s)if(!e.geom.flat.orient.linearRingsAreOriented(t,r,n[s],i,o))return!1;return!0},e.geom.flat.orient.orientLinearRings=function(t,r,n,i,o){var s,a,l=void 0!==o&&o;for(s=0,a=n.length;s<a;++s){var h=n[s],u=e.geom.flat.orient.linearRingIsClockwise(t,r,h,i);(0===s?l&&u||!l&&!u:l&&!u||!l&&u)&&e.geom.flat.reverse.coordinates(t,r,h,i),r=h}return r},e.geom.flat.orient.orientLinearRingss=function(t,r,n,i,o){var s,a;for(s=0,a=n.length;s<a;++s)r=e.geom.flat.orient.orientLinearRings(t,r,n[s],i,o);return r},e.geom.flat.simplify={},e.geom.flat.simplify.lineString=function(t,r,n,i,o,s,a){var l=void 0!==a?a:[];return s||(n=e.geom.flat.simplify.radialDistance(t,r,n,i,o,l,0),t=l,r=0,i=2),l.length=e.geom.flat.simplify.douglasPeucker(t,r,n,i,o,l,0),l},e.geom.flat.simplify.douglasPeucker=function(t,r,n,i,o,s,a){var l=(n-r)/i;if(l<3){for(;r<n;r+=i)s[a++]=t[r],s[a++]=t[r+1];return a}var h=new Array(l);h[0]=1,h[l-1]=1;for(var u,c=[r,n-i],f=0;c.length>0;){var d=c.pop(),p=c.pop(),g=0,y=t[p],m=t[p+1],v=t[d],_=t[d+1];for(u=p+i;u<d;u+=i){var S=t[u],C=t[u+1],x=e.math.squaredSegmentDistance(S,C,y,m,v,_);x>g&&(f=u,g=x)}g>o&&(h[(f-r)/i]=1,p+i<f&&c.push(p,f),f+i<d&&c.push(f,d))}for(u=0;u<l;++u)h[u]&&(s[a++]=t[r+u*i],s[a++]=t[r+u*i+1]);return a},e.geom.flat.simplify.douglasPeuckers=function(t,r,n,i,o,s,a,l){var h,u;for(h=0,u=n.length;h<u;++h){var c=n[h];a=e.geom.flat.simplify.douglasPeucker(t,r,c,i,o,s,a),l.push(a),r=c}return a},e.geom.flat.simplify.douglasPeuckerss=function(t,r,n,i,o,s,a,l){var h,u;for(h=0,u=n.length;h<u;++h){var c=n[h],f=[];a=e.geom.flat.simplify.douglasPeuckers(t,r,c,i,o,s,a,f),l.push(f),r=c[c.length-1]}return a},e.geom.flat.simplify.radialDistance=function(t,r,n,i,o,s,a){if(n<=r+i){for(;r<n;r+=i)s[a++]=t[r],s[a++]=t[r+1];return a}var l=t[r],h=t[r+1];s[a++]=l,s[a++]=h;var u=l,c=h;for(r+=i;r<n;r+=i)u=t[r],c=t[r+1],e.math.squaredDistance(l,h,u,c)>o&&(s[a++]=u,s[a++]=c,l=u,h=c);return u==l&&c==h||(s[a++]=u,s[a++]=c),a},e.geom.flat.simplify.snap=function(t,e){return e*Math.round(t/e)},e.geom.flat.simplify.quantize=function(t,r,n,i,o,s,a){if(r==n)return a;var l=e.geom.flat.simplify.snap(t[r],o),h=e.geom.flat.simplify.snap(t[r+1],o);r+=i,s[a++]=l,s[a++]=h;var u,c;do{if(u=e.geom.flat.simplify.snap(t[r],o),c=e.geom.flat.simplify.snap(t[r+1],o),(r+=i)==n)return s[a++]=u,s[a++]=c,a}while(u==l&&c==h);for(;r<n;){var f,d;if(f=e.geom.flat.simplify.snap(t[r],o),d=e.geom.flat.simplify.snap(t[r+1],o),r+=i,f!=u||d!=c){var p=u-l,g=c-h,y=f-l,m=d-h;p*m==g*y&&(p<0&&y<p||p==y||p>0&&y>p)&&(g<0&&m<g||g==m||g>0&&m>g)?(u=f,c=d):(s[a++]=u,s[a++]=c,l=u,h=c,u=f,c=d)}}return s[a++]=u,s[a++]=c,a},e.geom.flat.simplify.quantizes=function(t,r,n,i,o,s,a,l){var h,u;for(h=0,u=n.length;h<u;++h){var c=n[h];a=e.geom.flat.simplify.quantize(t,r,c,i,o,s,a),l.push(a),r=c}return a},e.geom.flat.simplify.quantizess=function(t,r,n,i,o,s,a,l){var h,u;for(h=0,u=n.length;h<u;++h){var c=n[h],f=[];a=e.geom.flat.simplify.quantizes(t,r,c,i,o,s,a,f),l.push(f),r=c[c.length-1]}return a},e.geom.GeometryType={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},e.geom.Geometry=function(){e.Object.call(this),this.extent_=e.extent.createEmpty(),this.extentRevision_=-1,this.simplifiedGeometryCache={},this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.tmpTransform_=e.transform.create()},e.inherits(e.geom.Geometry,e.Object),e.geom.Geometry.prototype.clone=function(){},e.geom.Geometry.prototype.closestPointXY=function(t,e,r,n){},e.geom.Geometry.prototype.getClosestPoint=function(t,e){var r=e||[NaN,NaN];return this.closestPointXY(t[0],t[1],r,1/0),r},e.geom.Geometry.prototype.intersectsCoordinate=function(t){return this.containsXY(t[0],t[1])},e.geom.Geometry.prototype.computeExtent=function(t){},e.geom.Geometry.prototype.containsXY=e.functions.FALSE,e.geom.Geometry.prototype.getExtent=function(t){return this.extentRevision_!=this.getRevision()&&(this.extent_=this.computeExtent(this.extent_),this.extentRevision_=this.getRevision()),e.extent.returnOrUpdate(this.extent_,t)},e.geom.Geometry.prototype.rotate=function(t,e){},e.geom.Geometry.prototype.scale=function(t,e,r){},e.geom.Geometry.prototype.simplify=function(t){return this.getSimplifiedGeometry(t*t)},e.geom.Geometry.prototype.getSimplifiedGeometry=function(t){},e.geom.Geometry.prototype.getType=function(){},e.geom.Geometry.prototype.applyTransform=function(t){},e.geom.Geometry.prototype.intersectsExtent=function(t){},e.geom.Geometry.prototype.translate=function(t,e){},e.geom.Geometry.prototype.transform=function(t,r){var n=this.tmpTransform_;t=e.proj.get(t);var i=t.getUnits()==e.proj.Units.TILE_PIXELS?function(i,o,s){var a=t.getExtent(),l=t.getWorldExtent(),h=e.extent.getHeight(l)/e.extent.getHeight(a);return e.transform.compose(n,l[0],l[3],h,-h,0,0,0),e.geom.flat.transform.transform2D(i,0,i.length,s,n,o),e.proj.getTransform(t,r)(i,o,s)}:e.proj.getTransform(t,r);return this.applyTransform(i),this},e.geom.SimpleGeometry=function(){e.geom.Geometry.call(this),this.layout=e.geom.GeometryLayout.XY,this.stride=2,this.flatCoordinates=null},e.inherits(e.geom.SimpleGeometry,e.geom.Geometry),e.geom.SimpleGeometry.getLayoutForStride_=function(t){var r;return 2==t?r=e.geom.GeometryLayout.XY:3==t?r=e.geom.GeometryLayout.XYZ:4==t&&(r=e.geom.GeometryLayout.XYZM),r},e.geom.SimpleGeometry.getStrideForLayout=function(t){var r;return t==e.geom.GeometryLayout.XY?r=2:t==e.geom.GeometryLayout.XYZ||t==e.geom.GeometryLayout.XYM?r=3:t==e.geom.GeometryLayout.XYZM&&(r=4),r},e.geom.SimpleGeometry.prototype.containsXY=e.functions.FALSE,e.geom.SimpleGeometry.prototype.computeExtent=function(t){return e.extent.createOrUpdateFromFlatCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.geom.SimpleGeometry.prototype.getCoordinates=function(){},e.geom.SimpleGeometry.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},e.geom.SimpleGeometry.prototype.getFlatCoordinates=function(){return this.flatCoordinates},e.geom.SimpleGeometry.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},e.geom.SimpleGeometry.prototype.getLayout=function(){return this.layout},e.geom.SimpleGeometry.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!=this.getRevision()&&(e.obj.clear(this.simplifiedGeometryCache),this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var r=t.toString();if(this.simplifiedGeometryCache.hasOwnProperty(r))return this.simplifiedGeometryCache[r];var n=this.getSimplifiedGeometryInternal(t);return n.getFlatCoordinates().length<this.flatCoordinates.length?(this.simplifiedGeometryCache[r]=n,n):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)},e.geom.SimpleGeometry.prototype.getSimplifiedGeometryInternal=function(t){return this},e.geom.SimpleGeometry.prototype.getStride=function(){return this.stride},e.geom.SimpleGeometry.prototype.setFlatCoordinatesInternal=function(t,r){this.stride=e.geom.SimpleGeometry.getStrideForLayout(t),this.layout=t,this.flatCoordinates=r},e.geom.SimpleGeometry.prototype.setCoordinates=function(t,e){},e.geom.SimpleGeometry.prototype.setLayout=function(t,r,n){var i;if(t)i=e.geom.SimpleGeometry.getStrideForLayout(t);else{var o;for(o=0;o<n;++o){if(0===r.length)return this.layout=e.geom.GeometryLayout.XY,void(this.stride=2);r=r[0]}i=r.length,t=e.geom.SimpleGeometry.getLayoutForStride_(i)}this.layout=t,this.stride=i},e.geom.SimpleGeometry.prototype.applyTransform=function(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},e.geom.SimpleGeometry.prototype.rotate=function(t,r){var n=this.getFlatCoordinates();if(n){var i=this.getStride();e.geom.flat.transform.rotate(n,0,n.length,i,t,r,n),this.changed()}},e.geom.SimpleGeometry.prototype.scale=function(t,r,n){var i=r;void 0===i&&(i=t);var o=n;o||(o=e.extent.getCenter(this.getExtent()));var s=this.getFlatCoordinates();if(s){var a=this.getStride();e.geom.flat.transform.scale(s,0,s.length,a,t,i,o,s),this.changed()}},e.geom.SimpleGeometry.prototype.translate=function(t,r){var n=this.getFlatCoordinates();if(n){var i=this.getStride();e.geom.flat.transform.translate(n,0,n.length,i,t,r,n),this.changed()}},e.geom.SimpleGeometry.transform2D=function(t,r,n){var i=t.getFlatCoordinates();if(i){var o=t.getStride();return e.geom.flat.transform.transform2D(i,0,i.length,o,r,n)}return null},e.geom.Polygon=function(t,r){e.geom.SimpleGeometry.call(this),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,this.setCoordinates(t,r)},e.inherits(e.geom.Polygon,e.geom.SimpleGeometry),e.geom.Polygon.prototype.appendLinearRing=function(t){this.flatCoordinates?e.array.extend(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.geom.Polygon.prototype.clone=function(){var t=new e.geom.Polygon(null);return t.setFlatCoordinates(this.layout,this.flatCoordinates.slice(),this.ends_.slice()),t},e.geom.Polygon.prototype.closestPointXY=function(t,r,n,i){return i<e.extent.closestSquaredDistanceXY(this.getExtent(),t,r)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(e.geom.flat.closest.getsMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),e.geom.flat.closest.getsClosestPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,r,n,i))},e.geom.Polygon.prototype.containsXY=function(t,r){return e.geom.flat.contains.linearRingsContainsXY(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,r)},e.geom.Polygon.prototype.getArea=function(){return e.geom.flat.area.linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},e.geom.Polygon.prototype.getCoordinates=function(t){var r;return void 0!==t?(r=this.getOrientedFlatCoordinates().slice(),e.geom.flat.orient.orientLinearRings(r,0,this.ends_,this.stride,t)):r=this.flatCoordinates,e.geom.flat.inflate.coordinatess(r,0,this.ends_,this.stride)},e.geom.Polygon.prototype.getEnds=function(){return this.ends_},e.geom.Polygon.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var t=e.extent.getCenter(this.getExtent());this.flatInteriorPoint_=e.geom.flat.interiorpoint.linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},e.geom.Polygon.prototype.getInteriorPoint=function(){return new e.geom.Point(this.getFlatInteriorPoint(),e.geom.GeometryLayout.XYM)},e.geom.Polygon.prototype.getLinearRingCount=function(){return this.ends_.length},e.geom.Polygon.prototype.getLinearRing=function(t){if(t<0||this.ends_.length<=t)return null;var r=new e.geom.LinearRing(null);return r.setFlatCoordinates(this.layout,this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t])),r},e.geom.Polygon.prototype.getLinearRings=function(){var t,r,n=this.layout,i=this.flatCoordinates,o=this.ends_,s=[],a=0;for(t=0,r=o.length;t<r;++t){var l=o[t],h=new e.geom.LinearRing(null);h.setFlatCoordinates(n,i.slice(a,l)),s.push(h),a=l}return s},e.geom.Polygon.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;e.geom.flat.orient.linearRingsAreOriented(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=e.geom.flat.orient.orientLinearRings(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.geom.Polygon.prototype.getSimplifiedGeometryInternal=function(t){var r=[],n=[];r.length=e.geom.flat.simplify.quantizes(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),r,0,n);var i=new e.geom.Polygon(null);return i.setFlatCoordinates(e.geom.GeometryLayout.XY,r,n),i},e.geom.Polygon.prototype.getType=function(){return e.geom.GeometryType.POLYGON},e.geom.Polygon.prototype.intersectsExtent=function(t){return e.geom.flat.intersectsextent.linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)},e.geom.Polygon.prototype.setCoordinates=function(t,r){if(t){this.setLayout(r,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var n=e.geom.flat.deflate.coordinatess(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===n.length?0:n[n.length-1]}else this.setFlatCoordinates(e.geom.GeometryLayout.XY,null,this.ends_)},e.geom.Polygon.prototype.setFlatCoordinates=function(t,e,r){this.setFlatCoordinatesInternal(t,e),this.ends_=r},e.geom.Polygon.circular=function(t,r,n,i){var o,s=i||32,a=[];for(o=0;o<s;++o)e.array.extend(a,t.offset(r,n,2*Math.PI*o/s));a.push(a[0],a[1]);var l=new e.geom.Polygon(null);return l.setFlatCoordinates(e.geom.GeometryLayout.XY,a,[a.length]),l},e.geom.Polygon.fromExtent=function(t){var r=t[0],n=t[1],i=t[2],o=t[3],s=[r,n,r,o,i,o,i,n,r,n],a=new e.geom.Polygon(null);return a.setFlatCoordinates(e.geom.GeometryLayout.XY,s,[s.length]),a},e.geom.Polygon.fromCircle=function(t,r,n){for(var i=r||32,o=t.getStride(),s=t.getLayout(),a=new e.geom.Polygon(null,s),l=o*(i+1),h=new Array(l),u=0;u<l;u++)h[u]=0;var c=[h.length];return a.setFlatCoordinates(s,h,c),e.geom.Polygon.makeRegular(a,t.getCenter(),t.getRadius(),n),a},e.geom.Polygon.makeRegular=function(t,r,n,i){for(var o,s,a=t.getFlatCoordinates(),l=t.getLayout(),h=t.getStride(),u=t.getEnds(),c=a.length/h-1,f=i||0,d=0;d<=c;++d)s=d*h,o=f+2*e.math.modulo(d,c)*Math.PI/c,a[s]=r[0]+n*Math.cos(o),a[s+1]=r[1]+n*Math.sin(o);t.setFlatCoordinates(l,a,u)},e.geom.LineString=function(t,r){e.geom.SimpleGeometry.call(this),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.setCoordinates(t,r)},e.inherits(e.geom.LineString,e.geom.SimpleGeometry),e.geom.LineString.prototype.appendCoordinate=function(t){this.flatCoordinates?e.array.extend(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()},e.geom.LineString.prototype.clone=function(){var t=new e.geom.LineString(null);return t.setFlatCoordinates(this.layout,this.flatCoordinates.slice()),t},e.geom.LineString.prototype.closestPointXY=function(t,r,n,i){return i<e.extent.closestSquaredDistanceXY(this.getExtent(),t,r)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(e.geom.flat.closest.getMaxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),e.geom.flat.closest.getClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,r,n,i))},e.geom.LineString.prototype.forEachSegment=function(t,r){return e.geom.flat.segments.forEach(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r)},e.geom.LineString.prototype.getCoordinateAtM=function(t,r){if(this.layout!=e.geom.GeometryLayout.XYM&&this.layout!=e.geom.GeometryLayout.XYZM)return null;var n=void 0!==r&&r;return e.geom.flat.interpolate.lineStringCoordinateAtM(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,n)},e.geom.LineString.prototype.getCoordinates=function(){return e.geom.flat.inflate.coordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.geom.LineString.prototype.getCoordinateAt=function(t,r){return e.geom.flat.interpolate.lineString(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r)},e.geom.LineString.prototype.getLength=function(){return e.geom.flat.length.lineString(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.geom.LineString.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},e.geom.LineString.prototype.getSimplifiedGeometryInternal=function(t){var r=[];r.length=e.geom.flat.simplify.douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r,0);var n=new e.geom.LineString(null);return n.setFlatCoordinates(e.geom.GeometryLayout.XY,r),n},e.geom.LineString.prototype.getType=function(){return e.geom.GeometryType.LINE_STRING},e.geom.LineString.prototype.intersectsExtent=function(t){return e.geom.flat.intersectsextent.lineString(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.geom.LineString.prototype.setCoordinates=function(t,r){t?(this.setLayout(r,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=e.geom.flat.deflate.coordinates(this.flatCoordinates,0,t,this.stride),this.changed()):this.setFlatCoordinates(e.geom.GeometryLayout.XY,null)},e.geom.LineString.prototype.setFlatCoordinates=function(t,e){this.setFlatCoordinatesInternal(t,e),this.changed()},e.geom.Point=function(t,r){e.geom.SimpleGeometry.call(this),this.setCoordinates(t,r)},e.inherits(e.geom.Point,e.geom.SimpleGeometry),e.geom.Point.prototype.clone=function(){var t=new e.geom.Point(null);return t.setFlatCoordinates(this.layout,this.flatCoordinates.slice()),t},e.geom.Point.prototype.closestPointXY=function(t,r,n,i){var o=this.flatCoordinates,s=e.math.squaredDistance(t,r,o[0],o[1]);if(s<i){var a,l=this.stride;for(a=0;a<l;++a)n[a]=o[a];return n.length=l,s}return i},e.geom.Point.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},e.geom.Point.prototype.computeExtent=function(t){return e.extent.createOrUpdateFromCoordinate(this.flatCoordinates,t)},e.geom.Point.prototype.getType=function(){return e.geom.GeometryType.POINT},e.geom.Point.prototype.intersectsExtent=function(t){return e.extent.containsXY(t,this.flatCoordinates[0],this.flatCoordinates[1])},e.geom.Point.prototype.setCoordinates=function(t,r){t?(this.setLayout(r,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=e.geom.flat.deflate.coordinate(this.flatCoordinates,0,t,this.stride),this.changed()):this.setFlatCoordinates(e.geom.GeometryLayout.XY,null)},e.geom.Point.prototype.setFlatCoordinates=function(t,e){this.setFlatCoordinatesInternal(t,e),this.changed()},e.geom.MultiLineString=function(t,r){e.geom.SimpleGeometry.call(this),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.setCoordinates(t,r)},e.inherits(e.geom.MultiLineString,e.geom.SimpleGeometry),e.geom.MultiLineString.prototype.appendLineString=function(t){this.flatCoordinates?e.array.extend(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.geom.MultiLineString.prototype.clone=function(){
var t=new e.geom.MultiLineString(null);return t.setFlatCoordinates(this.layout,this.flatCoordinates.slice(),this.ends_.slice()),t},e.geom.MultiLineString.prototype.closestPointXY=function(t,r,n,i){return i<e.extent.closestSquaredDistanceXY(this.getExtent(),t,r)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(e.geom.flat.closest.getsMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),e.geom.flat.closest.getsClosestPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,r,n,i))},e.geom.MultiLineString.prototype.getCoordinateAtM=function(t,r,n){if(this.layout!=e.geom.GeometryLayout.XYM&&this.layout!=e.geom.GeometryLayout.XYZM||0===this.flatCoordinates.length)return null;var i=void 0!==r&&r,o=void 0!==n&&n;return e.geom.flat.interpolate.lineStringsCoordinateAtM(this.flatCoordinates,0,this.ends_,this.stride,t,i,o)},e.geom.MultiLineString.prototype.getCoordinates=function(){return e.geom.flat.inflate.coordinatess(this.flatCoordinates,0,this.ends_,this.stride)},e.geom.MultiLineString.prototype.getEnds=function(){return this.ends_},e.geom.MultiLineString.prototype.getLineString=function(t){if(t<0||this.ends_.length<=t)return null;var r=new e.geom.LineString(null);return r.setFlatCoordinates(this.layout,this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t])),r},e.geom.MultiLineString.prototype.getLineStrings=function(){var t,r,n=this.flatCoordinates,i=this.ends_,o=this.layout,s=[],a=0;for(t=0,r=i.length;t<r;++t){var l=i[t],h=new e.geom.LineString(null);h.setFlatCoordinates(o,n.slice(a,l)),s.push(h),a=l}return s},e.geom.MultiLineString.prototype.getFlatMidpoints=function(){var t,r,n=[],i=this.flatCoordinates,o=0,s=this.ends_,a=this.stride;for(t=0,r=s.length;t<r;++t){var l=s[t],h=e.geom.flat.interpolate.lineString(i,o,l,a,.5);e.array.extend(n,h),o=l}return n},e.geom.MultiLineString.prototype.getSimplifiedGeometryInternal=function(t){var r=[],n=[];r.length=e.geom.flat.simplify.douglasPeuckers(this.flatCoordinates,0,this.ends_,this.stride,t,r,0,n);var i=new e.geom.MultiLineString(null);return i.setFlatCoordinates(e.geom.GeometryLayout.XY,r,n),i},e.geom.MultiLineString.prototype.getType=function(){return e.geom.GeometryType.MULTI_LINE_STRING},e.geom.MultiLineString.prototype.intersectsExtent=function(t){return e.geom.flat.intersectsextent.lineStrings(this.flatCoordinates,0,this.ends_,this.stride,t)},e.geom.MultiLineString.prototype.setCoordinates=function(t,r){if(t){this.setLayout(r,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var n=e.geom.flat.deflate.coordinatess(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===n.length?0:n[n.length-1],this.changed()}else this.setFlatCoordinates(e.geom.GeometryLayout.XY,null,this.ends_)},e.geom.MultiLineString.prototype.setFlatCoordinates=function(t,e,r){this.setFlatCoordinatesInternal(t,e),this.ends_=r,this.changed()},e.geom.MultiLineString.prototype.setLineStrings=function(t){var r,n,i=this.getLayout(),o=[],s=[];for(r=0,n=t.length;r<n;++r){var a=t[r];0===r&&(i=a.getLayout()),e.array.extend(o,a.getFlatCoordinates()),s.push(o.length)}this.setFlatCoordinates(i,o,s)},e.geom.MultiPoint=function(t,r){e.geom.SimpleGeometry.call(this),this.setCoordinates(t,r)},e.inherits(e.geom.MultiPoint,e.geom.SimpleGeometry),e.geom.MultiPoint.prototype.appendPoint=function(t){this.flatCoordinates?e.array.extend(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()},e.geom.MultiPoint.prototype.clone=function(){var t=new e.geom.MultiPoint(null);return t.setFlatCoordinates(this.layout,this.flatCoordinates.slice()),t},e.geom.MultiPoint.prototype.closestPointXY=function(t,r,n,i){if(i<e.extent.closestSquaredDistanceXY(this.getExtent(),t,r))return i;var o,s,a,l=this.flatCoordinates,h=this.stride;for(o=0,s=l.length;o<s;o+=h){var u=e.math.squaredDistance(t,r,l[o],l[o+1]);if(u<i){for(i=u,a=0;a<h;++a)n[a]=l[o+a];n.length=h}}return i},e.geom.MultiPoint.prototype.getCoordinates=function(){return e.geom.flat.inflate.coordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.geom.MultiPoint.prototype.getPoint=function(t){var r=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;if(t<0||r<=t)return null;var n=new e.geom.Point(null);return n.setFlatCoordinates(this.layout,this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride)),n},e.geom.MultiPoint.prototype.getPoints=function(){var t,r,n=this.flatCoordinates,i=this.layout,o=this.stride,s=[];for(t=0,r=n.length;t<r;t+=o){var a=new e.geom.Point(null);a.setFlatCoordinates(i,n.slice(t,t+o)),s.push(a)}return s},e.geom.MultiPoint.prototype.getType=function(){return e.geom.GeometryType.MULTI_POINT},e.geom.MultiPoint.prototype.intersectsExtent=function(t){var r,n,i,o,s=this.flatCoordinates,a=this.stride;for(r=0,n=s.length;r<n;r+=a)if(i=s[r],o=s[r+1],e.extent.containsXY(t,i,o))return!0;return!1},e.geom.MultiPoint.prototype.setCoordinates=function(t,r){t?(this.setLayout(r,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=e.geom.flat.deflate.coordinates(this.flatCoordinates,0,t,this.stride),this.changed()):this.setFlatCoordinates(e.geom.GeometryLayout.XY,null)},e.geom.MultiPoint.prototype.setFlatCoordinates=function(t,e){this.setFlatCoordinatesInternal(t,e),this.changed()},e.geom.flat.center.linearRingss={},e.geom.flat.center.linearRingss=function(t,r,n,i){var o,s,a=[],l=e.extent.createEmpty();for(o=0,s=n.length;o<s;++o){var h=n[o];l=e.extent.createOrUpdateFromFlatCoordinates(t,r,h[0],i),a.push((l[0]+l[2])/2,(l[1]+l[3])/2),r=h[h.length-1]}return a},e.geom.MultiPolygon=function(t,r){e.geom.SimpleGeometry.call(this),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,this.setCoordinates(t,r)},e.inherits(e.geom.MultiPolygon,e.geom.SimpleGeometry),e.geom.MultiPolygon.prototype.appendPolygon=function(t){var r;if(this.flatCoordinates){var n=this.flatCoordinates.length;e.array.extend(this.flatCoordinates,t.getFlatCoordinates()),r=t.getEnds().slice();var i,o;for(i=0,o=r.length;i<o;++i)r[i]+=n}else this.flatCoordinates=t.getFlatCoordinates().slice(),r=t.getEnds().slice(),this.endss_.push();this.endss_.push(r),this.changed()},e.geom.MultiPolygon.prototype.clone=function(){for(var t=new e.geom.MultiPolygon(null),r=this.endss_.length,n=new Array(r),i=0;i<r;++i)n[i]=this.endss_[i].slice();return t.setFlatCoordinates(this.layout,this.flatCoordinates.slice(),n),t},e.geom.MultiPolygon.prototype.closestPointXY=function(t,r,n,i){return i<e.extent.closestSquaredDistanceXY(this.getExtent(),t,r)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(e.geom.flat.closest.getssMaxSquaredDelta(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),e.geom.flat.closest.getssClosestPoint(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,r,n,i))},e.geom.MultiPolygon.prototype.containsXY=function(t,r){return e.geom.flat.contains.linearRingssContainsXY(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,r)},e.geom.MultiPolygon.prototype.getArea=function(){return e.geom.flat.area.linearRingss(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},e.geom.MultiPolygon.prototype.getCoordinates=function(t){var r;return void 0!==t?(r=this.getOrientedFlatCoordinates().slice(),e.geom.flat.orient.orientLinearRingss(r,0,this.endss_,this.stride,t)):r=this.flatCoordinates,e.geom.flat.inflate.coordinatesss(r,0,this.endss_,this.stride)},e.geom.MultiPolygon.prototype.getEndss=function(){return this.endss_},e.geom.MultiPolygon.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var t=e.geom.flat.center.linearRingss(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=e.geom.flat.interiorpoint.linearRingss(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_},e.geom.MultiPolygon.prototype.getInteriorPoints=function(){var t=new e.geom.MultiPoint(null);return t.setFlatCoordinates(e.geom.GeometryLayout.XYM,this.getFlatInteriorPoints().slice()),t},e.geom.MultiPolygon.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;e.geom.flat.orient.linearRingssAreOriented(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=e.geom.flat.orient.orientLinearRingss(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.geom.MultiPolygon.prototype.getSimplifiedGeometryInternal=function(t){var r=[],n=[];r.length=e.geom.flat.simplify.quantizess(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),r,0,n);var i=new e.geom.MultiPolygon(null);return i.setFlatCoordinates(e.geom.GeometryLayout.XY,r,n),i},e.geom.MultiPolygon.prototype.getPolygon=function(t){if(t<0||this.endss_.length<=t)return null;var r;if(0===t)r=0;else{var n=this.endss_[t-1];r=n[n.length-1]}var i=this.endss_[t].slice(),o=i[i.length-1];if(0!==r){var s,a;for(s=0,a=i.length;s<a;++s)i[s]-=r}var l=new e.geom.Polygon(null);return l.setFlatCoordinates(this.layout,this.flatCoordinates.slice(r,o),i),l},e.geom.MultiPolygon.prototype.getPolygons=function(){var t,r,n,i,o=this.layout,s=this.flatCoordinates,a=this.endss_,l=[],h=0;for(t=0,r=a.length;t<r;++t){var u=a[t].slice(),c=u[u.length-1];if(0!==h)for(n=0,i=u.length;n<i;++n)u[n]-=h;var f=new e.geom.Polygon(null);f.setFlatCoordinates(o,s.slice(h,c),u),l.push(f),h=c}return l},e.geom.MultiPolygon.prototype.getType=function(){return e.geom.GeometryType.MULTI_POLYGON},e.geom.MultiPolygon.prototype.intersectsExtent=function(t){return e.geom.flat.intersectsextent.linearRingss(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)},e.geom.MultiPolygon.prototype.setCoordinates=function(t,r){if(t){this.setLayout(r,t,3),this.flatCoordinates||(this.flatCoordinates=[]);var n=e.geom.flat.deflate.coordinatesss(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===n.length)this.flatCoordinates.length=0;else{var i=n[n.length-1];this.flatCoordinates.length=0===i.length?0:i[i.length-1]}this.changed()}else this.setFlatCoordinates(e.geom.GeometryLayout.XY,null,this.endss_)},e.geom.MultiPolygon.prototype.setFlatCoordinates=function(t,e,r){this.setFlatCoordinatesInternal(t,e),this.endss_=r,this.changed()},e.geom.MultiPolygon.prototype.setPolygons=function(t){var r,n,i,o=this.getLayout(),s=[],a=[];for(r=0,n=t.length;r<n;++r){var l=t[r];0===r&&(o=l.getLayout());var h=s.length;i=l.getEnds();var u,c;for(u=0,c=i.length;u<c;++u)i[u]+=h;e.array.extend(s,l.getFlatCoordinates()),a.push(i)}this.setFlatCoordinates(o,s,a)},e.Feature=function(t){if(e.Object.call(this),this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,void 0!==t)if(t instanceof e.geom.Geometry||!t){var r=t;this.setGeometry(r)}else{var n=t;this.setProperties(n)}},e.inherits(e.Feature,e.Object),e.Feature.prototype.clone=function(){var t=new e.Feature(this.getProperties());t.setGeometryName(this.getGeometryName());var r=this.getGeometry();r&&t.setGeometry(r.clone());var n=this.getStyle();return n&&t.setStyle(n),t},e.Feature.prototype.getGeometry=function(){return this.get(this.geometryName_)},e.Feature.prototype.getId=function(){return this.id_},e.Feature.prototype.getGeometryName=function(){return this.geometryName_},e.Feature.prototype.getStyle=function(){return this.style_},e.Feature.prototype.getStyleFunction=function(){return this.styleFunction_},e.Feature.prototype.handleGeometryChange_=function(){this.changed()},e.Feature.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(e.events.unlistenByKey(this.geometryChangeKey_),this.geometryChangeKey_=null);var t=this.getGeometry();t&&(this.geometryChangeKey_=e.events.listen(t,e.events.EventType.CHANGE,this.handleGeometryChange_,this)),this.changed()},e.Feature.prototype.setGeometry=function(t){this.set(this.geometryName_,t)},e.Feature.prototype.setStyle=function(t){this.style_=t,this.styleFunction_=t?e.Feature.createStyleFunction(t):void 0,this.changed()},e.Feature.prototype.setId=function(t){this.id_=t,this.changed()},e.Feature.prototype.setGeometryName=function(t){e.events.unlisten(this,e.Object.getChangeEventType(this.geometryName_),this.handleGeometryChanged_,this),this.geometryName_=t,e.events.listen(this,e.Object.getChangeEventType(this.geometryName_),this.handleGeometryChanged_,this),this.handleGeometryChanged_()},e.Feature.createStyleFunction=function(t){var r;if("function"==typeof t)r=2==t.length?function(e){return t(this,e)}:t;else{var n;Array.isArray(t)?n=t:(e.asserts.assert(t instanceof e.style.Style,41),n=[t]),r=function(){return n}}return r},e.format={},e.format.Feature=function(){this.defaultDataProjection=null,this.defaultFeatureProjection=null},e.format.Feature.prototype.getReadOptions=function(t,e){var r;return e&&(r={dataProjection:e.dataProjection?e.dataProjection:this.readProjection(t),featureProjection:e.featureProjection}),this.adaptOptions(r)},e.format.Feature.prototype.adaptOptions=function(t){return e.obj.assign({dataProjection:this.defaultDataProjection,featureProjection:this.defaultFeatureProjection},t)},e.format.Feature.prototype.getLastExtent=function(){return null},e.format.Feature.prototype.getType=function(){},e.format.Feature.prototype.readFeature=function(t,e){},e.format.Feature.prototype.readFeatures=function(t,e){},e.format.Feature.prototype.readGeometry=function(t,e){},e.format.Feature.prototype.readProjection=function(t){},e.format.Feature.prototype.writeFeature=function(t,e){},e.format.Feature.prototype.writeFeatures=function(t,e){},e.format.Feature.prototype.writeGeometry=function(t,e){},e.format.Feature.transformWithOptions=function(t,e,r){var n;if(n=t,e&&r&&void 0!==r.decimals){var i=Math.pow(10,r.decimals),o=function(t){for(var e=0,r=t.length;e<r;++e)t[e]=Math.round(t[e]*i)/i;return t};n===t&&(n=n.clone()),n.applyTransform(o)}return n},e.format.MVT=function(t){e.format.Feature.call(this);var r=t||{};this.featureClass_=r.featureClass?r.featureClass:e.render.Feature,this.geometryName_=r.geometryName,this.layerName_=r.layerName?r.layerName:"layer",this.layers_=r.layers?r.layers:null,this.extent_=null},e.inherits(e.format.MVT,e.format.Feature),e.format.MVT.pbfReaders_={layers:function(t,r,n){if(3===t){var i={keys:[],values:[],features:[]},o=n.readVarint()+n.pos;n.readFields(e.format.MVT.pbfReaders_.layer,i,o),i.length=i.features.length,i.length&&(r[i.name]=i)}},layer:function(t,e,r){if(15===t)e.version=r.readVarint();else if(1===t)e.name=r.readString();else if(5===t)e.extent=r.readVarint();else if(2===t)e.features.push(r.pos);else if(3===t)e.keys.push(r.readString());else if(4===t){for(var n=null,i=r.readVarint()+r.pos;r.pos<i;)t=r.readVarint()>>3,n=1===t?r.readString():2===t?r.readFloat():3===t?r.readDouble():4===t?r.readVarint64():5===t?r.readVarint():6===t?r.readSVarint():7===t?r.readBoolean():null;e.values.push(n)}},feature:function(t,e,r){if(1==t)e.id=r.readVarint();else if(2==t)for(var n=r.readVarint()+r.pos;r.pos<n;){var i=e.layer.keys[r.readVarint()],o=e.layer.values[r.readVarint()];e.properties[i]=o}else 3==t?e.type=r.readVarint():4==t&&(e.geometry=r.pos)}},e.format.MVT.readRawFeature_=function(t,r,n){t.pos=r.features[n];var i=t.readVarint()+t.pos,o={layer:r,type:0,properties:{}};return t.readFields(e.format.MVT.pbfReaders_.feature,o,i),o},e.format.MVT.readRawGeometry_=function(t,r,n,i){t.pos=r.geometry;for(var o=t.readVarint()+t.pos,s=1,a=0,l=0,h=0,u=0,c=0;t.pos<o;){if(!a){var f=t.readVarint();s=7&f,a=f>>3}a--,1===s||2===s?(l+=t.readSVarint(),h+=t.readSVarint(),1===s&&u>c&&(i.push(u),c=u),n.push(l,h),u+=2):7===s?u>c&&(n.push(n[c],n[c+1]),u+=2):e.asserts.assert(!1,59)}u>c&&(i.push(u),c=u)},e.format.MVT.getGeometryType_=function(t,r){var n;return 1===t?n=1===r?e.geom.GeometryType.POINT:e.geom.GeometryType.MULTI_POINT:2===t?n=1===r?e.geom.GeometryType.LINE_STRING:e.geom.GeometryType.MULTI_LINE_STRING:3===t&&(n=e.geom.GeometryType.POLYGON),n},e.format.MVT.prototype.createFeature_=function(t,r,n){var i=r.type;if(0===i)return null;var o,s=r.id,a=r.properties;a[this.layerName_]=r.layer.name;var l=[],h=[];e.format.MVT.readRawGeometry_(t,r,l,h);var u,c=e.format.MVT.getGeometryType_(i,h.length);if(c==e.geom.GeometryType.POLYGON){for(var f=[],d=0,p=0,g=0,y=h.length;g<y;++g){var m=h[g];e.geom.flat.orient.linearRingIsClockwise(l,d,m,2)||(f.push(h.slice(p,g+1)),p=g+1),d=m}f.length>1?(h=f,u=new e.geom.MultiPolygon(null)):u=new e.geom.Polygon(null)}else u=c===e.geom.GeometryType.POINT?new e.geom.Point(null):c===e.geom.GeometryType.LINE_STRING?new e.geom.LineString(null):c===e.geom.GeometryType.POLYGON?new e.geom.Polygon(null):c===e.geom.GeometryType.MULTI_POINT?new e.geom.MultiPoint(null):c===e.geom.GeometryType.MULTI_LINE_STRING?new e.geom.MultiLineString(null):null;u.setFlatCoordinates(e.geom.GeometryLayout.XY,l,h),o=new this.featureClass_,this.geometryName_&&o.setGeometryName(this.geometryName_);var v=e.format.Feature.transformWithOptions(u,!1,this.adaptOptions(n));return o.setGeometry(v),o.setId(s),o.setProperties(a),o},e.format.MVT.prototype.readFeatures=function(r,n){var i,o=this.layers_,s=new t(r),a=s.readFields(e.format.MVT.pbfReaders_.layers,{}),l=[];for(var h in a)if(!o||-1!=o.indexOf(h)){if(void 0!==n){var u=n.needSourceLayerNames;if(void 0!==u&&void 0===u[h])continue}i=a[h];for(var c,f=0,d=i.length;f<d;++f)c=e.format.MVT.readRawFeature_(s,i,f),l.push(this.createFeature_(s,c));this.extent_=i?[0,0,i.extent,i.extent]:null}return l},e.style={},e.style.IconImageCache=function(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32},e.style.IconImageCache.getKey=function(t,r,n){return r+":"+t+":"+(n?e.color.asString(n):"null")},e.style.IconImageCache.prototype.clear=function(){this.cache_={},this.cacheSize_=0},e.style.IconImageCache.prototype.expire=function(){if(this.cacheSize_>this.maxCacheSize_){var t,e,r=0;for(t in this.cache_)e=this.cache_[t],0!=(3&r++)||e.hasListener()||(delete this.cache_[t],--this.cacheSize_)}},e.style.IconImageCache.prototype.get=function(t,r,n){var i=e.style.IconImageCache.getKey(t,r,n);return i in this.cache_?this.cache_[i]:null},e.style.IconImageCache.prototype.set=function(t,r,n,i){var o=e.style.IconImageCache.getKey(t,r,n);this.cache_[o]=i,++this.cacheSize_},e.style.IconImageCache.prototype.setSize=function(t){this.maxCacheSize_=t,this.expire()},e.style.iconImageCache=new e.style.IconImageCache,e.style.Image=function(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.snapToPixel_=t.snapToPixel},e.style.Image.prototype.getOpacity=function(){return this.opacity_},e.style.Image.prototype.getRotateWithView=function(){return this.rotateWithView_},e.style.Image.prototype.getRotation=function(){return this.rotation_},e.style.Image.prototype.getScale=function(){return this.scale_},e.style.Image.prototype.getSnapToPixel=function(){return this.snapToPixel_},e.style.Image.prototype.getAnchor=function(){},e.style.Image.prototype.getImage=function(t){},e.style.Image.prototype.getHitDetectionImage=function(t){},e.style.Image.prototype.getImageState=function(){},e.style.Image.prototype.getImageSize=function(){},e.style.Image.prototype.getHitDetectionImageSize=function(){},e.style.Image.prototype.getOrigin=function(){},e.style.Image.prototype.getSize=function(){},e.style.Image.prototype.setOpacity=function(t){this.opacity_=t},e.style.Image.prototype.setRotateWithView=function(t){this.rotateWithView_=t},e.style.Image.prototype.setRotation=function(t){this.rotation_=t},e.style.Image.prototype.setScale=function(t){this.scale_=t},e.style.Image.prototype.setSnapToPixel=function(t){this.snapToPixel_=t},e.style.Image.prototype.listenImageChange=function(t,e){},e.style.Image.prototype.load=function(){},e.style.Image.prototype.unlistenImageChange=function(t,e){},e.style.RegularShape=function(t){this.checksums_=null,this.canvas_=null,this.hitDetectionCanvas_=null,this.fill_=void 0!==t.fill?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=void 0!==t.radius?t.radius:t.radius1,this.radius2_=t.radius2,this.angle_=void 0!==t.angle?t.angle:0,this.stroke_=void 0!==t.stroke?t.stroke:null,this.anchor_=null,this.size_=null,this.imageSize_=null,this.hitDetectionImageSize_=null,this.atlasManager_=t.atlasManager,this.render_(this.atlasManager_);var r=void 0===t.snapToPixel||t.snapToPixel,n=void 0!==t.rotateWithView&&t.rotateWithView;e.style.Image.call(this,{opacity:1,rotateWithView:n,rotation:void 0!==t.rotation?t.rotation:0,scale:1,snapToPixel:r})},e.inherits(e.style.RegularShape,e.style.Image),e.style.RegularShape.prototype.clone=function(){var t=new e.style.RegularShape({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),snapToPixel:this.getSnapToPixel(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),atlasManager:this.atlasManager_});return t.setOpacity(this.getOpacity()),t.setScale(this.getScale()),t},e.style.RegularShape.prototype.getAnchor=function(){return this.anchor_},e.style.RegularShape.prototype.getAngle=function(){return this.angle_},e.style.RegularShape.prototype.getFill=function(){return this.fill_},e.style.RegularShape.prototype.getHitDetectionImage=function(t){return this.hitDetectionCanvas_},e.style.RegularShape.prototype.getImage=function(t){return this.canvas_},e.style.RegularShape.prototype.getImageSize=function(){return this.imageSize_},e.style.RegularShape.prototype.getHitDetectionImageSize=function(){return this.hitDetectionImageSize_},e.style.RegularShape.prototype.getImageState=function(){return e.ImageState.LOADED},e.style.RegularShape.prototype.getOrigin=function(){return this.origin_},e.style.RegularShape.prototype.getPoints=function(){return this.points_},e.style.RegularShape.prototype.getRadius=function(){return this.radius_},e.style.RegularShape.prototype.getRadius2=function(){return this.radius2_},e.style.RegularShape.prototype.getSize=function(){return this.size_},e.style.RegularShape.prototype.getStroke=function(){return this.stroke_},e.style.RegularShape.prototype.listenImageChange=function(t,e){},e.style.RegularShape.prototype.load=function(){},e.style.RegularShape.prototype.unlistenImageChange=function(t,e){},e.style.RegularShape.prototype.render_=function(t){var r,n,i="",o="",s=0,a=null,l=0,h=0;this.stroke_&&(n=this.stroke_.getColor(),null===n&&(n=e.render.canvas.defaultStrokeStyle),n=e.colorlike.asColorLike(n),h=this.stroke_.getWidth(),void 0===h&&(h=e.render.canvas.defaultLineWidth),a=this.stroke_.getLineDash(),l=this.stroke_.getLineDashOffset(),e.has.CANVAS_LINE_DASH||(a=null,l=0),o=this.stroke_.getLineJoin(),void 0===o&&(o=e.render.canvas.defaultLineJoin),i=this.stroke_.getLineCap(),void 0===i&&(i=e.render.canvas.defaultLineCap),void 0===(s=this.stroke_.getMiterLimit())&&(s=e.render.canvas.defaultMiterLimit));var u=2*(this.radius_+h)+1,c={strokeStyle:n,strokeWidth:h,size:u,lineCap:i,lineDash:a,lineDashOffset:l,lineJoin:o,miterLimit:s};if(void 0===t){var f=e.dom.createCanvasContext2D(u,u);this.canvas_=f.canvas,u=this.canvas_.width,r=u,this.draw_(c,f,0,0),this.createHitDetectionCanvas_(c)}else{u=Math.round(u);var d,p=!this.fill_;p&&(d=this.drawHitDetectionCanvas_.bind(this,c));var g=this.getChecksum(),y=t.add(g,u,u,this.draw_.bind(this,c),d);this.canvas_=y.image,this.origin_=[y.offsetX,y.offsetY],r=y.image.width,p?(this.hitDetectionCanvas_=y.hitImage,this.hitDetectionImageSize_=[y.hitImage.width,y.hitImage.height]):(this.hitDetectionCanvas_=this.canvas_,this.hitDetectionImageSize_=[r,r])}this.anchor_=[u/2,u/2],this.size_=[u,u],this.imageSize_=[r,r]},e.style.RegularShape.prototype.draw_=function(t,r,n,i){var o,s,a;r.setTransform(1,0,0,1,0,0),r.translate(n,i),r.beginPath();var l=this.points_;if(l===1/0)r.arc(t.size/2,t.size/2,this.radius_,0,2*Math.PI,!0);else{var h=void 0!==this.radius2_?this.radius2_:this.radius_;for(h!==this.radius_&&(l*=2),o=0;o<=l;o++)s=2*o*Math.PI/l-Math.PI/2+this.angle_,a=o%2==0?this.radius_:h,r.lineTo(t.size/2+a*Math.cos(s),t.size/2+a*Math.sin(s))}if(this.fill_){var u=this.fill_.getColor();null===u&&(u=e.render.canvas.defaultFillStyle),r.fillStyle=e.colorlike.asColorLike(u),r.fill()}this.stroke_&&(r.strokeStyle=t.strokeStyle,r.lineWidth=t.strokeWidth,t.lineDash&&(r.setLineDash(t.lineDash),r.lineDashOffset=t.lineDashOffset),r.lineCap=t.lineCap,r.lineJoin=t.lineJoin,r.miterLimit=t.miterLimit,r.stroke()),r.closePath()},e.style.RegularShape.prototype.createHitDetectionCanvas_=function(t){if(this.hitDetectionImageSize_=[t.size,t.size],this.fill_)return void(this.hitDetectionCanvas_=this.canvas_);var r=e.dom.createCanvasContext2D(t.size,t.size);this.hitDetectionCanvas_=r.canvas,this.drawHitDetectionCanvas_(t,r,0,0)},e.style.RegularShape.prototype.drawHitDetectionCanvas_=function(t,r,n,i){r.setTransform(1,0,0,1,0,0),r.translate(n,i),r.beginPath();var o=this.points_;if(o===1/0)r.arc(t.size/2,t.size/2,this.radius_,0,2*Math.PI,!0);else{var s=void 0!==this.radius2_?this.radius2_:this.radius_;s!==this.radius_&&(o*=2);var a,l,h;for(a=0;a<=o;a++)h=2*a*Math.PI/o-Math.PI/2+this.angle_,l=a%2==0?this.radius_:s,r.lineTo(t.size/2+l*Math.cos(h),t.size/2+l*Math.sin(h))}r.fillStyle=e.render.canvas.defaultFillStyle,r.fill(),this.stroke_&&(r.strokeStyle=t.strokeStyle,r.lineWidth=t.strokeWidth,t.lineDash&&(r.setLineDash(t.lineDash),r.lineDashOffset=t.lineDashOffset),r.stroke()),r.closePath()},e.style.RegularShape.prototype.getChecksum=function(){var t=this.stroke_?this.stroke_.getChecksum():"-",e=this.fill_?this.fill_.getChecksum():"-";if(!this.checksums_||t!=this.checksums_[1]||e!=this.checksums_[2]||this.radius_!=this.checksums_[3]||this.radius2_!=this.checksums_[4]||this.angle_!=this.checksums_[5]||this.points_!=this.checksums_[6]){var r="r"+t+e+(void 0!==this.radius_?this.radius_.toString():"-")+(void 0!==this.radius2_?this.radius2_.toString():"-")+(void 0!==this.angle_?this.angle_.toString():"-")+(void 0!==this.points_?this.points_.toString():"-");this.checksums_=[r,t,e,this.radius_,this.radius2_,this.angle_,this.points_]}return this.checksums_[0]},e.style.Circle=function(t){var r=t||{};e.style.RegularShape.call(this,{points:1/0,fill:r.fill,radius:r.radius,snapToPixel:r.snapToPixel,stroke:r.stroke,atlasManager:r.atlasManager})},e.inherits(e.style.Circle,e.style.RegularShape),e.style.Circle.prototype.clone=function(){var t=new e.style.Circle({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),snapToPixel:this.getSnapToPixel(),atlasManager:this.atlasManager_});return t.setOpacity(this.getOpacity()),t.setScale(this.getScale()),t},e.style.Circle.prototype.setRadius=function(t){this.radius_=t,this.render_(this.atlasManager_)},e.style.Fill=function(t){var e=t||{};this.color_=void 0!==e.color?e.color:null,this.checksum_=void 0},e.style.Fill.prototype.clone=function(){var t=this.getColor();return new e.style.Fill({color:t&&t.slice?t.slice():t||void 0})},e.style.Fill.prototype.getColor=function(){return this.color_},e.style.Fill.prototype.setColor=function(t){this.color_=t,this.checksum_=void 0},e.style.Fill.prototype.getChecksum=function(){return void 0===this.checksum_&&(this.color_ instanceof CanvasPattern||this.color_ instanceof CanvasGradient?this.checksum_=e.getUid(this.color_).toString():this.checksum_="f"+(this.color_?e.color.asString(this.color_):"-")),this.checksum_},e.style.Stroke=function(t){var e=t||{};this.color_=void 0!==e.color?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=void 0!==e.lineDash?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width,this.checksum_=void 0},e.style.Stroke.prototype.clone=function(){var t=this.getColor();return new e.style.Stroke({color:t&&t.slice?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},e.style.Stroke.prototype.getColor=function(){return this.color_},e.style.Stroke.prototype.getLineCap=function(){return this.lineCap_},e.style.Stroke.prototype.getLineDash=function(){return this.lineDash_},e.style.Stroke.prototype.getLineDashOffset=function(){return this.lineDashOffset_},e.style.Stroke.prototype.getLineJoin=function(){return this.lineJoin_},e.style.Stroke.prototype.getMiterLimit=function(){return this.miterLimit_},e.style.Stroke.prototype.getWidth=function(){return this.width_},e.style.Stroke.prototype.setColor=function(t){this.color_=t,this.checksum_=void 0},e.style.Stroke.prototype.setLineCap=function(t){this.lineCap_=t,this.checksum_=void 0},e.style.Stroke.prototype.setLineDash=function(t){this.lineDash_=t,this.checksum_=void 0},e.style.Stroke.prototype.setLineDashOffset=function(t){this.lineDashOffset_=t,this.checksum_=void 0},e.style.Stroke.prototype.setLineJoin=function(t){this.lineJoin_=t,this.checksum_=void 0},e.style.Stroke.prototype.setMiterLimit=function(t){this.miterLimit_=t,this.checksum_=void 0},e.style.Stroke.prototype.setWidth=function(t){this.width_=t,this.checksum_=void 0},e.style.Stroke.prototype.getChecksum=function(){return void 0===this.checksum_&&(this.checksum_="s",this.color_?"string"==typeof this.color_?this.checksum_+=this.color_:this.checksum_+=e.getUid(this.color_).toString():this.checksum_+="-",this.checksum_+=","+(void 0!==this.lineCap_?this.lineCap_.toString():"-")+","+(this.lineDash_?this.lineDash_.toString():"-")+","+(void 0!==this.lineDashOffset_?this.lineDashOffset_:"-")+","+(void 0!==this.lineJoin_?this.lineJoin_:"-")+","+(void 0!==this.miterLimit_?this.miterLimit_.toString():"-")+","+(void 0!==this.width_?this.width_.toString():"-")),this.checksum_},e.style.IconAnchorUnits={FRACTION:"fraction",PIXELS:"pixels"},e.style.IconImage=function(t,r,n,i,o,s){e.events.EventTarget.call(this),this.hitDetectionImage_=null,this.image_=t||new Image,null!==i&&(this.image_.crossOrigin=i),this.canvas_=s?document.createElement("CANVAS"):null,this.color_=s,this.imageListenerKeys_=null,this.imageState_=o,this.size_=n,this.src_=r,this.tainting_=!1,this.imageState_==e.ImageState.LOADED&&this.determineTainting_()},e.inherits(e.style.IconImage,e.events.EventTarget),e.style.IconImage.get=function(t,r,n,i,o,s){var a=e.style.iconImageCache,l=a.get(r,i,s);return l||(l=new e.style.IconImage(t,r,n,i,o,s),a.set(r,i,s,l)),l},e.style.IconImage.prototype.determineTainting_=function(){var t=e.dom.createCanvasContext2D(1,1);try{t.drawImage(this.image_,0,0),t.getImageData(0,0,1,1)}catch(t){this.tainting_=!0}},e.style.IconImage.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(e.events.EventType.CHANGE)},e.style.IconImage.prototype.handleImageError_=function(){this.imageState_=e.ImageState.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()},e.style.IconImage.prototype.handleImageLoad_=function(){this.imageState_=e.ImageState.LOADED,this.size_&&(this.image_.width=this.size_[0],this.image_.height=this.size_[1]),this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.determineTainting_(),this.replaceColor_(),this.dispatchChangeEvent_()},e.style.IconImage.prototype.getImage=function(t){return this.canvas_?this.canvas_:this.image_},e.style.IconImage.prototype.getImageState=function(){return this.imageState_},e.style.IconImage.prototype.getHitDetectionImage=function(t){if(!this.hitDetectionImage_)if(this.tainting_){var r=this.size_[0],n=this.size_[1],i=e.dom.createCanvasContext2D(r,n);i.fillRect(0,0,r,n),
this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},e.style.IconImage.prototype.getSize=function(){return this.size_},e.style.IconImage.prototype.getSrc=function(){return this.src_},e.style.IconImage.prototype.load=function(){if(this.imageState_==e.ImageState.IDLE){this.imageState_=e.ImageState.LOADING,this.imageListenerKeys_=[e.events.listenOnce(this.image_,e.events.EventType.ERROR,this.handleImageError_,this),e.events.listenOnce(this.image_,e.events.EventType.LOAD,this.handleImageLoad_,this)];try{this.image_.src=this.src_}catch(t){this.handleImageError_()}}},e.style.IconImage.prototype.replaceColor_=function(){if(!this.tainting_&&null!==this.color_){this.canvas_.width=this.image_.width,this.canvas_.height=this.image_.height;var t=this.canvas_.getContext("2d");t.drawImage(this.image_,0,0);for(var e=t.getImageData(0,0,this.image_.width,this.image_.height),r=e.data,n=this.color_[0]/255,i=this.color_[1]/255,o=this.color_[2]/255,s=0,a=r.length;s<a;s+=4)r[s]*=n,r[s+1]*=i,r[s+2]*=o;t.putImageData(e,0,0)}},e.style.IconImage.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(e.events.unlistenByKey),this.imageListenerKeys_=null},e.style.IconOrigin={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},e.style.Icon=function(t){var r=t||{};this.anchor_=void 0!==r.anchor?r.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=void 0!==r.anchorOrigin?r.anchorOrigin:e.style.IconOrigin.TOP_LEFT,this.anchorXUnits_=void 0!==r.anchorXUnits?r.anchorXUnits:e.style.IconAnchorUnits.FRACTION,this.anchorYUnits_=void 0!==r.anchorYUnits?r.anchorYUnits:e.style.IconAnchorUnits.FRACTION,this.crossOrigin_=void 0!==r.crossOrigin?r.crossOrigin:null;var n=void 0!==r.img?r.img:null,i=void 0!==r.imgSize?r.imgSize:null,o=r.src;void 0!==o&&0!==o.length||!n||(o=n.src||e.getUid(n).toString());var s=void 0!==r.src?e.ImageState.IDLE:e.ImageState.LOADED;this.color_=void 0!==r.color?e.color.asArray(r.color):null,this.iconImage_=e.style.IconImage.get(n,o,i,this.crossOrigin_,s,this.color_),this.offset_=void 0!==r.offset?r.offset:[0,0],this.offsetOrigin_=void 0!==r.offsetOrigin?r.offsetOrigin:e.style.IconOrigin.TOP_LEFT,this.origin_=null,this.size_=void 0!==r.size?r.size:null;var a=void 0!==r.opacity?r.opacity:1,l=void 0!==r.rotateWithView&&r.rotateWithView,h=void 0!==r.rotation?r.rotation:0,u=void 0!==r.scale?r.scale:1,c=void 0===r.snapToPixel||r.snapToPixel;e.style.Image.call(this,{opacity:a,rotation:h,scale:u,snapToPixel:c,rotateWithView:l})},e.inherits(e.style.Icon,e.style.Image),e.style.Icon.prototype.clone=function(){return new e.style.Icon({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,crossOrigin:this.crossOrigin_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,src:this.getSrc(),offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,size:null!==this.size_?this.size_.slice():void 0,opacity:this.getOpacity(),scale:this.getScale(),snapToPixel:this.getSnapToPixel(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},e.style.Icon.prototype.getAnchor=function(){if(this.normalizedAnchor_)return this.normalizedAnchor_;var t=this.anchor_,r=this.getSize();if(this.anchorXUnits_==e.style.IconAnchorUnits.FRACTION||this.anchorYUnits_==e.style.IconAnchorUnits.FRACTION){if(!r)return null;t=this.anchor_.slice(),this.anchorXUnits_==e.style.IconAnchorUnits.FRACTION&&(t[0]*=r[0]),this.anchorYUnits_==e.style.IconAnchorUnits.FRACTION&&(t[1]*=r[1])}if(this.anchorOrigin_!=e.style.IconOrigin.TOP_LEFT){if(!r)return null;t===this.anchor_&&(t=this.anchor_.slice()),this.anchorOrigin_!=e.style.IconOrigin.TOP_RIGHT&&this.anchorOrigin_!=e.style.IconOrigin.BOTTOM_RIGHT||(t[0]=-t[0]+r[0]),this.anchorOrigin_!=e.style.IconOrigin.BOTTOM_LEFT&&this.anchorOrigin_!=e.style.IconOrigin.BOTTOM_RIGHT||(t[1]=-t[1]+r[1])}return this.normalizedAnchor_=t,this.normalizedAnchor_},e.style.Icon.prototype.getColor=function(){return this.color_},e.style.Icon.prototype.getImage=function(t){return this.iconImage_.getImage(t)},e.style.Icon.prototype.getImageSize=function(){return this.iconImage_.getSize()},e.style.Icon.prototype.getHitDetectionImageSize=function(){return this.getImageSize()},e.style.Icon.prototype.getImageState=function(){return this.iconImage_.getImageState()},e.style.Icon.prototype.getHitDetectionImage=function(t){return this.iconImage_.getHitDetectionImage(t)},e.style.Icon.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var t=this.offset_;if(this.offsetOrigin_!=e.style.IconOrigin.TOP_LEFT){var r=this.getSize(),n=this.iconImage_.getSize();if(!r||!n)return null;t=t.slice(),this.offsetOrigin_!=e.style.IconOrigin.TOP_RIGHT&&this.offsetOrigin_!=e.style.IconOrigin.BOTTOM_RIGHT||(t[0]=n[0]-r[0]-t[0]),this.offsetOrigin_!=e.style.IconOrigin.BOTTOM_LEFT&&this.offsetOrigin_!=e.style.IconOrigin.BOTTOM_RIGHT||(t[1]=n[1]-r[1]-t[1])}return this.origin_=t,this.origin_},e.style.Icon.prototype.getSrc=function(){return this.iconImage_.getSrc()},e.style.Icon.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},e.style.Icon.prototype.listenImageChange=function(t,r){return e.events.listen(this.iconImage_,e.events.EventType.CHANGE,t,r)},e.style.Icon.prototype.load=function(){this.iconImage_.load()},e.style.Icon.prototype.unlistenImageChange=function(t,r){e.events.unlisten(this.iconImage_,e.events.EventType.CHANGE,t,r)},e.style.Text=function(t){var r=t||{};this.font_=r.font,this.rotation_=r.rotation,this.rotateWithView_=r.rotateWithView,this.scale_=r.scale,this.text_=r.text,this.textAlign_=r.textAlign,this.textBaseline_=r.textBaseline,this.fill_=void 0!==r.fill?r.fill:new e.style.Fill({color:e.style.Text.DEFAULT_FILL_COLOR_}),this.maxAngle_=void 0!==r.maxAngle?r.maxAngle:Math.PI/4,this.placement_=void 0!==r.placement?r.placement:e.style.TextPlacement.POINT;var n=void 0===r.overflow?r.exceedLength:r.overflow;this.overflow_=void 0!==n&&n,this.stroke_=void 0!==r.stroke?r.stroke:null,this.offsetX_=void 0!==r.offsetX?r.offsetX:0,this.offsetY_=void 0!==r.offsetY?r.offsetY:0,this.backgroundFill_=r.backgroundFill?r.backgroundFill:null,this.backgroundStroke_=r.backgroundStroke?r.backgroundStroke:null,this.padding_=void 0===r.padding?null:r.padding},e.style.Text.DEFAULT_FILL_COLOR_="#333",e.style.Text.prototype.clone=function(){return new e.style.Text({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:this.getScale(),text:this.getText(),textAlign:this.getTextAlign(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY()})},e.style.Text.prototype.getOverflow=function(){return this.overflow_},e.style.Text.prototype.getFont=function(){return this.font_},e.style.Text.prototype.getMaxAngle=function(){return this.maxAngle_},e.style.Text.prototype.getPlacement=function(){return this.placement_},e.style.Text.prototype.getOffsetX=function(){return this.offsetX_},e.style.Text.prototype.getOffsetY=function(){return this.offsetY_},e.style.Text.prototype.getFill=function(){return this.fill_},e.style.Text.prototype.getRotateWithView=function(){return this.rotateWithView_},e.style.Text.prototype.getRotation=function(){return this.rotation_},e.style.Text.prototype.getScale=function(){return this.scale_},e.style.Text.prototype.getStroke=function(){return this.stroke_},e.style.Text.prototype.getText=function(){return this.text_},e.style.Text.prototype.getTextAlign=function(){return this.textAlign_},e.style.Text.prototype.getTextBaseline=function(){return this.textBaseline_},e.style.Text.prototype.getBackgroundFill=function(){return this.backgroundFill_},e.style.Text.prototype.getBackgroundStroke=function(){return this.backgroundStroke_},e.style.Text.prototype.getPadding=function(){return this.padding_},e.style.Text.prototype.setOverflow=function(t){this.overflow_=t},e.style.Text.prototype.setFont=function(t){this.font_=t},e.style.Text.prototype.setMaxAngle=function(t){this.maxAngle_=t},e.style.Text.prototype.setOffsetX=function(t){this.offsetX_=t},e.style.Text.prototype.setOffsetY=function(t){this.offsetY_=t},e.style.Text.prototype.setPlacement=function(t){this.placement_=t},e.style.Text.prototype.setFill=function(t){this.fill_=t},e.style.Text.prototype.setRotation=function(t){this.rotation_=t},e.style.Text.prototype.setScale=function(t){this.scale_=t},e.style.Text.prototype.setStroke=function(t){this.stroke_=t},e.style.Text.prototype.setText=function(t){this.text_=t},e.style.Text.prototype.setTextAlign=function(t){this.textAlign_=t},e.style.Text.prototype.setTextBaseline=function(t){this.textBaseline_=t},e.style.Text.prototype.setBackgroundFill=function(t){this.backgroundFill_=t},e.style.Text.prototype.setBackgroundStroke=function(t){this.backgroundStroke_=t},e.style.Text.prototype.setPadding=function(t){this.padding_=t},e.style.Style=function(t){var r=t||{};this.geometry_=null,this.geometryFunction_=e.style.Style.defaultGeometryFunction,void 0!==r.geometry&&this.setGeometry(r.geometry),this.fill_=void 0!==r.fill?r.fill:null,this.image_=void 0!==r.image?r.image:null,this.renderer_=void 0!==r.renderer?r.renderer:null,this.stroke_=void 0!==r.stroke?r.stroke:null,this.text_=void 0!==r.text?r.text:null,this.zIndex_=r.zIndex},e.style.Style.prototype.clone=function(){var t=this.getGeometry();return t&&t.clone&&(t=t.clone()),new e.style.Style({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},e.style.Style.prototype.getRenderer=function(){return this.renderer_},e.style.Style.prototype.setRenderer=function(t){this.renderer_=t},e.style.Style.prototype.getGeometry=function(){return this.geometry_},e.style.Style.prototype.getGeometryFunction=function(){return this.geometryFunction_},e.style.Style.prototype.getFill=function(){return this.fill_},e.style.Style.prototype.setFill=function(t){this.fill_=t},e.style.Style.prototype.getImage=function(){return this.image_},e.style.Style.prototype.setImage=function(t){this.image_=t},e.style.Style.prototype.getStroke=function(){return this.stroke_},e.style.Style.prototype.setStroke=function(t){this.stroke_=t},e.style.Style.prototype.getText=function(){return this.text_},e.style.Style.prototype.setText=function(t){this.text_=t},e.style.Style.prototype.getZIndex=function(){return this.zIndex_},e.style.Style.prototype.setGeometry=function(t){"function"==typeof t?this.geometryFunction_=t:"string"==typeof t?this.geometryFunction_=function(e){return e.get(t)}:t?void 0!==t&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=e.style.Style.defaultGeometryFunction,this.geometry_=t},e.style.Style.prototype.setZIndex=function(t){this.zIndex_=t},e.style.Style.createFunction=function(t){var r;if("function"==typeof t)r=t;else{var n;Array.isArray(t)?n=t:(e.asserts.assert(t instanceof e.style.Style,41),n=[t]),r=function(){return n}}return r},e.style.Style.default_=null,e.style.Style.defaultFunction=function(t,r){if(!e.style.Style.default_){var n=new e.style.Fill({color:"rgba(255,255,255,0.4)"}),i=new e.style.Stroke({color:"#3399CC",width:1.25});e.style.Style.default_=[new e.style.Style({image:new e.style.Circle({fill:n,stroke:i,radius:5}),fill:n,stroke:i})]}return e.style.Style.default_},e.style.Style.createDefaultEditing=function(){var t={},r=[255,255,255,1],n=[0,153,255,1];return t[e.geom.GeometryType.POLYGON]=[new e.style.Style({fill:new e.style.Fill({color:[255,255,255,.5]})})],t[e.geom.GeometryType.MULTI_POLYGON]=t[e.geom.GeometryType.POLYGON],t[e.geom.GeometryType.LINE_STRING]=[new e.style.Style({stroke:new e.style.Stroke({color:r,width:5})}),new e.style.Style({stroke:new e.style.Stroke({color:n,width:3})})],t[e.geom.GeometryType.MULTI_LINE_STRING]=t[e.geom.GeometryType.LINE_STRING],t[e.geom.GeometryType.CIRCLE]=t[e.geom.GeometryType.POLYGON].concat(t[e.geom.GeometryType.LINE_STRING]),t[e.geom.GeometryType.POINT]=[new e.style.Style({image:new e.style.Circle({radius:6,fill:new e.style.Fill({color:n}),stroke:new e.style.Stroke({color:r,width:1.5})}),zIndex:1/0})],t[e.geom.GeometryType.MULTI_POINT]=t[e.geom.GeometryType.POINT],t[e.geom.GeometryType.GEOMETRY_COLLECTION]=t[e.geom.GeometryType.POLYGON].concat(t[e.geom.GeometryType.LINE_STRING],t[e.geom.GeometryType.POINT]),t},e.style.Style.defaultGeometryFunction=function(t){return t.getGeometry()},e.ext={},e.ext.rbush=function(){},function(){!function(t){function e(t,e,n,o,s){r(t,e,n||0,o||t.length-1,s||i)}function r(t,e,i,o,s){for(;o>i;){if(o-i>600){var a=o-i+1,l=e-i+1,h=Math.log(a),u=.5*Math.exp(2*h/3),c=.5*Math.sqrt(h*u*(a-u)/a)*(l-a/2<0?-1:1);r(t,e,Math.max(i,Math.floor(e-l*u/a+c)),Math.min(o,Math.floor(e+(a-l)*u/a+c)),s)}var f=t[e],d=i,p=o;for(n(t,i,e),s(t[o],f)>0&&n(t,i,o);d<p;){for(n(t,d,p),d++,p--;s(t[d],f)<0;)d++;for(;s(t[p],f)>0;)p--}0===s(t[i],f)?n(t,i,p):(p++,n(t,p,o)),p<=e&&(i=p+1),e<=p&&(o=p-1)}}function n(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function i(t,e){return t<e?-1:t>e?1:0}function o(t,e){if(!(this instanceof o))return new o(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function s(t,e,r){if(!r)return e.indexOf(t);for(var n=0;n<e.length;n++)if(r(t,e[n]))return n;return-1}function a(t,e){l(t,0,t.children.length,e,t)}function l(t,e,r,n,i){i||(i=v(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,s=e;s<r;s++)o=t.children[s],h(i,t.leaf?n(o):o);return i}function h(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function u(t,e){return t.minX-e.minX}function c(t,e){return t.minY-e.minY}function f(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function d(t){return t.maxX-t.minX+(t.maxY-t.minY)}function p(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function g(t,e){var r=Math.max(t.minX,e.minX),n=Math.max(t.minY,e.minY),i=Math.min(t.maxX,e.maxX),o=Math.min(t.maxY,e.maxY);return Math.max(0,i-r)*Math.max(0,o-n)}function y(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function m(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function v(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function _(t,e,r,n,i){for(var o,s=[e,r];s.length;)r=s.pop(),e=s.pop(),r-e<=n||(o=e+Math.ceil((r-e)/n/2)*n,S(t,o,e,r,i),s.push(e,o,o,r))}var S=e,C=e;S.default=C;var x=o;o.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,r=[],n=this.toBBox;if(!m(t,e))return r;for(var i,o,s,a,l=[];e;){for(i=0,o=e.children.length;i<o;i++)s=e.children[i],a=e.leaf?n(s):s,m(t,a)&&(e.leaf?r.push(s):y(t,a)?this._all(s,r):l.push(s));e=l.pop()}return r},collides:function(t){var e=this.data,r=this.toBBox;if(!m(t,e))return!1;for(var n,i,o,s,a=[];e;){for(n=0,i=e.children.length;n<i;n++)if(o=e.children[n],s=e.leaf?r(o):o,m(t,s)){if(e.leaf||y(t,s))return!0;a.push(o)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,r=t.length;e<r;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=v([]),this},remove:function(t,e){if(!t)return this;for(var r,n,i,o,a=this.data,l=this.toBBox(t),h=[],u=[];a||h.length;){if(a||(a=h.pop(),n=h[h.length-1],r=u.pop(),o=!0),a.leaf&&-1!==(i=s(t,a.children,e)))return a.children.splice(i,1),h.push(a),this._condense(h),this;o||a.leaf||!y(a,l)?n?(r++,a=n.children[r],o=!1):a=null:(h.push(a),u.push(r),r=0,n=a,a=a.children[0])}return this},toBBox:function(t){return t},compareMinX:u,compareMinY:c,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},_build:function(t,e,r,n){var i,o=r-e+1,s=this._maxEntries;if(o<=s)return i=v(t.slice(e,r+1)),a(i,this.toBBox),i;n||(n=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,n-1))),i=v([]),i.leaf=!1,i.height=n;var l,h,u,c,f=Math.ceil(o/s),d=f*Math.ceil(Math.sqrt(s));for(_(t,e,r,d,this.compareMinX),l=e;l<=r;l+=d)for(u=Math.min(l+d-1,r),_(t,l,u,f,this.compareMinY),h=l;h<=u;h+=f)c=Math.min(h+f-1,u),i.children.push(this._build(t,h,c,n-1));return a(i,this.toBBox),i},_chooseSubtree:function(t,e,r,n){for(var i,o,s,a,l,h,u,c;;){if(n.push(e),e.leaf||n.length-1===r)break;for(u=c=1/0,i=0,o=e.children.length;i<o;i++)s=e.children[i],l=f(s),h=p(t,s)-l,h<c?(c=h,u=l<u?l:u,a=s):h===c&&l<u&&(u=l,a=s);e=a||e.children[0]}return e},_insert:function(t,e,r){var n=this.toBBox,i=r?t:n(t),o=[],s=this._chooseSubtree(i,this.data,e,o);for(s.children.push(t),h(s,i);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)},_split:function(t,e){var r=t[e],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);var o=this._chooseSplitIndex(r,i,n),s=v(r.children.splice(o,r.children.length-o));s.height=r.height,s.leaf=r.leaf,a(r,this.toBBox),a(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(r,s)},_splitRoot:function(t,e){this.data=v([t,e]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,r){var n,i,o,s,a,h,u,c;for(h=u=1/0,n=e;n<=r-e;n++)i=l(t,0,n,this.toBBox),o=l(t,n,r,this.toBBox),s=g(i,o),a=f(i)+f(o),s<h?(h=s,c=n,u=a<u?a:u):s===h&&a<u&&(u=a,c=n);return c},_chooseSplitAxis:function(t,e,r){var n=t.leaf?this.compareMinX:u,i=t.leaf?this.compareMinY:c;this._allDistMargin(t,e,r,n)<this._allDistMargin(t,e,r,i)&&t.children.sort(n)},_allDistMargin:function(t,e,r,n){t.children.sort(n);var i,o,s=this.toBBox,a=l(t,0,e,s),u=l(t,r-e,r,s),c=d(a)+d(u);for(i=e;i<r-e;i++)o=t.children[i],h(a,t.leaf?s(o):o),c+=d(a);for(i=r-e-1;i>=e;i--)o=t.children[i],h(u,t.leaf?s(o):o),c+=d(u);return c},_adjustParentBBoxes:function(t,e,r){for(var n=r;n>=0;n--)h(e[n],t)},_condense:function(t){for(var e,r=t.length-1;r>=0;r--)0===t[r].children.length?r>0?(e=t[r-1].children,e.splice(e.indexOf(t[r]),1)):this.clear():a(t[r],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}},t.default=x}(this.rbush=this.rbush||{})}.call(e.ext),e.ext.rbush=e.ext.rbush.default,e.render={},e.render.VectorContext=function(){},e.render.VectorContext.prototype.drawCustom=function(t,e,r){},e.render.VectorContext.prototype.drawGeometry=function(t){},e.render.VectorContext.prototype.setStyle=function(t){},e.render.VectorContext.prototype.drawCircle=function(t,e){},e.render.VectorContext.prototype.drawFeature=function(t,e){},e.render.VectorContext.prototype.drawGeometryCollection=function(t,e){},e.render.VectorContext.prototype.drawLineString=function(t,e){},e.render.VectorContext.prototype.drawMultiLineString=function(t,e){},e.render.VectorContext.prototype.drawMultiPoint=function(t,e){},e.render.VectorContext.prototype.drawMultiPolygon=function(t,e){},e.render.VectorContext.prototype.drawPoint=function(t,e){},e.render.VectorContext.prototype.drawPolygon=function(t,e){},e.render.VectorContext.prototype.drawText=function(t,e){},e.render.VectorContext.prototype.setFillStrokeStyle=function(t,e){},e.render.VectorContext.prototype.setImageStyle=function(t,e){},e.render.VectorContext.prototype.setTextStyle=function(t,e){},e.render.ReplayGroup={},e.render.ReplayGroup=function(){},e.render.ReplayGroup.prototype.getReplay=function(t,e){},e.render.ReplayGroup.prototype.isEmpty=function(){},e.render.ReplayType={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"},e.geom.flat.length={},e.geom.flat.length.lineString=function(t,e,r,n){var i,o=t[e],s=t[e+1],a=0;for(i=e+n;i<r;i+=n){var l=t[i],h=t[i+1];a+=Math.sqrt((l-o)*(l-o)+(h-s)*(h-s)),o=l,s=h}return a},e.geom.flat.length.linearRing=function(t,r,n,i){var o=e.geom.flat.length.lineString(t,r,n,i),s=t[n-i]-t[r],a=t[n-i+1]-t[r+1];return o+=Math.sqrt(s*s+a*a)},e.geom.flat.textpath={},e.geom.flat.textpath.lineString=function(t,r,n,i,o,s,a,l){var h=[],u=t[r]>t[n-i],c=o.length,f=t[r],d=t[r+1];r+=i;for(var p,g,y,m=t[r],v=t[r+1],_=0,S=Math.sqrt(Math.pow(m-f,2)+Math.pow(v-d,2)),C="",x=0,I=0;I<c;++I){g=u?c-I-1:I;var E=o.charAt(g);C=u?E+C:C+E;var T=s(C)-x;x+=T;for(var R=a+T/2;r<n-i&&_+S<R;)f=m,d=v,r+=i,m=t[r],v=t[r+1],_+=S,S=Math.sqrt(Math.pow(m-f,2)+Math.pow(v-d,2));var O=R-_,L=Math.atan2(v-d,m-f);if(u&&(L+=L>0?-Math.PI:Math.PI),void 0!==y){var F=L-y;if(F+=F>Math.PI?-2*Math.PI:F<-Math.PI?2*Math.PI:0,Math.abs(F)>l)return null}var w=O/S,M=e.math.lerp(f,m,w),A=e.math.lerp(d,v,w);y==L?(u&&(p[0]=M,p[1]=A,p[2]=T/2),p[4]=C):(C=E,x=T,p=[M,A,T/2,L,C],u?h.unshift(p):h.push(p),y=L),a+=T}return h},e.structs.LRUCache=function(t){e.events.EventTarget.call(this),this.highWaterMark=void 0!==t?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null},e.inherits(e.structs.LRUCache,e.events.EventTarget),e.structs.LRUCache.prototype.canExpireCache=function(){return this.getCount()>this.highWaterMark},e.structs.LRUCache.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null,this.dispatchEvent(e.events.EventType.CLEAR)},e.structs.LRUCache.prototype.containsKey=function(t){return this.entries_.hasOwnProperty(t)},e.structs.LRUCache.prototype.forEach=function(t,e){for(var r=this.oldest_;r;)t.call(e,r.value_,r.key_,this),r=r.newer},e.structs.LRUCache.prototype.get=function(t){var r=this.entries_[t];return e.asserts.assert(void 0!==r,15),r===this.newest_?r.value_:(r===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(r.newer.older=r.older,r.older.newer=r.newer),r.newer=null,r.older=this.newest_,this.newest_.newer=r,this.newest_=r,r.value_)},e.structs.LRUCache.prototype.remove=function(t){var r=this.entries_[t];return e.asserts.assert(void 0!==r,15),r===this.newest_?(this.newest_=r.older,this.newest_&&(this.newest_.newer=null)):r===this.oldest_?(this.oldest_=r.newer,this.oldest_&&(this.oldest_.older=null)):(r.newer.older=r.older,r.older.newer=r.newer),delete this.entries_[t],--this.count_,r.value_},e.structs.LRUCache.prototype.getCount=function(){return this.count_},e.structs.LRUCache.prototype.getKeys=function(){var t,e=new Array(this.count_),r=0;for(t=this.newest_;t;t=t.older)e[r++]=t.key_;return e},e.structs.LRUCache.prototype.getValues=function(){var t,e=new Array(this.count_),r=0;for(t=this.newest_;t;t=t.older)e[r++]=t.value_;return e},e.structs.LRUCache.prototype.peekLast=function(){return this.oldest_.value_},e.structs.LRUCache.prototype.peekLastKey=function(){return this.oldest_.key_},e.structs.LRUCache.prototype.peekFirstKey=function(){return this.newest_.key_},e.structs.LRUCache.prototype.pop=function(){var t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_},e.structs.LRUCache.prototype.replace=function(t,e){this.get(t),this.entries_[t].value_=e},e.structs.LRUCache.prototype.set=function(t,r){e.asserts.assert(!(t in this.entries_),16);var n={key_:t,newer:null,older:this.newest_,value_:r};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_},e.structs.LRUCache.prototype.prune=function(){for(;this.canExpireCache();)this.pop()},e.render.canvas={},e.render.canvas.defaultFont="10px sans-serif",e.render.canvas.defaultFillStyle=[0,0,0,1],e.render.canvas.defaultLineCap="round",e.render.canvas.defaultLineDash=[],e.render.canvas.defaultLineDashOffset=0,e.render.canvas.defaultLineJoin="round",e.render.canvas.defaultMiterLimit=10,e.render.canvas.defaultStrokeStyle=[0,0,0,1],e.render.canvas.defaultTextAlign="center",e.render.canvas.defaultTextBaseline="middle",e.render.canvas.defaultPadding=[0,0,0,0],e.render.canvas.defaultLineWidth=1,e.render.canvas.labelCache=new e.structs.LRUCache,e.render.canvas.checkedFonts_={},e.render.canvas.measureContext_=null,e.render.canvas.textHeights_={},e.render.canvas.checkFont=function(){function t(t){var r=e.render.canvas.getMeasureContext();r.font=l,i=r.measureText(h).width;var n=!0;if("monospace"!=t){r.font="32px "+t+",monospace";n=r.measureText(h).width!=i}return n}function r(){var r=!0;for(var i in s)s[i]<o&&(t(i)?(s[i]=o,e.obj.clear(e.render.canvas.textHeights_),e.render.canvas.measureContext_=null,a.clear()):(++s[i],r=!1));r&&(window.clearInterval(n),n=void 0)}var n,i,o=60,s=e.render.canvas.checkedFonts_,a=e.render.canvas.labelCache,l="32px monospace",h="wmytzilWMYTZIL@#/&?$%10";return function(i){var a=e.css.getFontFamilies(i);if(a)for(var l=0,h=a.length;l<h;++l){var u=a[l];u in s||(s[u]=o,t(u)||(s[u]=0,void 0===n&&(n=window.setInterval(r,32))))}}}(),e.render.canvas.getMeasureContext=function(){var t=e.render.canvas.measureContext_;return t||(t=e.render.canvas.measureContext_=e.dom.createCanvasContext2D(1,1)),t},e.render.canvas.measureTextHeight=function(){var t=e.render.canvas.textHeights_;return function(e){var r=t[e];return void 0==r&&(r=t[e]=19),r}}(),e.render.canvas.measureTextWidth=function(t,r){var n=e.render.canvas.getMeasureContext();return t!=n.font&&(n.font=t),n.measureText(r).width},e.render.canvas.rotateAtOffset=function(t,e,r,n){0!==e&&(t.translate(r,n),t.rotate(e),t.translate(-r,-n))},e.render.canvas.resetTransform_=e.transform.create(),e.render.canvas.drawImage=function(t,r,n,i,o,s,a,l,h,u,c){var f;1!=n&&(f=t.globalAlpha,t.globalAlpha=f*n),r&&t.setTransform.apply(t,r),t.drawImage(i,o,s,a,l,h,u,a*c,l*c),f&&(t.globalAlpha=f),r&&t.setTransform.apply(t,e.render.canvas.resetTransform_)},e.render.canvas.Instruction={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},e.render.replay={},e.render.replay.ORDER=[e.render.ReplayType.POLYGON,e.render.ReplayType.CIRCLE,e.render.ReplayType.LINE_STRING,e.render.ReplayType.IMAGE,e.render.ReplayType.TEXT,e.render.ReplayType.DEFAULT],e.render.replay.TEXT_ALIGN={},e.render.replay.TEXT_ALIGN.left=0,e.render.replay.TEXT_ALIGN.end=0,e.render.replay.TEXT_ALIGN.center=.5,e.render.replay.TEXT_ALIGN.right=1,e.render.replay.TEXT_ALIGN.start=1,e.render.replay.TEXT_ALIGN.top=0,e.render.replay.TEXT_ALIGN.middle=.5,e.render.replay.TEXT_ALIGN.hanging=.2,e.render.replay.TEXT_ALIGN.alphabetic=.8,e.render.replay.TEXT_ALIGN.ideographic=.8,e.render.replay.TEXT_ALIGN.bottom=1,e.render.canvas.Replay=function(t,r,n,i,o,s){e.render.VectorContext.call(this),this.declutterTree=s,this.tmpExtent_=e.extent.createEmpty(),this.tolerance=t,this.maxExtent=r,this.overlaps=o,this.pixelRatio=i,this.maxLineWidth=0,this.resolution=n,this.fillOrigin_,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.coordinateCache_={},this.renderedTransform_=e.transform.create(),this.hitDetectionInstructions=[],this.pixelCoordinates_=null,this.state={},this.viewRotation_=0,this.tmpLocalTransform_=e.transform.create(),this.resetTransform_=e.transform.create()},e.inherits(e.render.canvas.Replay,e.render.VectorContext),e.render.canvas.Replay.prototype.replayTextBackground_=function(t,e,r,n,i,o,s){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,r),t.lineTo.apply(t,n),t.lineTo.apply(t,i),t.lineTo.apply(t,e),o&&(this.fillOrigin_=o[2],this.fill_(t)),s&&(this.setStrokeStyle_(t,s),t.stroke())},e.render.canvas.Replay.prototype.replayImage_=function(t,r,n,i,o,s,a,l,h,u,c,f,d,p,g,y,m,v){var _=m||v,S=this.tmpLocalTransform_;o*=d,s*=d,r-=o,n-=s,p&&(r=Math.round(r),n=Math.round(n));var C,x,I,E,T=g+u>i.width?i.width-u:g,R=l+c>i.height?i.height-c:l,O=this.tmpExtent_,L=y[3]+T*d+y[1],F=y[0]+R*d+y[2],w=r-y[3],M=n-y[0];(_||0!==f)&&(C=[w,M],x=[w+L,M],I=[w+L,M+F],E=[w,M+F]);var A=null;if(0!==f){var G=r+o,b=n+s;A=e.transform.compose(S,G,b,1,1,f,-G,-b),e.extent.createOrUpdateEmpty(O),e.extent.extendCoordinate(O,e.transform.apply(S,C)),e.extent.extendCoordinate(O,e.transform.apply(S,x)),e.extent.extendCoordinate(O,e.transform.apply(S,I)),e.extent.extendCoordinate(O,e.transform.apply(S,E))}else e.extent.createOrUpdate(w,M,w+L,M+F,O);var P=t.canvas,D=O[0]<=P.width&&O[2]>=0&&O[1]<=P.height&&O[3]>=0;if(a){if(!D&&1==a[4])return;e.extent.extend(a,O);var k=D?[t,A?A.slice(0):null,h,i,u,c,T,R,r,n,d]:null;k&&_&&k.push(m,v,C,x,I,E),a.push(k)}else D&&(_&&this.replayTextBackground_(t,C,x,I,E,m,v),e.render.canvas.drawImage(t,A,h,i,u,c,T,R,r,n,d))},e.render.canvas.Replay.prototype.applyPixelRatio=function(t){var e=this.pixelRatio;return 1==e?t:t.map(function(t){return t*e})},e.render.canvas.Replay.prototype.appendFlatCoordinates=function(t,r,n,i,o,s){var a=this.coordinates.length,l=this.getBufferedMaxExtent();s&&(r+=i);var h,u,c,f=[t[r],t[r+1]],d=[NaN,NaN],p=!0;for(h=r+i;h<n;h+=i)d[0]=t[h],d[1]=t[h+1],c=e.extent.coordinateRelationship(l,d),c!==u?(p&&(this.coordinates[a++]=f[0],this.coordinates[a++]=f[1]),this.coordinates[a++]=d[0],this.coordinates[a++]=d[1],p=!1):c===e.extent.Relationship.INTERSECTING?(this.coordinates[a++]=d[0],this.coordinates[a++]=d[1],p=!1):p=!0,f[0]=d[0],f[1]=d[1],u=c;return(o&&p||h===r+i)&&(this.coordinates[a++]=f[0],this.coordinates[a++]=f[1]),a},e.render.canvas.Replay.prototype.drawCustomCoordinates_=function(t,e,r,n,i){for(var o=0,s=r.length;o<s;++o){var a=r[o],l=this.appendFlatCoordinates(t,e,a,n,!1,!1);i.push(l),e=a}return e},e.render.canvas.Replay.prototype.drawCustom=function(t,r,n){this.beginGeometry(t,r);var i,o,s,a,l,h=t.getType(),u=t.getStride(),c=this.coordinates.length;if(h==e.geom.GeometryType.MULTI_POLYGON){t=t,i=t.getOrientedFlatCoordinates(),a=[];var f=t.getEndss();l=0;for(var d=0,p=f.length;d<p;++d){var g=[];l=this.drawCustomCoordinates_(i,l,f[d],u,g),a.push(g)}this.instructions.push([e.render.canvas.Instruction.CUSTOM,c,a,t,n,e.geom.flat.inflate.coordinatesss])}else h==e.geom.GeometryType.POLYGON||h==e.geom.GeometryType.MULTI_LINE_STRING?(s=[],i=h==e.geom.GeometryType.POLYGON?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),l=this.drawCustomCoordinates_(i,0,t.getEnds(),u,s),this.instructions.push([e.render.canvas.Instruction.CUSTOM,c,s,t,n,e.geom.flat.inflate.coordinatess])):h==e.geom.GeometryType.LINE_STRING||h==e.geom.GeometryType.MULTI_POINT?(i=t.getFlatCoordinates(),o=this.appendFlatCoordinates(i,0,i.length,u,!1,!1),this.instructions.push([e.render.canvas.Instruction.CUSTOM,c,o,t,n,e.geom.flat.inflate.coordinates])):h==e.geom.GeometryType.POINT&&(i=t.getFlatCoordinates(),this.coordinates.push(i[0],i[1]),o=this.coordinates.length,this.instructions.push([e.render.canvas.Instruction.CUSTOM,c,o,t,n]));this.endGeometry(t,r)},e.render.canvas.Replay.prototype.beginGeometry=function(t,r){this.beginGeometryInstruction1_=[e.render.canvas.Instruction.BEGIN_GEOMETRY,r,0],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[e.render.canvas.Instruction.BEGIN_GEOMETRY,r,0],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},e.render.canvas.Replay.prototype.fill_=function(t){if(this.fillOrigin_){var r=e.transform.apply(this.renderedTransform_,this.fillOrigin_.slice());t.translate(r[0],r[1]),
t.rotate(this.viewRotation_)}t.fill(),this.fillOrigin_&&t.setTransform.apply(t,e.render.canvas.resetTransform_)},e.render.canvas.Replay.prototype.setStrokeStyle_=function(t,r){t.strokeStyle=r[1],t.lineWidth=r[2],t.lineCap=r[3],t.lineJoin=r[4],t.miterLimit=r[5],e.has.CANVAS_LINE_DASH&&(t.lineDashOffset=r[7],t.setLineDash(r[6]))},e.render.canvas.Replay.prototype.renderDeclutter_=function(t,r){if(t&&t.length>5){var n=t[4];if(1==n||n==t.length-5){var i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:r};if(!this.declutterTree.collides(i)){this.declutterTree.insert(i);for(var o=e.render.canvas.drawImage,s=5,a=t.length;s<a;++s){var l=t[s];l&&(l.length>11&&this.replayTextBackground_(l[0],l[13],l[14],l[15],l[16],l[11],l[12]),o.apply(void 0,l))}}t.length=5,e.extent.createOrUpdateEmpty(t)}}},e.render.canvas.Replay.prototype.replay_=function(t,r,n,i,o,s){var a;this.pixelCoordinates_&&e.array.equals(r,this.renderedTransform_)?a=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),a=e.geom.flat.transform.transform2D(this.coordinates,0,this.coordinates.length,2,r,this.pixelCoordinates_),e.transform.setFromArray(this.renderedTransform_,r));for(var l,h,u,c,f,d,p,g,y,m=!e.obj.isEmpty(n),v=0,_=i.length,S=0,C=0,x=0,I=null,E=null,T=this.coordinateCache_,R=this.viewRotation_,O={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:R},L=this.instructions!=i||this.overlaps?0:200;v<_;){var F,w,M,A=i[v],G=A[0];switch(G){case e.render.canvas.Instruction.BEGIN_GEOMETRY:F=A[1],m&&n[e.getUid(F).toString()]||!F.getGeometry()?v=A[2]:void 0===s||e.extent.intersects(s,F.getGeometry().getExtent())?++v:v=A[2]+1;break;case e.render.canvas.Instruction.BEGIN_PATH:C>L&&(this.fill_(t),C=0),x>L&&(t.stroke(),x=0),C||x||(t.beginPath(),c=f=NaN),++v;break;case e.render.canvas.Instruction.CIRCLE:S=A[1];var b=a[S],P=a[S+1],D=a[S+2],k=a[S+3],N=D-b,B=k-P,Y=Math.sqrt(N*N+B*B);t.moveTo(b+Y,P),t.arc(b,P,Y,0,2*Math.PI,!0),++v;break;case e.render.canvas.Instruction.CLOSE_PATH:t.closePath(),++v;break;case e.render.canvas.Instruction.CUSTOM:S=A[1],l=A[2];var U=A[3],V=A[4],W=6==A.length?A[5]:void 0;O.geometry=U,O.feature=F,v in T||(T[v]=[]);var X=T[v];W?W(a,S,l,2,X):(X[0]=a[S],X[1]=a[S+1],X.length=2),V(X,O),++v;break;case e.render.canvas.Instruction.DRAW_IMAGE:S=A[1],l=A[2],y=A[3],h=A[4],u=A[5],g=o?null:A[6];var H,j,q,z=A[7],K=A[8],Z=A[9],J=A[10],Q=A[11],$=A[12],tt=A[13],et=A[14],rt=A[15];for(A.length>16?(H=A[16],j=A[17],q=A[18]):(H=e.render.canvas.defaultPadding,j=q=!1),Q&&($+=R);S<l;S+=2)this.replayImage_(t,a[S],a[S+1],y,h,u,g,z,K,Z,J,$,tt,et,rt,H,j?I:null,q?E:null);this.renderDeclutter_(g,F),++v;break;case e.render.canvas.Instruction.DRAW_CHARS:var nt=A[1],it=A[2],ot=A[3];g=o?null:A[4];var st=A[5],at=A[6],lt=A[7],ht=A[8],ut=A[9],ct=A[10],ft=A[11],dt=A[12],pt=A[13],gt=A[14],yt=e.geom.flat.length.lineString(a,nt,it,2),mt=ht(dt);if(st||mt<=yt){var vt=this.textStates[pt].textAlign,_t=(yt-mt)*e.render.replay.TEXT_ALIGN[vt],St=e.geom.flat.textpath.lineString(a,nt,it,2,dt,ht,_t,lt);if(St){var Ct,xt,It,Et,Tt;if(ct)for(Ct=0,xt=St.length;Ct<xt;++Ct)Tt=St[Ct],It=Tt[4],Et=this.getImage(It,pt,"",ct),h=Tt[2]+ft,u=ot*Et.height+2*(.5-ot)*ft-ut,this.replayImage_(t,Tt[0],Tt[1],Et,h,u,g,Et.height,1,0,0,Tt[3],gt,!1,Et.width,e.render.canvas.defaultPadding,null,null);if(at)for(Ct=0,xt=St.length;Ct<xt;++Ct)Tt=St[Ct],It=Tt[4],Et=this.getImage(It,pt,at,""),h=Tt[2],u=ot*Et.height-ut,this.replayImage_(t,Tt[0],Tt[1],Et,h,u,g,Et.height,1,0,0,Tt[3],gt,!1,Et.width,e.render.canvas.defaultPadding,null,null)}}this.renderDeclutter_(g,F),++v;break;case e.render.canvas.Instruction.END_GEOMETRY:if(void 0!==o){F=A[1];var Rt=o(F);if(Rt)return Rt}++v;break;case e.render.canvas.Instruction.FILL:L?C++:this.fill_(t),++v;break;case e.render.canvas.Instruction.MOVE_TO_LINE_TO:for(S=A[1],l=A[2],w=a[S],M=a[S+1],d=w+.5|0,p=M+.5|0,d===c&&p===f||(t.moveTo(w,M),c=d,f=p),S+=2;S<l;S+=2)w=a[S],M=a[S+1],d=w+.5|0,p=M+.5|0,S!=l-2&&d===c&&p===f||(t.lineTo(w,M),c=d,f=p);++v;break;case e.render.canvas.Instruction.SET_FILL_STYLE:I=A,this.fillOrigin_=A[2],C&&(this.fill_(t),C=0,x&&(t.stroke(),x=0)),t.fillStyle=A[1],++v;break;case e.render.canvas.Instruction.SET_STROKE_STYLE:E=A,x&&(t.stroke(),x=0),this.setStrokeStyle_(t,A),++v;break;case e.render.canvas.Instruction.STROKE:L?x++:t.stroke(),++v;break;default:++v}}C&&this.fill_(t),x&&t.stroke()},e.render.canvas.Replay.prototype.replay=function(t,e,r,n){this.viewRotation_=r,this.replay_(t,e,n,this.instructions,void 0,void 0)},e.render.canvas.Replay.prototype.replayHitDetection=function(t,e,r,n,i,o){return this.viewRotation_=r,this.replay_(t,e,n,this.hitDetectionInstructions,i,o)},e.render.canvas.Replay.prototype.reverseHitDetectionInstructions=function(){var t=this.hitDetectionInstructions;t.reverse();var r,n,i,o=t.length,s=-1;for(r=0;r<o;++r)n=t[r],i=n[0],i==e.render.canvas.Instruction.END_GEOMETRY?s=r:i==e.render.canvas.Instruction.BEGIN_GEOMETRY&&(n[2]=r,e.array.reverseSubArray(this.hitDetectionInstructions,s,r),s=-1)},e.render.canvas.Replay.prototype.setFillStrokeStyle=function(t,r){var n=this.state;if(t){var i=t.getColor();n.fillStyle=e.colorlike.asColorLike(i||e.render.canvas.defaultFillStyle)}else n.fillStyle=void 0;if(r){var o=r.getColor();n.strokeStyle=e.colorlike.asColorLike(o||e.render.canvas.defaultStrokeStyle);var s=r.getLineCap();n.lineCap=void 0!==s?s:e.render.canvas.defaultLineCap;var a=r.getLineDash();n.lineDash=a?a.slice():e.render.canvas.defaultLineDash;var l=r.getLineDashOffset();n.lineDashOffset=l||e.render.canvas.defaultLineDashOffset;var h=r.getLineJoin();n.lineJoin=void 0!==h?h:e.render.canvas.defaultLineJoin;var u=r.getWidth();n.lineWidth=void 0!==u?u:e.render.canvas.defaultLineWidth;var c=r.getMiterLimit();n.miterLimit=void 0!==c?c:e.render.canvas.defaultMiterLimit,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0},e.render.canvas.Replay.prototype.applyFill=function(t,r){var n=t.fillStyle,i=[e.render.canvas.Instruction.SET_FILL_STYLE,n];if("string"!=typeof n){var o=r.getExtent();i.push([o[0],o[3]])}this.instructions.push(i)},e.render.canvas.Replay.prototype.applyStroke=function(t){this.instructions.push([e.render.canvas.Instruction.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio])},e.render.canvas.Replay.prototype.updateFillStyle=function(t,e,r){var n=t.fillStyle;"string"==typeof n&&t.currentFillStyle==n||(e.call(this,t,r),t.currentFillStyle=n)},e.render.canvas.Replay.prototype.updateStrokeStyle=function(t,r){var n=t.strokeStyle,i=t.lineCap,o=t.lineDash,s=t.lineDashOffset,a=t.lineJoin,l=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=n||t.currentLineCap!=i||o!=t.currentLineDash&&!e.array.equals(t.currentLineDash,o)||t.currentLineDashOffset!=s||t.currentLineJoin!=a||t.currentLineWidth!=l||t.currentMiterLimit!=h)&&(r.call(this,t),t.currentStrokeStyle=n,t.currentLineCap=i,t.currentLineDash=o,t.currentLineDashOffset=s,t.currentLineJoin=a,t.currentLineWidth=l,t.currentMiterLimit=h)},e.render.canvas.Replay.prototype.endGeometry=function(t,r){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var n=[e.render.canvas.Instruction.END_GEOMETRY,r];this.instructions.push(n),this.hitDetectionInstructions.push(n)},e.render.canvas.Replay.prototype.finish=e.nullFunction,e.render.canvas.Replay.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=e.extent.clone(this.maxExtent),this.maxLineWidth>0)){var t=this.resolution*(this.maxLineWidth+1)/2;e.extent.buffer(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},e.render.canvas.ImageReplay=function(t,r,n,i,o,s){e.render.canvas.Replay.call(this,t,r,n,i,o,s),this.declutterGroup_=null,this.hitDetectionImage_=null,this.image_=null,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.snapToPixel_=void 0,this.width_=void 0},e.inherits(e.render.canvas.ImageReplay,e.render.canvas.Replay),e.render.canvas.ImageReplay.prototype.drawCoordinates_=function(t,e,r,n){return this.appendFlatCoordinates(t,e,r,n,!1,!1)},e.render.canvas.ImageReplay.prototype.drawPoint=function(t,r){if(this.image_){this.beginGeometry(t,r);var n=t.getFlatCoordinates(),i=t.getStride(),o=this.coordinates.length,s=this.drawCoordinates_(n,0,n.length,i);this.instructions.push([e.render.canvas.Instruction.DRAW_IMAGE,o,s,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.snapToPixel_,this.width_]),this.hitDetectionInstructions.push([e.render.canvas.Instruction.DRAW_IMAGE,o,s,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.snapToPixel_,this.width_]),this.endGeometry(t,r)}},e.render.canvas.ImageReplay.prototype.drawMultiPoint=function(t,r){if(this.image_){this.beginGeometry(t,r);var n=t.getFlatCoordinates(),i=t.getStride(),o=this.coordinates.length,s=this.drawCoordinates_(n,0,n.length,i);this.instructions.push([e.render.canvas.Instruction.DRAW_IMAGE,o,s,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.snapToPixel_,this.width_]),this.hitDetectionInstructions.push([e.render.canvas.Instruction.DRAW_IMAGE,o,s,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.snapToPixel_,this.width_]),this.endGeometry(t,r)}},e.render.canvas.ImageReplay.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.snapToPixel_=void 0,this.width_=void 0},e.render.canvas.ImageReplay.prototype.setImageStyle=function(t,e){var r=t.getAnchor(),n=t.getSize(),i=t.getHitDetectionImage(1),o=t.getImage(1),s=t.getOrigin();this.anchorX_=r[0],this.anchorY_=r[1],this.declutterGroup_=e,this.hitDetectionImage_=i,this.image_=o,this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScale(),this.snapToPixel_=t.getSnapToPixel(),this.width_=n[0]},e.render.canvas.LineStringReplay=function(t,r,n,i,o,s){e.render.canvas.Replay.call(this,t,r,n,i,o,s)},e.inherits(e.render.canvas.LineStringReplay,e.render.canvas.Replay),e.render.canvas.LineStringReplay.prototype.drawFlatCoordinates_=function(t,r,n,i){var o=this.coordinates.length,s=this.appendFlatCoordinates(t,r,n,i,!1,!1),a=[e.render.canvas.Instruction.MOVE_TO_LINE_TO,o,s];return this.instructions.push(a),this.hitDetectionInstructions.push(a),n},e.render.canvas.LineStringReplay.prototype.drawLineString=function(t,r){var n=this.state,i=n.strokeStyle,o=n.lineWidth;if(void 0!==i&&void 0!==o){this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,r),this.hitDetectionInstructions.push([e.render.canvas.Instruction.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset],[e.render.canvas.Instruction.BEGIN_PATH]);var s=t.getFlatCoordinates(),a=t.getStride();this.drawFlatCoordinates_(s,0,s.length,a),this.hitDetectionInstructions.push([e.render.canvas.Instruction.STROKE]),this.endGeometry(t,r)}},e.render.canvas.LineStringReplay.prototype.drawMultiLineString=function(t,r){var n=this.state,i=n.strokeStyle,o=n.lineWidth;if(void 0!==i&&void 0!==o){this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,r),this.hitDetectionInstructions.push([e.render.canvas.Instruction.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset],[e.render.canvas.Instruction.BEGIN_PATH]);var s,a,l=t.getEnds(),h=t.getFlatCoordinates(),u=t.getStride(),c=0;for(s=0,a=l.length;s<a;++s)c=this.drawFlatCoordinates_(h,c,l[s],u);this.hitDetectionInstructions.push([e.render.canvas.Instruction.STROKE]),this.endGeometry(t,r)}},e.render.canvas.LineStringReplay.prototype.finish=function(){var t=this.state;void 0!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&this.instructions.push([e.render.canvas.Instruction.STROKE]),this.reverseHitDetectionInstructions(),this.state=null},e.render.canvas.LineStringReplay.prototype.applyStroke=function(t){void 0!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&(this.instructions.push([e.render.canvas.Instruction.STROKE]),t.lastStroke=this.coordinates.length),t.lastStroke=0,e.render.canvas.Replay.prototype.applyStroke.call(this,t),this.instructions.push([e.render.canvas.Instruction.BEGIN_PATH])},e.render.canvas.PolygonReplay=function(t,r,n,i,o,s){e.render.canvas.Replay.call(this,t,r,n,i,o,s)},e.inherits(e.render.canvas.PolygonReplay,e.render.canvas.Replay),e.render.canvas.PolygonReplay.prototype.drawFlatCoordinatess_=function(t,r,n,i){var o=this.state,s=void 0!==o.fillStyle,a=void 0!=o.strokeStyle,l=n.length,h=[e.render.canvas.Instruction.BEGIN_PATH];this.instructions.push(h),this.hitDetectionInstructions.push(h);for(var u=0;u<l;++u){var c=n[u],f=this.coordinates.length,d=this.appendFlatCoordinates(t,r,c,i,!0,!a),p=[e.render.canvas.Instruction.MOVE_TO_LINE_TO,f,d];if(this.instructions.push(p),this.hitDetectionInstructions.push(p),a){var g=[e.render.canvas.Instruction.CLOSE_PATH];this.instructions.push(g),this.hitDetectionInstructions.push(g)}r=c}var y=[e.render.canvas.Instruction.FILL];if(this.hitDetectionInstructions.push(y),s&&this.instructions.push(y),a){var m=[e.render.canvas.Instruction.STROKE];this.instructions.push(m),this.hitDetectionInstructions.push(m)}return r},e.render.canvas.PolygonReplay.prototype.drawCircle=function(t,r){var n=this.state,i=n.fillStyle,o=n.strokeStyle;if(void 0!==i||void 0!==o){this.setFillStrokeStyles_(t),this.beginGeometry(t,r),this.hitDetectionInstructions.push([e.render.canvas.Instruction.SET_FILL_STYLE,e.color.asString(e.render.canvas.defaultFillStyle)]),void 0!==n.strokeStyle&&this.hitDetectionInstructions.push([e.render.canvas.Instruction.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);var s=t.getFlatCoordinates(),a=t.getStride(),l=this.coordinates.length;this.appendFlatCoordinates(s,0,s.length,a,!1,!1);var h=[e.render.canvas.Instruction.BEGIN_PATH],u=[e.render.canvas.Instruction.CIRCLE,l];this.instructions.push(h,u),this.hitDetectionInstructions.push(h,u);var c=[e.render.canvas.Instruction.FILL];if(this.hitDetectionInstructions.push(c),void 0!==n.fillStyle&&this.instructions.push(c),void 0!==n.strokeStyle){var f=[e.render.canvas.Instruction.STROKE];this.instructions.push(f),this.hitDetectionInstructions.push(f)}this.endGeometry(t,r)}},e.render.canvas.PolygonReplay.prototype.drawPolygon=function(t,r){var n=this.state;this.setFillStrokeStyles_(t),this.beginGeometry(t,r),this.hitDetectionInstructions.push([e.render.canvas.Instruction.SET_FILL_STYLE,e.color.asString(e.render.canvas.defaultFillStyle)]),void 0!==n.strokeStyle&&this.hitDetectionInstructions.push([e.render.canvas.Instruction.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);var i=t.getEnds(),o=t.getOrientedFlatCoordinates(),s=t.getStride();this.drawFlatCoordinatess_(o,0,i,s),this.endGeometry(t,r)},e.render.canvas.PolygonReplay.prototype.drawMultiPolygon=function(t,r){var n=this.state,i=n.fillStyle,o=n.strokeStyle;if(void 0!==i||void 0!==o){this.setFillStrokeStyles_(t),this.beginGeometry(t,r),this.hitDetectionInstructions.push([e.render.canvas.Instruction.SET_FILL_STYLE,e.color.asString(e.render.canvas.defaultFillStyle)]),void 0!==n.strokeStyle&&this.hitDetectionInstructions.push([e.render.canvas.Instruction.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);var s,a,l=t.getEndss(),h=t.getOrientedFlatCoordinates(),u=t.getStride(),c=0;for(s=0,a=l.length;s<a;++s)c=this.drawFlatCoordinatess_(h,c,l[s],u);this.endGeometry(t,r)}},e.render.canvas.PolygonReplay.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var t=this.tolerance;if(0!==t){var r,n,i=this.coordinates;for(r=0,n=i.length;r<n;++r)i[r]=e.geom.flat.simplify.snap(i[r],t)}},e.render.canvas.PolygonReplay.prototype.setFillStrokeStyles_=function(t){var e=this.state;void 0!==e.fillStyle&&this.updateFillStyle(e,this.applyFill,t),void 0!==e.strokeStyle&&this.updateStrokeStyle(e,this.applyStroke)},e.geom.flat.straightchunk={},e.geom.flat.straightchunk.lineString=function(t,e,r,n,i){var o,s,a,l,h,u,c,f,d,p=r,g=r,y=0,m=0,v=r;for(o=r;o<n;o+=i){var _=e[o],S=e[o+1];void 0!==l&&(f=_-l,d=S-h,a=Math.sqrt(f*f+d*d),void 0!==u&&(m+=s,Math.acos((u*f+c*d)/(s*a))>t&&(m>y&&(y=m,p=v,g=o),m=0,v=o-i)),s=a,u=f,c=d),l=_,h=S}return m+=a,m>y?[v,o]:[p,g]},e.style.TextPlacement={POINT:"point",LINE:"line"},e.render.canvas.TextReplay=function(t,r,n,i,o,s){e.render.canvas.Replay.call(this,t,r,n,i,o,s),this.declutterGroup_,this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.widths_={},e.render.canvas.labelCache.prune()},e.inherits(e.render.canvas.TextReplay,e.render.canvas.Replay),e.render.canvas.TextReplay.measureTextWidths=function(t,r,n){var i,o,s=r.length,a=0;for(o=0;o<s;++o)i=e.render.canvas.measureTextWidth(t,r[o]),a=Math.max(a,i),n.push(i);return a},e.render.canvas.TextReplay.prototype.drawText=function(t,r){var n=this.textFillState_,i=this.textStrokeState_,o=this.textState_;if(""!==this.text_&&o&&(n||i)){var s,a,l=this.coordinates.length,h=t.getType(),u=null,c=2,f=2;if(o.placement===e.style.TextPlacement.LINE){if(!e.extent.intersects(this.getBufferedMaxExtent(),t.getExtent()))return;var d;if(u=t.getFlatCoordinates(),f=t.getStride(),h==e.geom.GeometryType.LINE_STRING)d=[u.length];else if(h==e.geom.GeometryType.MULTI_LINE_STRING)d=t.getEnds();else if(h==e.geom.GeometryType.POLYGON)d=t.getEnds().slice(0,1);else if(h==e.geom.GeometryType.MULTI_POLYGON){var p=t.getEndss();for(d=[],s=0,a=p.length;s<a;++s)d.push(p[s][0])}this.beginGeometry(t,r);for(var g,y=o.textAlign,m=0,v=0,_=d.length;v<_;++v){if(void 0==y){var S=e.geom.flat.straightchunk.lineString(o.maxAngle,u,m,d[v],f);m=S[0],g=S[1]}else g=d[v];for(s=m;s<g;s+=f)this.coordinates.push(u[s],u[s+1]);c=this.coordinates.length,m=d[v],this.drawChars_(l,c,this.declutterGroup_),l=c}this.endGeometry(t,r)}else{var C=this.getImage(this.text_,this.textKey_,this.fillKey_,this.strokeKey_),x=C.width/this.pixelRatio;switch(h){case e.geom.GeometryType.POINT:case e.geom.GeometryType.MULTI_POINT:u=t.getFlatCoordinates(),c=u.length;break;case e.geom.GeometryType.LINE_STRING:u=t.getFlatMidpoint();break;case e.geom.GeometryType.CIRCLE:u=t.getCenter();break;case e.geom.GeometryType.MULTI_LINE_STRING:u=t.getFlatMidpoints(),c=u.length;break;case e.geom.GeometryType.POLYGON:if(u=t.getFlatInteriorPoint(),!o.overflow&&u[2]/this.resolution<x)return;f=3;break;case e.geom.GeometryType.MULTI_POLYGON:var I=t.getFlatInteriorPoints();for(u=[],s=0,a=I.length;s<a;s+=3)(o.overflow||I[s+2]/this.resolution>=x)&&u.push(I[s],I[s+1]);if(0==(c=u.length))return}c=this.appendFlatCoordinates(u,0,c,f,!1,!1),this.beginGeometry(t,r),(o.backgroundFill||o.backgroundStroke)&&(this.setFillStrokeStyle(o.backgroundFill,o.backgroundStroke),this.updateFillStyle(this.state,this.applyFill,t),this.updateStrokeStyle(this.state,this.applyStroke)),this.drawTextImage_(C,l,c),this.endGeometry(t,r)}}},e.render.canvas.TextReplay.prototype.getImage=function(t,r,n,i){var o,s=i+r+t+n+this.pixelRatio,a=e.render.canvas.labelCache;if(!a.containsKey(s)){var l=i?this.strokeStates[i]||this.textStrokeState_:null,h=n?this.fillStates[n]||this.textFillState_:null,u=this.textStates[r]||this.textState_,c=this.pixelRatio,f=u.scale*c,d=e.render.replay.TEXT_ALIGN[u.textAlign||e.render.canvas.defaultTextAlign],p=i&&l.lineWidth?l.lineWidth:0,g=t.split("\n"),y=g.length,m=[],v=e.render.canvas.TextReplay.measureTextWidths(u.font,g,m),_=e.render.canvas.measureTextHeight(u.font),S=_*y,C=v+p,x=e.dom.createCanvasContext2D(Math.ceil(C*f),Math.ceil((S+p)*f));o=x.canvas,a.set(s,o),1!=f&&x.scale(f,f),x.font=u.font,i&&(x.strokeStyle=l.strokeStyle,x.lineWidth=p*(e.has.SAFARI?f:1),x.lineCap=l.lineCap,x.lineJoin=l.lineJoin,x.miterLimit=l.miterLimit,e.has.CANVAS_LINE_DASH&&l.lineDash.length&&(x.setLineDash(l.lineDash),x.lineDashOffset=l.lineDashOffset)),n&&(x.fillStyle=h.fillStyle),x.textBaseline="middle",x.textAlign="center";var I,E=.5-d,T=d*o.width/f+E*p;if(i)for(I=0;I<y;++I)x.strokeText(g[I],T+E*m[I],.5*(p+_)+I*_);if(n)for(I=0;I<y;++I)x.fillText(g[I],T+E*m[I],.5*(p+_)+I*_)}return a.get(s)},e.render.canvas.TextReplay.prototype.drawTextImage_=function(t,r,n){var i=this.textState_,o=this.textStrokeState_,s=this.pixelRatio,a=e.render.replay.TEXT_ALIGN[i.textAlign||e.render.canvas.defaultTextAlign],l=e.render.replay.TEXT_ALIGN[i.textBaseline],h=o&&o.lineWidth?o.lineWidth:0,u=a*t.width/s+2*(.5-a)*h,c=l*t.height/s+2*(.5-l)*h;this.instructions.push([e.render.canvas.Instruction.DRAW_IMAGE,r,n,t,(u-this.textOffsetX_)*s,(c-this.textOffsetY_)*s,this.declutterGroup_,t.height,1,0,0,this.textRotateWithView_,this.textRotation_,1,!0,t.width,i.padding==e.render.canvas.defaultPadding?e.render.canvas.defaultPadding:i.padding.map(function(t){return t*s}),!!i.backgroundFill,!!i.backgroundStroke]),this.hitDetectionInstructions.push([e.render.canvas.Instruction.DRAW_IMAGE,r,n,t,(u-this.textOffsetX_)*s,(c-this.textOffsetY_)*s,this.declutterGroup_,t.height,1,0,0,this.textRotateWithView_,this.textRotation_,1/s,!0,t.width,i.padding,!!i.backgroundFill,!!i.backgroundStroke])},e.render.canvas.TextReplay.prototype.drawChars_=function(t,r,n){var i=this.textStrokeState_,o=this.textState_,s=this.textFillState_,a=this.strokeKey_;i&&(a in this.strokeStates||(this.strokeStates[a]={strokeStyle:i.strokeStyle,lineCap:i.lineCap,lineDashOffset:i.lineDashOffset,lineWidth:i.lineWidth,lineJoin:i.lineJoin,miterLimit:i.miterLimit,lineDash:i.lineDash}));var l=this.textKey_;this.textKey_ in this.textStates||(this.textStates[this.textKey_]={font:o.font,textAlign:o.textAlign||e.render.canvas.defaultTextAlign,scale:o.scale});var h=this.fillKey_;s&&(h in this.fillStates||(this.fillStates[h]={fillStyle:s.fillStyle}));var u=this.pixelRatio,c=e.render.replay.TEXT_ALIGN[o.textBaseline],f=this.textOffsetY_*u,d=this.text_,p=o.font,g=o.scale,y=i?i.lineWidth*g/2:0,m=this.widths_[p];m||(this.widths_[p]=m={}),this.instructions.push([e.render.canvas.Instruction.DRAW_CHARS,t,r,c,n,o.overflow,h,o.maxAngle,function(t){var r=m[t];return r||(r=m[t]=e.render.canvas.measureTextWidth(p,t)),r*g*u},f,a,y*u,d,l,1]),this.hitDetectionInstructions.push([e.render.canvas.Instruction.DRAW_CHARS,t,r,c,n,o.overflow,h,o.maxAngle,function(t){var r=m[t];return r||(r=m[t]=e.render.canvas.measureTextWidth(p,t)),r*g},f,a,y,d,l,1/u])},e.render.canvas.TextReplay.prototype.setTextStyle=function(t,r){var n,i,o;if(t){this.declutterGroup_=r;var s=t.getFill();s?(i=this.textFillState_,i||(i=this.textFillState_={}),i.fillStyle=e.colorlike.asColorLike(s.getColor()||e.render.canvas.defaultFillStyle)):i=this.textFillState_=null;var a=t.getStroke();if(a){o=this.textStrokeState_,o||(o=this.textStrokeState_={});var l=a.getLineDash(),h=a.getLineDashOffset(),u=a.getWidth(),c=a.getMiterLimit();o.lineCap=a.getLineCap()||e.render.canvas.defaultLineCap,o.lineDash=l?l.slice():e.render.canvas.defaultLineDash,o.lineDashOffset=void 0===h?e.render.canvas.defaultLineDashOffset:h,o.lineJoin=a.getLineJoin()||e.render.canvas.defaultLineJoin,o.lineWidth=void 0===u?e.render.canvas.defaultLineWidth:u,o.miterLimit=void 0===c?e.render.canvas.defaultMiterLimit:c,o.strokeStyle=e.colorlike.asColorLike(a.getColor()||e.render.canvas.defaultStrokeStyle)}else o=this.textStrokeState_=null;n=this.textState_;var f=t.getFont()||e.render.canvas.defaultFont,d=t.getScale();n.overflow=t.getOverflow(),n.font=f,n.maxAngle=t.getMaxAngle(),n.placement=t.getPlacement(),n.textAlign=t.getTextAlign(),n.textBaseline=t.getTextBaseline()||e.render.canvas.defaultTextBaseline,n.backgroundFill=t.getBackgroundFill(),n.backgroundStroke=t.getBackgroundStroke(),n.padding=t.getPadding()||e.render.canvas.defaultPadding,n.scale=void 0===d?1:d;var p=t.getOffsetX(),g=t.getOffsetY(),y=t.getRotateWithView(),m=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=void 0===p?0:p,this.textOffsetY_=void 0===g?0:g,this.textRotateWithView_=void 0!==y&&y,this.textRotation_=void 0===m?0:m,this.strokeKey_=o?("string"==typeof o.strokeStyle?o.strokeStyle:e.getUid(o.strokeStyle))+o.lineCap+o.lineDashOffset+"|"+o.lineWidth+o.lineJoin+o.miterLimit+"["+o.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?"),this.fillKey_=i?"string"==typeof i.fillStyle?i.fillStyle:"|"+e.getUid(i.fillStyle):""}else this.text_=""},e.render.canvas.ReplayGroup=function(t,r,n,i,o,s,a){e.render.ReplayGroup.call(this),this.declutterTree_=s,this.declutterGroup_=null,this.tolerance_=t,this.maxExtent_=r,this.overlaps_=o,this.pixelRatio_=i,this.resolution_=n,this.renderBuffer_=a,this.replaysByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=e.transform.create()},e.inherits(e.render.canvas.ReplayGroup,e.render.ReplayGroup),e.render.canvas.ReplayGroup.circleArrayCache_={0:[[!0]]},e.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_=function(t,e,r){var n,i=Math.floor(t.length/2);if(e>=i)for(n=i;n<e;n++)t[n][r]=!0;else if(e<i)for(n=e+1;n<i;n++)t[n][r]=!0},e.render.canvas.ReplayGroup.getCircleArray_=function(t){if(void 0!==e.render.canvas.ReplayGroup.circleArrayCache_[t])return e.render.canvas.ReplayGroup.circleArrayCache_[t];for(var r=2*t+1,n=new Array(r),i=0;i<r;i++)n[i]=new Array(r);for(var o=t,s=0,a=0;o>=s;)e.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(n,t+o,t+s),e.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(n,t+s,t+o),e.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(n,t-s,t+o),e.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(n,t-o,t+s),e.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(n,t-o,t-s),e.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(n,t-s,t-o),e.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(n,t+s,t-o),e.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(n,t+o,t-s),s++,2*((a+=1+2*s)-o)+1>0&&(o-=1,a+=1-2*o);return e.render.canvas.ReplayGroup.circleArrayCache_[t]=n,n},e.render.canvas.ReplayGroup.replayDeclutter=function(t,r,n){for(var i=Object.keys(t).map(Number).sort(e.array.numberSafeCompareFunction),o={},s=0,a=i.length;s<a;++s)for(var l=t[i[s].toString()],h=0,u=l.length;h<u;){var c=l[h++],f=l[h++];c.replay(r,f,n,o)}},e.render.canvas.ReplayGroup.prototype.addDeclutter=function(t){var r=null;return this.declutterTree_&&(t?(r=this.declutterGroup_,r[4]++):(r=this.declutterGroup_=e.extent.createEmpty(),r.push(1))),r},e.render.canvas.ReplayGroup.prototype.clip=function(t,e){var r=this.getClipCoords(e);t.beginPath(),t.moveTo(r[0],r[1]),t.lineTo(r[2],r[3]),t.lineTo(r[4],r[5]),t.lineTo(r[6],r[7]),t.clip()},e.render.canvas.ReplayGroup.prototype.hasReplays=function(t){for(var e in this.replaysByZIndex_)for(var r=this.replaysByZIndex_[e],n=0,i=t.length;n<i;++n)if(t[n]in r)return!0;return!1},e.render.canvas.ReplayGroup.prototype.finish=function(){var t;for(t in this.replaysByZIndex_){var e,r=this.replaysByZIndex_[t];for(e in r)r[e].finish()}},e.render.canvas.ReplayGroup.prototype.forEachFeatureAtCoordinate=function(t,r,n,i,o,s,a){function l(t){for(var r=c.getImageData(0,0,h,h).data,n=0;n<h;n++)for(var i=0;i<h;i++)if(p[n][i]&&r[4*(i*h+n)+3]>0){var o;return(!d||g!=e.render.ReplayType.IMAGE&&g!=e.render.ReplayType.TEXT||-1!==d.indexOf(t))&&(o=s(t)),o||void c.clearRect(0,0,h,h)}}i=Math.round(i);var h=2*i+1,u=e.transform.compose(this.hitDetectionTransform_,i+.5,i+.5,1/r,-1/r,-n,-t[0],-t[1]),c=this.hitDetectionContext_;c.canvas.width!==h||c.canvas.height!==h?(c.canvas.width=h,c.canvas.height=h):c.clearRect(0,0,h,h);var f;void 0!==this.renderBuffer_&&(f=e.extent.createEmpty(),e.extent.extendCoordinate(f,t),e.extent.buffer(f,r*(this.renderBuffer_+i),f));var d,p=e.render.canvas.ReplayGroup.getCircleArray_(i);this.declutterTree_&&(d=this.declutterTree_.all().map(function(t){return t.value}));var g,y=Object.keys(this.replaysByZIndex_).map(Number);y.sort(e.array.numberSafeCompareFunction);var m,v,_,S,C;for(m=y.length-1;m>=0;--m){var x=y[m].toString();for(_=this.replaysByZIndex_[x],v=e.render.replay.ORDER.length-1;v>=0;--v)if(g=e.render.replay.ORDER[v],void 0!==(S=_[g]))if(!a||g!=e.render.ReplayType.IMAGE&&g!=e.render.ReplayType.TEXT){if(C=S.replayHitDetection(c,u,n,o,l,f))return C}else{var I=a[x];I?I.push(S,u.slice(0)):a[x]=[S,u.slice(0)]}}},e.render.canvas.ReplayGroup.prototype.getClipCoords=function(t){var r=this.maxExtent_,n=r[0],i=r[1],o=r[2],s=r[3],a=[n,i,n,s,o,s,o,i];return e.geom.flat.transform.transform2D(a,0,8,2,t,a),a},e.render.canvas.ReplayGroup.prototype.getReplay=function(t,r){var n=void 0!==t?t.toString():"0",i=this.replaysByZIndex_[n];void 0===i&&(i={},this.replaysByZIndex_[n]=i);var o=i[r];if(void 0===o){o=new(0,e.render.canvas.ReplayGroup.BATCH_CONSTRUCTORS_[r])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_,this.overlaps_,this.declutterTree_),i[r]=o}return o},e.render.canvas.ReplayGroup.prototype.getReplays=function(){return this.replaysByZIndex_},e.render.canvas.ReplayGroup.prototype.isEmpty=function(){return e.obj.isEmpty(this.replaysByZIndex_)},e.render.canvas.ReplayGroup.prototype.replay=function(t,r,n,i,o,s){var a=Object.keys(this.replaysByZIndex_).map(Number);a.sort(e.array.numberSafeCompareFunction),t.save(),this.clip(t,r);var l,h,u,c,f,d,p=o||e.render.replay.ORDER;for(l=0,h=a.length;l<h;++l){var g=a[l].toString();for(f=this.replaysByZIndex_[g],u=0,c=p.length;u<c;++u){var y=p[u];if(void 0!==(d=f[y]))if(!s||y!=e.render.ReplayType.IMAGE&&y!=e.render.ReplayType.TEXT)d.replay(t,r,n,i);else{var m=s[g];m?m.push(d,r.slice(0)):s[g]=[d,r.slice(0)]}}}t.restore()},e.render.canvas.ReplayGroup.BATCH_CONSTRUCTORS_={Circle:e.render.canvas.PolygonReplay,Default:e.render.canvas.Replay,Image:e.render.canvas.ImageReplay,LineString:e.render.canvas.LineStringReplay,Polygon:e.render.canvas.PolygonReplay,Text:e.render.canvas.TextReplay},e.renderer={},e.renderer.vector={},e.renderer.vector.defaultOrder=function(t,r){return e.getUid(t)-e.getUid(r)},e.renderer.vector.getSquaredTolerance=function(t,r){var n=e.renderer.vector.getTolerance(t,r);return n*n},e.renderer.vector.getTolerance=function(t,r){return e.SIMPLIFY_TOLERANCE*t/r},e.renderer.vector.renderCircleGeometry_=function(t,r,n,i){var o=n.getFill(),s=n.getStroke();if(o||s){var a=t.getReplay(n.getZIndex(),e.render.ReplayType.CIRCLE);a.setFillStrokeStyle(o,s),a.drawCircle(r,i)}var l=n.getText();if(l){var h=t.getReplay(n.getZIndex(),e.render.ReplayType.TEXT);h.setTextStyle(l,t.addDeclutter(!1)),h.drawText(r,i)}},e.renderer.vector.renderFeature=function(t,r,n,i,o,s){var a,l,h=!1;return a=n.getImage(),a&&(l=a.getImageState(),l==e.ImageState.LOADED||l==e.ImageState.ERROR?a.unlistenImageChange(o,s):(l==e.ImageState.IDLE&&a.load(),l=a.getImageState(),
a.listenImageChange(o,s),h=!0)),e.renderer.vector.renderFeature_(t,r,n,i),h},e.renderer.vector.renderFeature_=function(t,r,n,i){var o=n.getGeometryFunction()(r);if(o){var s=o.getSimplifiedGeometry(i);if(n.getRenderer())e.renderer.vector.renderGeometry_(t,s,n,r);else{(0,e.renderer.vector.GEOMETRY_RENDERERS_[s.getType()])(t,s,n,r)}}},e.renderer.vector.renderGeometry_=function(t,r,n,i){if(r.getType()!=e.geom.GeometryType.GEOMETRY_COLLECTION){t.getReplay(n.getZIndex(),e.render.ReplayType.DEFAULT).drawCustom(r,i,n.getRenderer())}else for(var o=r.getGeometries(),s=0,a=o.length;s<a;++s)e.renderer.vector.renderGeometry_(t,o[s],n,i)},e.renderer.vector.renderGeometryCollectionGeometry_=function(t,r,n,i){var o,s,a=r.getGeometriesArray();for(o=0,s=a.length;o<s;++o){(0,e.renderer.vector.GEOMETRY_RENDERERS_[a[o].getType()])(t,a[o],n,i)}},e.renderer.vector.renderLineStringGeometry_=function(t,r,n,i){var o=n.getStroke();if(o){var s=t.getReplay(n.getZIndex(),e.render.ReplayType.LINE_STRING);s.setFillStrokeStyle(null,o),s.drawLineString(r,i)}var a=n.getText();if(a){var l=t.getReplay(n.getZIndex(),e.render.ReplayType.TEXT);l.setTextStyle(a,t.addDeclutter(!1)),l.drawText(r,i)}},e.renderer.vector.renderMultiLineStringGeometry_=function(t,r,n,i){var o=n.getStroke();if(o){var s=t.getReplay(n.getZIndex(),e.render.ReplayType.LINE_STRING);s.setFillStrokeStyle(null,o),s.drawMultiLineString(r,i)}var a=n.getText();if(a){var l=t.getReplay(n.getZIndex(),e.render.ReplayType.TEXT);l.setTextStyle(a,t.addDeclutter(!1)),l.drawText(r,i)}},e.renderer.vector.renderMultiPolygonGeometry_=function(t,r,n,i){var o=n.getFill(),s=n.getStroke();if(s||o){var a=t.getReplay(n.getZIndex(),e.render.ReplayType.POLYGON);a.setFillStrokeStyle(o,s),a.drawMultiPolygon(r,i)}var l=n.getText();if(l){var h=t.getReplay(n.getZIndex(),e.render.ReplayType.TEXT);h.setTextStyle(l,t.addDeclutter(!1)),h.drawText(r,i)}},e.renderer.vector.renderPointGeometry_=function(t,r,n,i){var o=n.getImage();if(o){if(o.getImageState()!=e.ImageState.LOADED)return;var s=t.getReplay(n.getZIndex(),e.render.ReplayType.IMAGE);s.setImageStyle(o,t.addDeclutter(!1)),s.drawPoint(r,i)}var a=n.getText();if(a){var l=t.getReplay(n.getZIndex(),e.render.ReplayType.TEXT);l.setTextStyle(a,t.addDeclutter(!!o)),l.drawText(r,i)}},e.renderer.vector.renderMultiPointGeometry_=function(t,r,n,i){var o=n.getImage();if(o){if(o.getImageState()!=e.ImageState.LOADED)return;var s=t.getReplay(n.getZIndex(),e.render.ReplayType.IMAGE);s.setImageStyle(o,t.addDeclutter(!1)),s.drawMultiPoint(r,i)}var a=n.getText();if(a){var l=t.getReplay(n.getZIndex(),e.render.ReplayType.TEXT);l.setTextStyle(a,t.addDeclutter(!!o)),l.drawText(r,i)}},e.renderer.vector.renderPolygonGeometry_=function(t,r,n,i){var o=n.getFill(),s=n.getStroke();if(o||s){var a=t.getReplay(n.getZIndex(),e.render.ReplayType.POLYGON);a.setFillStrokeStyle(o,s),a.drawPolygon(r,i)}var l=n.getText();if(l){var h=t.getReplay(n.getZIndex(),e.render.ReplayType.TEXT);h.setTextStyle(l,t.addDeclutter(!1)),h.drawText(r,i)}},e.renderer.vector.GEOMETRY_RENDERERS_={Point:e.renderer.vector.renderPointGeometry_,LineString:e.renderer.vector.renderLineStringGeometry_,Polygon:e.renderer.vector.renderPolygonGeometry_,MultiPoint:e.renderer.vector.renderMultiPointGeometry_,MultiLineString:e.renderer.vector.renderMultiLineStringGeometry_,MultiPolygon:e.renderer.vector.renderMultiPolygonGeometry_,GeometryCollection:e.renderer.vector.renderGeometryCollectionGeometry_,Circle:e.renderer.vector.renderCircleGeometry_},e}),define("Workers/MVTWorker",["./createTaskProcessorWorker","../Core/Color","../Core/defaultValue","../Core/defined","../Scene/MvtFilter","../Scene/MvtStyle","../Scene/MvtRenderer2D","../ThirdParty/supermap3D-openlayer-4.6.5"],function(t,e,r,n,i,o,s,a){"use strict";function l(t,e){var r=new OffscreenCanvas(t.canvasWidth,t.canvasWidth),i=new OffscreenCanvas(t.canvasWidth,t.canvasWidth),o=t.pbfData,s=t.layers,l=t.transform,c=t.squaredTolerance,d=t.spriteImageDatas,p=t.keepProperties,g=t.tileLevel,y=t.needSourceLayerNames,m=t.selectEnabled,v={};try{var _=new a.format.MVT({featureClass:a.Feature}),S=_.readFeatures(o,{needSourceLayerNames:y}),C=f.renderFeatures({colorCanvas:r,idCanvas:i,transform:l,layers:s,features:S,tileLevel:g,spriteImageCanvas:u,spriteImageDatas:d,squaredTolerance:c,selectEnabled:m,showBillboard:!1});if(p)for(var x=C.idFeatures,I=x.length,E=0;E<I;E++){var T=x[E],R=h(T),O=T.getProperties();n(O.geometry)&&delete O.geometry,v[R]=O}}catch(t){}var L=r.transferToImageBitmap(),F=m?i.transferToImageBitmap():null;return e.push(L),{buffer:L,idBuffer:F,properties:v}}function h(t){var e=t.getId();return e-=16777216*Math.floor(e/16777216)}var u={},c=new o(a,!0),f=new s({mvtStyle:c,openlayer:a,useOffscreen:!0});return t(l)})}();